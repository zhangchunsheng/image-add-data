var Mapabc={singleFile:true};
(function(){var a=typeof Mapabc=="object"&&Mapabc.singleFile;window.Mapabc={_scriptName:!a?"js/Mapabc.js":"Mapabc.js",_getScriptLocation:function(){for(var h="",i=new RegExp("(^|(.*?\\/))("+Mapabc._scriptName+")(\\?|$)"),j=document.getElementsByTagName("script"),k=0,l=j.length;k<l;k++){var m=j[k].getAttribute("src");if(m)if(m=m.match(i)){h=m[1];break}}return h}};if(!a){a=new Array("Mapabc/Util.js","Mapabc/BaseTypes.js","Mapabc/BaseTypes/Class.js","Mapabc/BaseTypes/Bounds.js","Mapabc/BaseTypes/Element.js",
"Mapabc/BaseTypes/LonLat.js","Mapabc/BaseTypes/Pixel.js","Mapabc/BaseTypes/Size.js","Mapabc/Console.js","Mapabc/Tween.js","Rico/Corner.js","Rico/Color.js","Mapabc/Ajax.js","Mapabc/Events.js","Mapabc/Request.js","Mapabc/Request/XMLHttpRequest.js","Mapabc/Projection.js","Mapabc/Map.js","Mapabc/Layer.js","Mapabc/Icon.js","Mapabc/Marker.js","Mapabc/Label.js","Mapabc/Marker/Box.js","Mapabc/Popup.js","Mapabc/Tile.js","Mapabc/Tile/Image.js","Mapabc/Tile/WFS.js","Mapabc/Layer/Image.js","Mapabc/Layer/SphericalMercator.js",
"Mapabc/Layer/EventPane.js","Mapabc/Layer/FixedZoomLevels.js","Mapabc/Layer/Google.js","Mapabc/Layer/VirtualEarth.js","Mapabc/Layer/Yahoo.js","Mapabc/Layer/HTTPRequest.js","Mapabc/Layer/Grid.js","Mapabc/Layer/MapGuide.js","Mapabc/Layer/MapServer.js","Mapabc/Layer/MapServer/Untiled.js","Mapabc/Layer/KaMap.js","Mapabc/Layer/KaMapCache.js","Mapabc/Layer/MultiMap.js","Mapabc/Layer/Markers.js","Mapabc/Layer/Text.js","Mapabc/Layer/WorldWind.js","Mapabc/Layer/ArcGIS93Rest.js","Mapabc/Layer/WMS.js","Mapabc/Layer/WMS/Untiled.js",
"Mapabc/Layer/ArcIMS.js","Mapabc/Layer/GeoRSS.js","Mapabc/Layer/Boxes.js","Mapabc/Layer/XYZ.js","Mapabc/Layer/TMS.js","Mapabc/Layer/TileCache.js","Mapabc/Popup/Anchored.js","Mapabc/Popup/AnchoredBubble.js","Mapabc/Popup/Framed.js","Mapabc/Popup/FramedCloud.js","Mapabc/Feature.js","Mapabc/Feature/Vector.js","Mapabc/Feature/WFS.js","Mapabc/Handler.js","Mapabc/Handler/Click.js","Mapabc/Handler/Hover.js","Mapabc/Handler/Point.js","Mapabc/Handler/Path.js","Mapabc/Handler/Polygon.js","Mapabc/Handler/Feature.js",
"Mapabc/Handler/Drag.js","Mapabc/Handler/RegularPolygon.js","Mapabc/Handler/Circle.js","Mapabc/Handler/Box.js","Mapabc/Handler/MouseWheel.js","Mapabc/Handler/Keyboard.js","Mapabc/Control.js","Mapabc/Control/Attribution.js","Mapabc/Control/Button.js","Mapabc/Control/ZoomBox.js","Mapabc/Control/ZoomToMaxExtent.js","Mapabc/Control/DragPan.js","Mapabc/Control/Navigation.js","Mapabc/Control/MouseDefaults.js","Mapabc/Control/MousePosition.js","Mapabc/Control/OverviewMap.js","Mapabc/Control/KeyboardDefaults.js",
"Mapabc/Control/PanZoom.js","Mapabc/Control/PanZoomBar.js","Mapabc/Control/ArgParser.js","Mapabc/Control/Permalink.js","Mapabc/Control/Scale.js","Mapabc/Control/ScaleLine.js","Mapabc/Control/Snapping.js","Mapabc/Control/Split.js","Mapabc/Control/LayerSwitcher.js","Mapabc/Control/DrawFeature.js","Mapabc/Control/DragFeature.js","Mapabc/Control/ModifyFeature.js","Mapabc/Control/Panel.js","Mapabc/Control/SelectFeature.js","Mapabc/Control/NavigationHistory.js","Mapabc/Control/Measure.js","Mapabc/Control/WMSGetFeatureInfo.js",
"Mapabc/Geometry.js","Mapabc/Geometry/Rectangle.js","Mapabc/Geometry/Collection.js","Mapabc/Geometry/Point.js","Mapabc/Geometry/MultiPoint.js","Mapabc/Geometry/Curve.js","Mapabc/Geometry/LineString.js","Mapabc/Geometry/LinearRing.js","Mapabc/Geometry/Polygon.js","Mapabc/Geometry/MultiLineString.js","Mapabc/Geometry/MultiPolygon.js","Mapabc/Geometry/Surface.js","Mapabc/Geometry/Circle.js","Mapabc/Renderer.js","Mapabc/Renderer/Elements.js","Mapabc/Renderer/SVG.js","Mapabc/Renderer/Canvas.js","Mapabc/Renderer/VML.js",
"Mapabc/Layer/Vector.js","Mapabc/Layer/Vector/RootContainer.js","Mapabc/Strategy.js","Mapabc/Strategy/Fixed.js","Mapabc/Strategy/Cluster.js","Mapabc/Strategy/Paging.js","Mapabc/Strategy/BBOX.js","Mapabc/Strategy/Save.js","Mapabc/Protocol.js","Mapabc/Protocol/HTTP.js","Mapabc/Protocol/SQL.js","Mapabc/Protocol/SQL/Gears.js","Mapabc/Protocol/WFS.js","Mapabc/Protocol/WFS/v1.js","Mapabc/Protocol/WFS/v1_0_0.js","Mapabc/Protocol/WFS/v1_1_0.js","Mapabc/Layer/PointTrack.js","Mapabc/Layer/GML.js","Mapabc/Style.js",
"Mapabc/StyleMap.js","Mapabc/Rule.js","Mapabc/Filter.js","Mapabc/Filter/FeatureId.js","Mapabc/Filter/Logical.js","Mapabc/Filter/Comparison.js","Mapabc/Filter/Spatial.js","Mapabc/Format.js","Mapabc/Format/XML.js","Mapabc/Format/ArcXML.js","Mapabc/Format/ArcXML/Features.js","Mapabc/Format/GML.js","Mapabc/Format/GML/Base.js","Mapabc/Format/GML/v2.js","Mapabc/Format/GML/v3.js","Mapabc/Format/KML.js","Mapabc/Format/GeoRSS.js","Mapabc/Format/WFS.js","Mapabc/Format/WFSCapabilities.js","Mapabc/Format/WFSCapabilities/v1.js",
"Mapabc/Format/WFSCapabilities/v1_0_0.js","Mapabc/Format/WFSCapabilities/v1_1_0.js","Mapabc/Format/WFSDescribeFeatureType.js","Mapabc/Format/WMSDescribeLayer.js","Mapabc/Format/WMSDescribeLayer/v1_1.js","Mapabc/Format/WKT.js","Mapabc/Format/OSM.js","Mapabc/Format/GPX.js","Mapabc/Format/Filter.js","Mapabc/Format/Filter/v1.js","Mapabc/Format/Filter/v1_0_0.js","Mapabc/Format/Filter/v1_1_0.js","Mapabc/Format/SLD.js","Mapabc/Format/SLD/v1.js","Mapabc/Format/SLD/v1_0_0.js","Mapabc/Format/SLD/v1.js","Mapabc/Format/WFST.js",
"Mapabc/Format/WFST/v1.js","Mapabc/Format/WFST/v1_0_0.js","Mapabc/Format/WFST/v1_1_0.js","Mapabc/Format/Text.js","Mapabc/Format/JSON.js","Mapabc/Format/GeoJSON.js","Mapabc/Format/WMC.js","Mapabc/Format/WMC/v1.js","Mapabc/Format/WMC/v1_0_0.js","Mapabc/Format/WMC/v1_1_0.js","Mapabc/Format/WMSCapabilities.js","Mapabc/Format/WMSCapabilities/v1_1.js","Mapabc/Format/WMSCapabilities/v1_1_0.js","Mapabc/Format/WMSCapabilities/v1_1_1.js","Mapabc/Format/WMSGetFeatureInfo.js","Mapabc/Layer/WFS.js","Mapabc/Control/GetFeature.js",
"Mapabc/Control/MouseToolbar.js","Mapabc/Control/NavToolbar.js","Mapabc/Control/PanPanel.js","Mapabc/Control/Pan.js","Mapabc/Control/ZoomIn.js","Mapabc/Control/ZoomOut.js","Mapabc/Control/ZoomPanel.js","Mapabc/Control/EditingToolbar.js","Mapabc/Lang.js","Mapabc/Lang/en.js");var b=navigator.userAgent;if(b=b.match("MSIE")||b.match("Safari"))var c=new Array(a.length);for(var d=Mapabc._getScriptLocation()+"js/",e=0,f=a.length;e<f;e++)if(b)c[e]="<script src='"+d+a[e]+"'><\/script>";else{var g=document.createElement("script");
g.src=d+a[e];(document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body).appendChild(g)}b&&document.write(c.join(""))}})();Mapabc.VERSION_NUMBER="Mapabc 2.8 -- $Revision: 9492 $";
Mapabc.String={startsWith:function(a,b){return a.indexOf(b)==0},contains:function(a,b){return a.indexOf(b)!=-1},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){a=a.split("-");for(var b=a[0],c=1,d=a.length;c<d;c++){var e=a[c];b+=e.charAt(0).toUpperCase()+e.substring(1)}return b},format:function(a,b,c){b||(b=window);return a.replace(Mapabc.String.tokenRegEx,function(d,e){for(var f,g=e.split(/\.+/),h=0;h<g.length;h++){if(h==0)f=b;f=f[g[h]]}if(typeof f=="function")f=
c?f.apply(null,c):f();return typeof f=="undefined"?"undefined":f})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return Mapabc.String.numberRegEx.test(a)},numericIf:function(a){return Mapabc.String.isNumeric(a)?parseFloat(a):a}};if(!String.prototype.startsWith)String.prototype.startsWith=function(a){return Mapabc.String.startsWith(this,a)};
if(!String.prototype.contains)String.prototype.contains=function(a){return Mapabc.String.contains(this,a)};if(!String.prototype.trim)String.prototype.trim=function(){return Mapabc.String.trim(this)};if(!String.prototype.camelize)String.prototype.camelize=function(){return Mapabc.String.camelize(this)};
Mapabc.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;if(b>0)c=parseFloat(a.toPrecision(b));return c},format:function(a,b,c,d){b=typeof b!="undefined"?b:0;c=typeof c!="undefined"?c:Mapabc.Number.thousandsSeparator;d=typeof d!="undefined"?d:Mapabc.Number.decimalSeparator;if(b!=null)a=parseFloat(a.toFixed(b));var e=a.toString().split(".");if(e.length==1&&b==null)b=0;a=e[0];if(c)for(var f=/(-?[0-9]+)([0-9]{3})/;f.test(a);)a=a.replace(f,"$1"+c+"$2");if(b==0)b=a;
else{c=e.length>1?e[1]:"0";if(b!=null)c+=(new Array(b-c.length+1)).join("0");b=a+d+c}return b}};if(!Number.prototype.limitSigDigs)Number.prototype.limitSigDigs=function(a){return Mapabc.Number.limitSigDigs(this,a)};Mapabc.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}}};
if(!Function.prototype.bind)Function.prototype.bind=function(){Array.prototype.unshift.apply(arguments,[this]);return Mapabc.Function.bind.apply(null,arguments)};if(!Function.prototype.bindAsEventListener)Function.prototype.bindAsEventListener=function(a){return Mapabc.Function.bindAsEventListener(this,a)};
Mapabc.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if(typeof b!="function")throw new TypeError;for(var f=0;f<e;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}};
Mapabc.Class=function(){for(var a=function(){arguments&&arguments[0]!=Mapabc.Class.isPrototype&&this.initialize.apply(this,arguments)},b={},c,d=0,e=arguments.length;d<e;++d){if(typeof arguments[d]=="function"){if(d==0&&e>1){c=arguments[d].prototype.initialize;arguments[d].prototype.initialize=function(){};b=new arguments[d];if(c===undefined)delete arguments[d].prototype.initialize;else arguments[d].prototype.initialize=c}c=arguments[d].prototype}else c=arguments[d];Mapabc.Util.extend(b,c)}a.prototype=
b;return a};Mapabc.Class.isPrototype=function(){};Mapabc.Class.create=function(){return function(){arguments&&arguments[0]!=Mapabc.Class.isPrototype&&this.initialize.apply(this,arguments)}};Mapabc.Class.inherit=function(){for(var a=new arguments[0](Mapabc.Class.isPrototype),b=1,c=arguments.length;b<c;b++){if(typeof arguments[b]=="function")arguments[b]=new arguments[b](Mapabc.Class.isPrototype);Mapabc.Util.extend(a,arguments[b])}return a};Mapabc.Util={};
Mapabc.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];if(typeof d=="string"||typeof d=="number")d=d?document.getElementById(d):"";if(arguments.length==1)return d;a.push(d)}return a};if(typeof window.$==="undefined")window.$=Mapabc.Util.getElement;
Mapabc.Util.extend=function(a,b){a=a||{};if(b){for(var c in b){var d=b[c];if(d!==undefined)a[c]=d}if(!(typeof window.Event=="function"&&b instanceof window.Event)&&b.hasOwnProperty&&b.hasOwnProperty("toString"))a.toString=b.toString}return a};Mapabc.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a};Mapabc.Util.clearArray=function(a){a.length=0};Mapabc.Util.indexOf=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1};
Mapabc.Util.includeBounds=function(a,b){var c=-1;if(a.left<b.lon&&a.top<b.lat&&a.right>b.lon&&a.bottom>b.lat)c=1;return c};Mapabc.Util.modifyDOMElement=function(a,b,c,d,e,f,g){if(b)a.id=b;if(c){a.style.left=c.x+"px";a.style.top=c.y+"px"}if(d){a.style.width=d.w+"px";a.style.height=d.h+"px"}if(e)a.style.position=e;if(f)a.style.border=f;if(g)a.style.overflow=g};
Mapabc.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");if(d)i.style.backgroundImage="url("+d+")";a||(a=Mapabc.Util.createUniqueID("MapabcDiv"));if(!e)if(a!="popup_titleDiv"&&a!="popup_contentDiv"&&a!="_THBorder"&&a!="_BHBorder"&&a!="popup_GroupDiv")e="absolute";Mapabc.Util.modifyDOMElement(i,a,b,c,e,f,g,h);return i};
Mapabc.Util.createImage=function(a,b,c,d,e,f,g,h){var i=document.createElement("img");a||(a=Mapabc.Util.createUniqueID("MapabcDiv"));e||(e="relative");Mapabc.Util.modifyDOMElement(i,a,b,c,e,f,null,g);if(h){i.style.display="none";Mapabc.Event.observe(i,"load",Mapabc.Function.bind(Mapabc.Util.onImageLoad,i));Mapabc.Event.observe(i,"error",Mapabc.Function.bind(Mapabc.Util.onImageLoadError,i))}i.style.alt=a;i.galleryImg="no";if(d)i.src=d;return i};
Mapabc.Util.setOpacity=function(a,b){Mapabc.Util.modifyDOMElement(a,null,null,null,null,null,null,b)};Mapabc.Util.onImageLoad=function(){if(!this.viewRequestID||this.map&&this.viewRequestID==this.map.viewRequestID){this.style.backgroundColor="transparent";this.style.display=""}};Mapabc.Util.onImageLoadErrorColor="transparent";Mapabc.IMAGE_RELOAD_ATTEMPTS=0;
Mapabc.Util.onImageLoadError=function(){this._attempts=this._attempts?this._attempts+1:1;if(this._attempts<=Mapabc.IMAGE_RELOAD_ATTEMPTS){var a=this.urls;if(a&&a instanceof Array&&a.length>1){var b=this.src.toString(),c,d;for(d=0;c=a[d];d++)if(b.indexOf(c)!=-1)break;var e=Math.floor(a.length*Math.random());e=a[e];for(d=0;e==c&&d++<4;){e=Math.floor(a.length*Math.random());e=a[e]}this.src=b.replace(c,e)}else this.src=this.src}else this.style.backgroundColor=Mapabc.Util.onImageLoadErrorColor;this.style.display=
""};Mapabc.Util.alphaHackNeeded=null;Mapabc.Util.alphaHack=function(){if(Mapabc.Util.alphaHackNeeded==null){var a=navigator.appVersion.split("MSIE");a=parseFloat(a[1]);var b=false;try{b=!!document.body.filters}catch(c){}Mapabc.Util.alphaHackNeeded=b&&a>=5.5&&a<7}return Mapabc.Util.alphaHackNeeded};
Mapabc.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){Mapabc.Util.modifyDOMElement(a,b,c,d,f,null,null,i);b=a.childNodes[0];if(e)b.src=e;Mapabc.Util.modifyDOMElement(b,a.id+"_innerImage",null,d,"relative",g);if(Mapabc.Util.alphaHack()){if(a.style.display!="none")a.style.display="inline-block";if(h==null)h="scale";if(Mapabc.Util.getElement(a.id+"_innerImage")){if(Mapabc.Util.getElement(a.id+"_innerImage")&&Mapabc.Util.getElement(a.id+"_innerImage")._eventCacheID){a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+
b.src+"', sizingMethod='"+h+"')";b.style.filter="alpha(opacity=0)"}}else{a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"', sizingMethod='"+h+"')";b.style.filter="alpha(opacity=0)"}if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1)a.style.filter+=" alpha(opacity="+a.style.opacity*100+")"}};
Mapabc.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=Mapabc.Util.createDiv(),k=Mapabc.Util.createImage(null,null,null,null,null,null,null,false);j.appendChild(k);if(i){k.style.display="none";Mapabc.Event.observe(k,"load",Mapabc.Function.bind(Mapabc.Util.onImageLoad,j));Mapabc.Event.observe(k,"error",Mapabc.Function.bind(Mapabc.Util.onImageLoadError,j))}Mapabc.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h);return j};
Mapabc.Util.upperCaseObject=function(a){var b={};for(var c in a)b[c.toUpperCase()]=a[c];return b};Mapabc.Util.applyDefaults=function(a,b){a=a||{};var c=typeof window.Event=="function"&&b instanceof window.Event;for(var d in b)if(a[d]===undefined||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))a[d]=b[d];if(!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString"))a.toString=b.toString;return a};
Mapabc.Util.getParameterString=function(a){var b=[];for(var c in a){var d=a[c];if(d!=null&&typeof d!="function"){if(typeof d=="object"&&d.constructor==Array){for(var e=[],f=0,g=d.length;f<g;f++)e.push(encodeURIComponent(d[f]));d=e.join(",")}else d=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+d)}}return b.join("&")};Mapabc.ImgPath="";Mapabc.Util.getImagesLocation=function(){return Mapabc.ImgPath||Mapabc._getScriptLocation()+"img/"};
Mapabc.Util.Try=function(){for(var a=null,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a};Mapabc.Util.getNodes=function(a,b){return Mapabc.Util.Try(function(){return Mapabc.Util._getNodes(a.documentElement.childNodes,b)},function(){return Mapabc.Util._getNodes(a.childNodes,b)})};Mapabc.Util._getNodes=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++)a[d].nodeName==b&&c.push(a[d]);return c};
Mapabc.Util.getTagText=function(a,b,c){if((a=Mapabc.Util.getNodes(a,b))&&a.length>0){c||(c=0);if(a[c].childNodes.length>1)return a.childNodes[1].nodeValue;else if(a[c].childNodes.length==1)return a[c].firstChild.nodeValue}else return""};Mapabc.Util.getXmlNodeValue=function(a){var b=null;Mapabc.Util.Try(function(){b=a.text;if(!b)b=a.textContent;if(!b)b=a.firstChild.nodeValue},function(){b=a.textContent});return b};
Mapabc.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&c!=null;)c=c.parentNode;return c!=b};Mapabc.Util.DEFAULT_PRECISION=14;Mapabc.Util.toFloat=function(a,b){if(b==null)b=Mapabc.Util.DEFAULT_PRECISION;return a=b==0?parseFloat(a):parseFloat(parseFloat(a).toPrecision(b))};Mapabc.Util.rad=function(a){return a*Math.PI/180};
Mapabc.Util.distVincenty=function(a,b){var c=1/298.257223563,d=Mapabc.Util.rad(b.lon-a.lon),e=Math.atan((1-c)*Math.tan(Mapabc.Util.rad(a.lat))),f=Math.atan((1-c)*Math.tan(Mapabc.Util.rad(b.lat))),g=Math.sin(e);e=Math.cos(e);var h=Math.sin(f);f=Math.cos(f);for(var i=d,j=2*Math.PI,k=20;Math.abs(i-j)>1.0E-12&&--k>0;){var l=Math.sin(i),m=Math.cos(i),n=Math.sqrt(f*l*f*l+(e*h-g*f*m)*(e*h-g*f*m));if(n==0)return 0;m=g*h+e*f*m;var o=Math.atan2(n,m),q=Math.asin(e*f*l/n),r=Math.cos(q)*Math.cos(q);l=m-2*g*h/
r;var p=c/16*r*(4+c*(4-3*r));j=i;i=d+(1-p)*c*Math.sin(q)*(o+p*n*(l+p*m*(-1+2*l*l)))}if(k==0)return NaN;c=r*2.723316066819453E11/4.0408299984087055E13;d=c/1024*(256+c*(-128+c*(74-47*c)));return(6356752.3142*(1+c/16384*(4096+c*(-768+c*(320-175*c))))*(o-d*n*(l+d/4*(m*(-1+2*l*l)-d/6*l*(-3+4*n*n)*(-3+4*l*l))))).toFixed(3)/1E3};
Mapabc.Util.getParameters=function(a){a=a||window.location.href;var b="";if(Mapabc.String.contains(a,"?")){b=a.indexOf("?")+1;var c=Mapabc.String.contains(a,"#")?a.indexOf("#"):a.length;b=a.substring(b,c)}a={};b=b.split(/[&;]/);c=0;for(var d=b.length;c<d;++c){var e=b[c].split("=");if(e[0]){var f=decodeURIComponent(e[0]);e=e[1]||"";e=e.split(",");for(var g=0,h=e.length;g<h;g++);if(e.length==1)e=e[0];a[f]=e}}return a};Mapabc.Util.getArgs=function(a){return Mapabc.Util.getParameters(a)};
Mapabc.Util.lastSeqID=0;Mapabc.Util.createUniqueID=function(a){if(a==null)a="id_";Mapabc.Util.lastSeqID+=1;return a+Mapabc.Util.lastSeqID};Mapabc.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};Mapabc.INCHES_PER_UNIT["in"]=Mapabc.INCHES_PER_UNIT.inches;Mapabc.INCHES_PER_UNIT.degrees=Mapabc.INCHES_PER_UNIT.dd;Mapabc.INCHES_PER_UNIT.nmi=1852*Mapabc.INCHES_PER_UNIT.m;Mapabc.METERS_PER_INCH=0.0254000508001016;
Mapabc.Util.extend(Mapabc.INCHES_PER_UNIT,{Inch:Mapabc.INCHES_PER_UNIT.inches,Meter:1/Mapabc.METERS_PER_INCH,Foot:0.3048006096012192/Mapabc.METERS_PER_INCH,IFoot:0.3048/Mapabc.METERS_PER_INCH,ClarkeFoot:0.3047972651151/Mapabc.METERS_PER_INCH,SearsFoot:0.30479947153867626/Mapabc.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/Mapabc.METERS_PER_INCH,IInch:0.0254/Mapabc.METERS_PER_INCH,MicroInch:2.54E-5/Mapabc.METERS_PER_INCH,Mil:2.54E-8/Mapabc.METERS_PER_INCH,Centimeter:0.01/Mapabc.METERS_PER_INCH,
Kilometer:1E3/Mapabc.METERS_PER_INCH,Yard:0.9144018288036576/Mapabc.METERS_PER_INCH,SearsYard:0.914398414616029/Mapabc.METERS_PER_INCH,IndianYard:0.9143985307444408/Mapabc.METERS_PER_INCH,IndianYd37:0.91439523/Mapabc.METERS_PER_INCH,IndianYd62:0.9143988/Mapabc.METERS_PER_INCH,IndianYd75:0.9143985/Mapabc.METERS_PER_INCH,IndianFoot:0.30479951/Mapabc.METERS_PER_INCH,IndianFt37:0.30479841/Mapabc.METERS_PER_INCH,IndianFt62:0.3047996/Mapabc.METERS_PER_INCH,IndianFt75:0.3047995/Mapabc.METERS_PER_INCH,Mile:1609.3472186944373/
Mapabc.METERS_PER_INCH,IYard:0.9144/Mapabc.METERS_PER_INCH,IMile:1609.344/Mapabc.METERS_PER_INCH,NautM:1852/Mapabc.METERS_PER_INCH,"Lat-66":110943.31648893273/Mapabc.METERS_PER_INCH,"Lat-83":110946.25736872235/Mapabc.METERS_PER_INCH,Decimeter:0.1/Mapabc.METERS_PER_INCH,Millimeter:0.0010/Mapabc.METERS_PER_INCH,Dekameter:10/Mapabc.METERS_PER_INCH,Decameter:10/Mapabc.METERS_PER_INCH,Hectometer:100/Mapabc.METERS_PER_INCH,GermanMeter:1.0000135965/Mapabc.METERS_PER_INCH,CaGrid:0.999738/Mapabc.METERS_PER_INCH,
ClarkeChain:20.1166194976/Mapabc.METERS_PER_INCH,GunterChain:20.11684023368047/Mapabc.METERS_PER_INCH,BenoitChain:20.116782494375872/Mapabc.METERS_PER_INCH,SearsChain:20.11676512155/Mapabc.METERS_PER_INCH,ClarkeLink:0.201166194976/Mapabc.METERS_PER_INCH,GunterLink:0.2011684023368047/Mapabc.METERS_PER_INCH,BenoitLink:0.20116782494375873/Mapabc.METERS_PER_INCH,SearsLink:0.2011676512155/Mapabc.METERS_PER_INCH,Rod:5.02921005842012/Mapabc.METERS_PER_INCH,IntnlChain:20.1168/Mapabc.METERS_PER_INCH,IntnlLink:0.201168/
Mapabc.METERS_PER_INCH,Perch:5.02921005842012/Mapabc.METERS_PER_INCH,Pole:5.02921005842012/Mapabc.METERS_PER_INCH,Furlong:201.1684023368046/Mapabc.METERS_PER_INCH,Rood:3.778266898/Mapabc.METERS_PER_INCH,CapeFoot:0.3047972615/Mapabc.METERS_PER_INCH,Brealey:375/Mapabc.METERS_PER_INCH,ModAmFt:0.304812252984506/Mapabc.METERS_PER_INCH,Fathom:1.8288/Mapabc.METERS_PER_INCH,"NautM-UK":1853.184/Mapabc.METERS_PER_INCH,"50kilometers":5E4/Mapabc.METERS_PER_INCH,"150kilometers":15E4/Mapabc.METERS_PER_INCH});
Mapabc.Util.extend(Mapabc.INCHES_PER_UNIT,{mm:Mapabc.INCHES_PER_UNIT.Meter/1E3,cm:Mapabc.INCHES_PER_UNIT.Meter/100,dm:Mapabc.INCHES_PER_UNIT.Meter*100,km:Mapabc.INCHES_PER_UNIT.Meter*1E3,kmi:Mapabc.INCHES_PER_UNIT.nmi,fath:Mapabc.INCHES_PER_UNIT.Fathom,ch:Mapabc.INCHES_PER_UNIT.IntnlChain,link:Mapabc.INCHES_PER_UNIT.IntnlLink,"us-in":Mapabc.INCHES_PER_UNIT.inches,"us-ft":Mapabc.INCHES_PER_UNIT.Foot,"us-yd":Mapabc.INCHES_PER_UNIT.Yard,"us-ch":Mapabc.INCHES_PER_UNIT.GunterChain,"us-mi":Mapabc.INCHES_PER_UNIT.Mile,
"ind-yd":Mapabc.INCHES_PER_UNIT.IndianYd37,"ind-ft":Mapabc.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/Mapabc.METERS_PER_INCH});Mapabc.DOTS_PER_INCH=72;Mapabc.Util.normalizeScale=function(a){return a>1?1/a:a};Mapabc.Util.getResolutionFromScale=function(a,b){if(b==null)b="degrees";return 1/(Mapabc.Util.normalizeScale(a)*Mapabc.INCHES_PER_UNIT[b]*Mapabc.DOTS_PER_INCH)};Mapabc.Util.getScaleFromResolution=function(a,b){if(b==null)b="degrees";return a*Mapabc.INCHES_PER_UNIT[b]*Mapabc.DOTS_PER_INCH};
Mapabc.Util.safeStopPropagation=function(a){Mapabc.Event.stop(a,true)};Mapabc.Util.pagePosition=function(a){for(var b=0,c=0,d=a,e=a;d;){if(d==document.body)if(Mapabc.Element.getStyle(e,"position")=="absolute")break;b+=d.offsetTop||0;c+=d.offsetLeft||0;e=d;try{d=d.offsetParent}catch(f){break}}for(d=a;d;){b-=d.scrollTop||0;c-=d.scrollLeft||0;d=d.parentNode}return[c,b]};
Mapabc.Util.isEquivalentUrl=function(a,b,c){c=c||{};Mapabc.Util.applyDefaults(c,{ignoreCase:true,ignorePort80:true,ignoreHash:true});a=Mapabc.Util.createUrlObject(a,c);b=Mapabc.Util.createUrlObject(b,c);for(var d in a)if(d!=="args")if(a[d]!=b[d])return false;for(d in a.args){if(a.args[d]!=b.args[d])return false;delete b.args[d]}for(d in b.args)return false;return true};
Mapabc.Util.createUrlObject=function(a,b){b=b||{};if(!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"";d=c.protocol+"//"+c.host.split(":").shift()+d;if(a.indexOf("/")===0)a=d+a;else{c=c.pathname.split("/");c.pop();a=d+c.join("/")+"/"+a}}if(b.ignoreCase)a=a.toLowerCase();c=document.createElement("a");c.href=a;d={};d.host=c.host.split(":").shift();d.protocol=c.protocol;d.port=b.ignorePort80?c.port=="80"||c.port=="0"?"":c.port:c.port==""||c.port=="0"?"80":c.port;d.hash=b.ignoreHash||
c.hash==="#"?"":c.hash;var e=c.search;if(!e){e=a.indexOf("?");e=e!=-1?a.substr(e):""}d.args=Mapabc.Util.getParameters(e);d.pathname=c.pathname.charAt(0)=="/"?c.pathname:"/"+c.pathname;return d};Mapabc.Util.removeTail=function(a){var b=null;b=a.indexOf("?");var c=a.indexOf("#");return b=b==-1?c!=-1?a.substr(0,c):a:c!=-1?a.substr(0,Math.min(b,c)):a.substr(0,b)};
Mapabc.Util.MChangeColor=function(a){a=a.toString(16);if(a.indexOf("#")==-1)switch(a.length){case 0:a="#000000";break;case 1:a="#00000"+a;break;case 2:a="#0000"+a;break;case 3:a="#000"+a;break;case 4:a="#00"+a;break;case 5:a="#0"+a;break;case 6:a="#"+a}return a};
Mapabc.Util.getBrowserName=function(){var a="",b=navigator.userAgent.toLowerCase();if(b.indexOf("opera")!=-1)a="opera";else if(b.indexOf("msie")!=-1)a="msie";else if(b.indexOf("safari")!=-1)a="safari";else if(b.indexOf("mozilla")!=-1)a=b.indexOf("firefox")!=-1?"firefox":"mozilla";return a};
Mapabc.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";var g=c&&c.containerElement?c.containerElement:document.body;if(b)if(b.w){d=b.w;f.style.width=d+"px"}else if(b.h){e=b.h;f.style.height=e+"px"}if(c&&c.displayClass)f.className=c.displayClass;b=document.createElement("div");b.innerHTML=a;b.style.overflow="visible";if(b.childNodes){a=0;for(c=b.childNodes.length;a<c;a++)if(b.childNodes[a].style)b.childNodes[a].style.overflow="visible"}f.appendChild(b);
g.appendChild(f);a=false;for(c=f.parentNode;c&&c.tagName.toLowerCase()!="body";){var h=Mapabc.Element.getStyle(c,"position");if(h=="absolute"){a=true;break}else if(h&&h!="static")break;c=c.parentNode}if(!a)f.style.position="absolute";if(!d){d=parseInt(b.scrollWidth);f.style.width=d+"px"}e||(e=parseInt(b.scrollHeight));f.removeChild(b);g.removeChild(f);return new Mapabc.Size(d,e)};
Mapabc.Util.getScrollbarWidth=function(){var a=Mapabc.Util._scrollbarWidth;if(a==null){var b=null,c=null;b=a=0;b=document.createElement("div");b.style.position="absolute";b.style.top="-1000px";b.style.left="-1000px";b.style.width="100px";b.style.height="50px";b.style.overflow="hidden";c=document.createElement("div");c.style.width="100%";c.style.height="200px";b.appendChild(c);document.body.appendChild(b);a=c.offsetWidth;b.style.overflow="scroll";b=c.offsetWidth;document.body.removeChild(document.body.lastChild);
Mapabc.Util._scrollbarWidth=a-b;a=Mapabc.Util._scrollbarWidth}return a};String.prototype.hLp=function(){for(var a=[],b=0;b<this.length;b++)a.push(this.charCodeAt(b));return a};
Mapabc.Util.Vqp={__KEYCOUNT__:256,__keys__:[[0,2,1,2,8,9,4,1,7,2,5,3,9],[0,3,2,2,9,5,8,2,6,8,4,6,3],[1,5,2,7,1,4,7,2,4,1,4,3,0],[0,7,8,3,4,9,0,6,7,7,4,4,2],[0,2,1,8,4,9,3,2,3,1,5,7,8],[0,0,9,5,4,7,3,0,8,7,5,2,8],[0,1,5,1,1,8,2,7,1,9,1,3,5],[0,5,2,5,6,0,3,4,6,7,1,3,5],[1,3,2,1,8,1,8,3,7,9,2,7,0],[1,2,7,7,4,3,1,5,5,0,6,4,4],[1,5,2,8,9,2,5,9,6,7,3,3,5],[1,7,9,4,5,0,9,4,9,6,1,9,9],[0,6,8,3,3,6,3,5,2,0,0,9,1],[1,1,1,4,7,8,6,9,6,8,8,4,6],[0,5,2,1,2,5,7,0,0,4,7,4,1],[0,7,6,4,2,3,9,0,7,8,5,6,7],[0,1,7,6,
0,5,4,7,6,7,7,5,7],[0,5,2,9,8,1,7,8,3,8,5,4,5],[0,4,3,1,2,8,3,7,0,9,4,8,8],[1,0,6,7,9,4,3,5,2,9,8,7,7],[1,6,4,4,6,7,1,4,4,2,6,7,5],[0,8,1,7,7,5,2,6,4,3,9,7,5],[1,7,0,5,6,2,5,2,7,4,6,2,8],[0,4,9,2,3,0,5,4,7,8,7,0,5],[1,1,0,5,1,7,2,8,7,2,6,9,3],[1,4,2,3,6,1,5,3,2,0,3,6,2],[1,1,6,5,1,0,6,8,9,7,1,7,9],[0,6,5,4,0,7,1,7,6,2,5,4,2],[1,9,8,6,6,6,8,4,5,4,0,4,0],[1,2,7,1,5,0,6,8,0,1,3,7,9],[1,1,6,4,9,8,6,0,6,2,1,9,8],[0,0,1,9,5,3,3,9,6,7,4,1,1],[0,2,8,5,7,8,6,7,3,3,1,6,4],[1,8,2,5,8,4,7,6,8,8,5,7,6],[0,8,3,
4,9,6,1,7,8,3,0,5,5],[1,3,2,6,7,4,2,8,7,4,9,6,8],[1,8,8,9,3,9,1,8,5,7,2,5,0],[0,5,8,3,1,8,8,0,3,9,3,8,1],[1,6,0,1,1,0,3,4,3,3,3,5,9],[1,0,5,1,7,9,6,2,4,6,0,3,5],[1,8,2,0,9,7,1,0,5,5,8,0,6],[1,8,9,6,7,3,9,4,1,9,6,6,2],[0,6,0,0,8,2,6,5,9,4,1,6,2],[1,7,9,7,9,4,4,2,1,1,5,7,4],[1,3,0,4,3,4,6,8,6,9,1,7,0],[0,1,2,3,9,4,1,8,7,2,2,9,8],[1,6,5,3,2,7,6,6,9,0,0,7,7],[1,6,8,4,9,7,8,0,3,6,5,4,8],[0,6,6,0,9,9,4,5,5,6,8,3,7],[1,0,1,3,4,0,0,1,4,8,5,7,0],[1,0,2,5,8,2,2,4,8,9,7,1,6],[1,4,2,6,6,8,4,5,6,6,4,5,9],[1,4,
4,1,7,2,0,4,6,3,3,6,7],[0,2,2,3,8,0,0,8,6,0,2,1,7],[0,9,4,4,8,1,2,7,3,2,6,8,0],[0,9,8,4,2,1,4,5,2,4,9,5,1],[0,7,2,4,7,4,3,2,4,1,5,6,9],[1,1,8,4,8,8,8,4,3,4,1,2,5],[0,3,2,7,5,7,0,2,7,4,5,3,5],[0,3,0,4,6,6,6,5,7,2,1,9,5],[1,5,6,0,1,3,2,7,3,0,9,8,6],[0,5,5,1,7,1,0,7,9,0,3,5,7],[0,5,4,9,7,9,7,3,8,0,1,6,3],[1,9,2,7,3,7,9,4,3,9,8,8,2],[0,3,1,8,9,0,9,0,4,5,5,0,9],[1,8,6,1,7,7,2,4,7,9,2,0,8],[0,6,1,2,7,1,4,8,4,1,1,6,0],[0,3,9,8,5,5,3,0,8,7,9,3,5],[0,8,4,3,7,3,1,8,2,9,1,4,7],[0,1,5,3,4,0,5,5,5,8,0,7,2],[0,
1,7,1,8,2,1,9,8,6,1,7,0],[0,7,1,6,9,7,2,7,2,4,4,3,6],[0,6,2,7,2,3,4,9,3,0,1,6,3],[0,2,9,1,9,9,9,1,9,5,4,4,4],[0,1,8,7,0,0,5,2,1,5,7,4,6],[1,9,0,8,7,3,3,5,5,4,9,0,1],[1,5,8,0,1,7,0,2,3,7,3,2,9],[1,3,2,0,5,2,7,5,0,2,6,8,1],[0,2,7,2,3,2,2,9,6,9,4,1,6],[1,6,4,7,9,6,5,9,5,8,2,7,1],[1,8,1,2,6,0,2,4,0,8,0,1,6],[1,6,2,4,1,2,4,1,7,2,7,0,6],[0,1,8,0,5,0,4,5,5,1,0,4,7],[0,8,7,6,4,3,5,5,7,8,4,9,0],[0,2,7,7,0,1,6,6,1,0,9,3,5],[0,7,6,9,8,3,8,6,2,9,3,7,0],[1,6,6,6,0,3,0,1,0,2,5,6,1],[0,0,4,5,1,0,9,4,4,9,4,0,9],
[0,1,6,9,4,7,5,7,8,3,5,7,0],[1,2,7,1,6,6,1,5,2,8,6,3,8],[1,9,1,6,7,5,1,7,4,7,6,1,8],[1,7,6,7,0,2,9,6,9,8,6,7,8],[0,9,8,7,3,8,1,5,2,5,2,7,5],[0,7,3,5,7,9,7,6,6,9,1,7,5],[1,6,7,3,4,4,7,6,2,6,6,2,3],[0,1,4,2,2,8,5,0,9,2,7,3,1],[0,1,4,2,1,0,0,2,1,8,9,8,3],[1,7,0,8,7,9,9,6,4,8,6,2,2],[1,9,3,9,9,8,7,0,8,1,1,7,3],[1,0,4,3,5,8,0,4,6,5,4,5,8],[0,4,8,0,5,2,3,2,3,9,4,2,3],[0,7,9,0,9,7,2,7,7,0,4,8,5],[1,6,5,5,3,3,2,6,1,3,4,7,1],[0,2,9,0,0,2,9,1,8,8,2,8,4],[1,3,2,5,0,6,2,5,3,3,6,1,1],[1,9,2,9,3,3,8,9,9,7,2,3,
7],[1,1,8,4,0,8,2,4,8,0,0,9,2],[1,5,2,6,0,6,1,3,0,4,7,3,8],[1,9,3,8,1,1,7,8,6,9,0,6,8],[1,3,2,7,7,2,2,4,2,5,8,3,0],[1,1,1,0,7,7,3,4,7,3,6,6,8],[0,9,4,2,8,9,4,8,4,3,2,5,3],[0,1,0,9,2,7,2,3,9,4,5,0,8],[1,0,4,5,8,4,0,0,5,2,2,1,2],[0,5,0,4,5,3,2,5,4,1,3,6,9],[1,3,0,2,7,8,1,7,7,3,5,5,9],[1,3,7,0,0,5,8,1,7,5,6,5,2],[1,8,1,9,9,9,4,8,6,0,7,7,3],[0,8,3,6,2,7,4,2,1,9,1,6,8],[0,4,4,4,2,6,0,4,0,1,5,1,7],[1,2,7,4,7,6,6,6,3,7,7,2,9],[0,9,8,9,3,3,3,9,0,7,4,2,3],[0,7,6,0,9,1,7,2,4,5,8,3,3],[1,6,1,5,5,3,1,3,2,1,0,
5,6],[0,6,2,4,1,6,6,3,4,9,2,7,0],[1,6,3,2,3,6,1,7,7,5,6,7,1],[1,0,4,9,2,3,3,6,2,6,9,3,2],[0,3,7,3,9,1,3,9,5,8,5,8,9],[1,9,0,0,3,0,9,1,2,7,8,0,3],[1,0,1,2,7,7,0,0,1,8,4,1,1],[0,0,5,5,9,6,9,8,1,2,1,7,2],[0,1,8,7,9,0,3,5,6,3,2,9,4],[1,3,1,5,7,5,0,8,5,3,2,5,0],[1,1,7,3,5,0,7,7,9,6,8,9,0],[0,7,7,0,9,4,2,8,8,0,2,2,0],[1,6,5,8,3,1,0,9,0,2,7,2,9],[1,3,5,8,4,7,6,3,1,4,3,4,7],[0,8,8,7,8,2,7,0,3,9,6,2,9],[1,1,6,2,6,7,5,2,5,0,8,5,5],[0,9,6,7,3,0,2,3,9,5,3,7,4],[1,5,2,7,3,6,0,8,3,3,9,0,3],[0,3,6,8,9,1,7,7,3,8,
7,3,8],[0,1,2,5,4,9,8,0,3,6,4,0,4],[1,2,4,1,6,8,1,5,8,3,6,4,3],[1,9,3,1,0,8,4,4,0,1,6,0,8],[0,4,5,1,0,2,1,7,1,6,1,3,3],[0,9,5,6,8,2,2,4,0,3,9,8,1],[1,9,3,5,4,3,1,2,2,2,0,8,7],[0,5,6,8,1,5,7,7,8,9,4,0,6],[1,0,4,6,4,6,7,4,6,0,3,6,2],[1,3,3,0,2,5,3,1,9,2,3,6,8],[0,6,9,6,3,6,9,6,2,1,5,0,7],[1,6,5,3,0,0,0,6,2,3,8,6,0],[1,0,7,1,2,0,3,0,3,0,8,8,0],[0,7,1,4,3,1,8,6,7,8,1,5,4],[0,6,3,5,5,4,8,9,4,8,3,1,7],[0,6,4,3,1,0,7,2,9,0,5,6,7],[0,6,3,7,7,0,6,8,6,7,4,6,0],[0,4,2,7,2,4,1,4,6,1,8,1,7],[1,1,7,9,0,7,0,5,1,
8,6,3,5],[1,2,0,2,7,2,7,9,1,2,7,0,3],[0,3,3,6,2,0,9,1,1,0,3,5,8],[1,4,0,9,9,2,5,6,5,6,8,0,5],[0,3,5,3,3,3,4,6,7,5,7,0,5],[0,5,8,8,5,8,5,4,7,0,5,7,3],[0,5,0,7,6,4,2,7,8,3,6,1,4],[0,4,7,8,6,5,3,7,7,5,7,0,7],[1,3,6,5,3,0,8,5,4,9,7,7,1],[1,4,8,2,8,2,8,3,4,9,4,6,7],[1,4,1,6,9,4,5,7,7,4,6,7,7],[0,2,8,2,3,0,7,7,1,0,1,1,0],[1,2,2,4,5,4,7,1,0,1,8,6,7],[0,0,7,2,4,7,2,8,2,4,4,3,9],[1,9,1,3,2,4,1,3,3,7,5,6,1],[1,4,7,4,6,8,6,7,4,4,1,2,8],[0,1,6,7,3,9,0,4,7,2,9,6,7],[0,1,3,9,1,1,1,1,6,3,0,1,1],[1,2,7,0,2,0,7,9,
7,2,1,5,2],[0,9,1,0,4,2,8,2,2,4,2,4,0],[1,1,7,9,7,9,3,0,5,3,4,5,2],[0,0,7,4,3,0,8,6,7,7,7,9,6],[0,7,0,4,0,6,7,6,3,2,0,7,1],[0,4,8,8,0,5,3,0,7,8,4,7,9],[0,6,3,3,3,6,6,3,7,0,4,8,3],[0,1,2,0,6,0,3,1,0,9,9,8,0],[0,7,0,3,8,2,5,0,7,5,0,0,4],[1,8,8,8,2,0,6,2,5,6,2,3,2],[1,6,2,5,8,0,1,9,7,3,7,6,0],[0,3,6,1,9,1,6,8,2,6,5,2,5],[0,3,9,7,8,9,4,5,4,8,5,5,1],[1,1,5,5,2,5,3,4,5,3,5,0,9],[1,0,9,4,9,6,1,7,0,0,6,0,1],[0,8,4,9,9,9,3,4,1,3,5,7,7],[0,7,8,0,0,3,5,5,9,4,1,8,1],[1,7,3,7,6,3,2,5,6,2,7,5,0],[0,0,2,6,0,6,6,
2,7,6,1,6,2],[1,1,6,4,7,7,9,7,0,6,2,6,6],[0,2,1,1,4,7,6,8,8,8,9,4,3],[0,0,8,7,5,1,9,3,1,9,8,6,0],[0,3,4,4,0,7,1,8,7,2,7,9,9],[1,0,4,5,3,6,0,6,6,6,4,1,5],[0,9,7,9,9,5,9,2,3,0,4,6,2],[1,6,5,2,7,2,1,3,5,2,5,2,1],[1,9,9,4,8,6,3,7,8,3,3,0,6],[0,8,2,6,6,7,8,2,1,3,2,9,2],[0,4,8,1,9,2,4,8,4,5,4,6,4],[1,1,7,0,7,3,5,1,4,9,5,3,1],[1,7,8,8,3,5,3,1,5,7,6,1,9],[1,4,5,6,5,3,2,5,3,0,3,5,5],[0,0,2,1,3,8,9,1,0,9,7,6,7],[0,0,7,6,1,9,1,9,5,8,9,4,0],[1,5,4,4,6,8,7,3,9,9,0,7,4],[1,3,0,4,8,1,2,3,9,7,1,9,5],[1,2,6,1,4,6,
9,4,7,1,1,2,6],[0,1,6,7,5,8,3,2,7,0,4,1,1],[1,6,2,7,8,7,6,8,7,2,0,3,3],[0,2,1,9,2,6,7,5,9,5,2,2,2],[0,5,2,0,4,7,7,3,8,1,5,0,9],[1,6,5,8,6,4,0,9,6,9,0,1,8],[1,2,0,8,7,9,2,4,4,0,9,8,9],[1,6,5,2,0,6,1,0,4,4,1,5,8],[1,5,4,2,5,6,2,5,6,2,2,9,5],[1,6,9,7,2,5,1,0,6,9,1,8,1],[0,0,3,9,9,0,6,7,9,5,7,4,6],[1,5,8,9,9,0,6,7,9,7,9,6,1],[1,3,6,4,6,3,6,8,4,5,2,8,3],[0,7,4,8,4,9,7,8,0,0,1,2,2],[0,4,2,9,1,3,8,8,3,0,0,9,8],[1,9,0,9,2,1,2,9,3,6,5,3,2],[1,1,0,2,0,5,9,9,5,4,7,8,9],[1,6,0,5,9,9,1,9,0,5,4,7,1],[1,0,4,0,0,
3,2,4,1,6,4,6,5],[1,7,3,7,3,3,7,6,1,7,7,8,6],[0,9,1,7,3,5,1,8,9,3,8,6,2],[1,4,9,9,3,7,5,4,4,4,4,4,0],[0,3,7,7,4,3,6,1,1,3,5,1,6],[0,8,5,4,3,9,3,3,1,3,4,8,1],[1,6,1,9,4,6,4,6,4,5,2,1,5],[1,1,1,6,8,3,9,1,1,3,0,9,9],[0,5,1,6,8,4,8,8,2,4,4,9,2],[0,2,3,0,1,4,2,7,1,9,9,0,6],[0,8,4,2,5,1,4,9,5,2,0,4,3],[0,9,1,2,5,0,6,6,5,0,3,1,8],[1,7,8,7,1,7,4,6,3,3,3,3,9],[0,3,7,2,9,4,1,5,4,7,2,1,0],[1,2,8,1,1,6,4,7,8,2,0,5,2],[1,8,3,5,4,8,0,9,7,8,0,1,8],[1,7,9,9,0,4,5,7,2,9,0,1,9],[0,6,6,5,6,7,0,4,0,7,8,5,1],[0,6,0,6,
3,1,1,5,0,9,2,2,3],[1,6,3,5,6,7,1,6,6,9,7,4,9],[0,9,5,9,8,2,4,3,3,2,3,5,6],[0,1,6,3,8,9,9,2,8,2,5,8,6],[1,4,7,6,6,5,7,3,3,3,4,1,1],[1,8,2,9,0,3,8,6,8,3,3,7,3],[0,2,8,4,8,5,4,8,9,5,0,5,7]],__maskKeyLength__:13,__getKeyNum__:function(a){a=a.substring(a.length-4,a.length).hLp();var b=0;b|=a[0]&3;b|=(a[1]&3)<<2;b|=(a[2]&3)<<4;b|=(a[3]&3)<<6;return b-0},getCoordinate:function(a){var b=this.__keys__[this.__getKeyNum__(a)];a=a.substring(0,a.length-4);var c=0;switch(b[0]){case 0:c=23;break;case 1:c=53;break}a=
a.hLp();for(var d=0;d<a.length;d++){a[d]-=c;a[d]-=b[d+1]}b=[];for(c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return a=b.join("")},transformer:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=isNaN(a[c])?Mapabc.Util.Vqp.getCoordinate(a[c]):a[c];return b}};
Mapabc.Util.encodeNumber=function(a,b){a=Mapabc.Util.precision(a,6);var c=Mapabc.Util.Vqp.__keys__[b],d=Mapabc.Util.getBytes(""+a),e=0;switch(Number(c[0])){case 0:e=23;break;case 1:e=53;break}var f=0;for(f=0;f<d.length&&f<c.length-2;f++)d[f]+=c[f+1]+e;c=Mapabc.Util.getNum(d,f);c+=Mapabc.Util.getVernumString(b);return c};Mapabc.Util.precision=function(a,b){var c=Math.pow(10,b);a=Math.round(a*c)/c;var d=String(a),e=d.indexOf(".");c=d.substr(e+1,b);d=d.substr(0,e+1);return Number(d+c)};
Mapabc.Util.getBytes=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);b.push(d)}return b};Mapabc.Util.getNum=function(a,b){for(var c="",d=0;d<b;d++)c+=String.fromCharCode(Number(a[d]));return c};Mapabc.Util.getVernumString=function(a){for(var b=[],c=0;c<4;c++){b[c]=Math.round(Math.random()*10);b[c]+=70;b[c]>>=2;b[c]<<=2}b[0]|=a&3;b[1]|=(a&12)>>2;b[2]|=(a&48)>>4;b[3]|=(a&192)>>6;return Mapabc.Util.getNum(b,4)};
Mapabc.Util.getCoord=function(a){var b=[];if(a.lngX.toString()!="NaN"&&a.latY.toString()!="NaN"){if(isNaN(a.lngX)||isNaN(a.lngX))b=Mapabc.Util.Vqp.transformer([a.lngX,a.latY]);return new MLngLat(b[0],b[1],109)}return new MLngLat(0,0,109)};
Mapabc.Util.getCoordArr=function(a){var b=a.length;if(b<1)return null;for(var c=[],d=0;d<b;d++){if(isNaN(a[d].lngX)||isNaN(a[d].latY)){coor=Mapabc.Util.Vqp.transformer([a[d].lngX,a[d].latY]);lng=parseFloat(coor[0]);lat=parseFloat(coor[1])}c.push(new MLngLat(lng,lat,109))}return c};
Mapabc.Util.getOffXY=function(a,b){var c=new MPoint(0,0),d=b.w,e=b.h;switch(a){case TOP_LEFT:c.x=0;c.y=0;break;case TOP_CENTER:c.x=d/2;c.y=0;break;case TOP_RIGHT:c.x=d;c.y=0;break;case MIDDLE_LEFT:c.x=0;c.y=e/2;break;case MIDDLE_CENTER:c.x=d/2;c.y=e/2;break;case MIDDLE_RIGHT:c.x=d;c.y=e/2;break;case BOTTOM_LEFT:c.x=0;c.y=e;break;case BOTTOM_CENTER:c.x=d/2;c.y=e;break;case BOTTOM_RIGHT:c.x=d;c.y=e;break}return c};
Mapabc.Util.getStringAling=function(a){var b="";switch(a){case TOP_LEFT:b="lt";break;case TOP_CENTER:b="ct";break;case TOP_RIGHT:b="rt";break;case MIDDLE_LEFT:b="lm";break;case MIDDLE_CENTER:b="cm";break;case MIDDLE_RIGHT:b="rm";break;case BOTTOM_LEFT:b="lb";break;case BOTTOM_CENTER:b="mb";break;case BOTTOM_RIGHT:b="rb";break}return b};Mapabc.Rico={};
Mapabc.Rico.Corner={round:function(a,b){a=Mapabc.Util.getElement(a);this._setOptions(b);var c=this.options.color;if(this.options.color=="fromElement")c=this._background(a);var d=this.options.bgColor;if(this.options.bgColor=="fromParent")d=this._background(a.offsetParent);this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName("span"),d=0;d<c.length;d++)c[d].style.backgroundColor=b},changeOpacity:function(a,b){var c="alpha(opacity="+
b*100+")";a.style.opacity=b;a.style.filter=c;for(var d=a.parentNode.getElementsByTagName("span"),e=0;e<d.length;e++){d[e].style.opacity=b;d[e].style.filter=c}},reRound:function(a,b){var c=a.parentNode.childNodes[2];a.parentNode.removeChild(a.parentNode.childNodes[0]);a.parentNode.removeChild(c);this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c);this._isTopRounded()&&this._roundTopCorners(a,b,c);this._isBottomRounded()&&this._roundBottomCorners(a,
b,c)},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b);a.innerHTML="<div "+("style='"+("border-left: "+c)+";"+("border-right: "+c)+"'")+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,"top"));a.style.paddingTop=0;a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;e>=0;e--)d.appendChild(this._createCornerSlice(b,
c,e,"bottom"));a.style.paddingBottom=0;a.appendChild(d)},_createCorner:function(a){var b=document.createElement("div");b.style.backgroundColor=this._isTransparent()?"transparent":a;return b},_createCornerSlice:function(a,b,c,d){var e=document.createElement("span"),f=e.style;f.backgroundColor=a;f.display="block";f.height="1px";f.overflow="hidden";f.fontSize="1px";a=this._borderColor(a,b);if(this.options.border&&c==0){f.borderTopStyle="solid";f.borderTopWidth="1px";f.borderLeftWidth="0px";f.borderRightWidth=
"0px";f.borderBottomWidth="0px";f.height="0px";f.borderColor=a}else if(a){f.borderColor=a;f.borderStyle="solid";f.borderWidth="0px 1px"}if(!this.options.compact&&c==this.options.numSlices-1)f.height="2px";this._setMargin(e,c,d);this._setBorder(e,c,d);return e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};Mapabc.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent())this.options.blend=
false},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top"))return"";if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0)return"";if(this.options.corners.indexOf("tl")>=0)return"left";else if(this.options.corners.indexOf("tr")>=0)return"right";return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom"))return"";if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0)return"";if(this.options.corners.indexOf("bl")>=
0)return"left";else if(this.options.corners.indexOf("br")>=0)return"right";return""},_borderColor:function(a,b){return a=="transparent"?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):""},_setMargin:function(a,b,c){b=this._marginSize(b);c=c=="top"?this._whichSideTop():this._whichSideBottom();if(c=="left"){a.style.marginLeft=b+"px";a.style.marginRight="0px"}else if(c=="right"){a.style.marginRight=b+"px";a.style.marginLeft="0px"}else{a.style.marginLeft=b+"px";a.style.marginRight=
b+"px"}},_setBorder:function(a,b,c){b=this._borderSize(b);c=c=="top"?this._whichSideTop():this._whichSideBottom();if(c=="left"){a.style.borderLeftWidth=b+"px";a.style.borderRightWidth="0px"}else if(c=="right"){a.style.borderRightWidth=b+"px";a.style.borderLeftWidth="0px"}else{a.style.borderLeftWidth=b+"px";a.style.borderRightWidth=b+"px"}if(this.options.border!=false){a.style.borderLeftWidth=b+"px";a.style.borderRightWidth=b+"px"}},_marginSize:function(a){if(this._isTransparent())return 0;var b=[5,
3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&&this.options.blend?e[a]:this.options.compact?d[a]:this.options.blend?c[a]:b[a]},_borderSize:function(a){var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent()))return 1;else if(this.options.compact)return d[a];else if(this.options.blend)return c[a];else if(this.options.border)return e[a];else if(this._isTransparent())return b[a];return 0},_hasString:function(a){for(var b=1;b<
arguments.length;b++)if(a.indexOf(arguments[b])>=0)return true;return false},_blend:function(a,b){var c=Mapabc.Rico.Color.createFromHex(a);c.blend(Mapabc.Rico.Color.createFromHex(b));return c},_background:function(a){try{return Mapabc.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,
"all","bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};
(function(){if(!(window.google&&google.gears)){var a=null;if(typeof GearsFactory!="undefined")a=new GearsFactory;else try{a=new ActiveXObject("Gears.Factory");a.getBuildInfo().indexOf("ie_mobile")!=-1&&a.privateSetGlobalObject(this)}catch(b){if(typeof navigator.mimeTypes!="undefined"&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}if(a){window.google||
(google={});if(!google.gears)google.gears={factory:a}}}})();
Mapabc.Bounds=Mapabc.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){if(a!=null)this.left=Mapabc.Util.toFloat(a);if(b!=null)this.bottom=Mapabc.Util.toFloat(b);if(c!=null)this.right=Mapabc.Util.toFloat(c);if(d!=null)this.top=Mapabc.Util.toFloat(d)},clone:function(){return new Mapabc.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=false;if(a!=null)b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom;
return b},toString:function(){return"left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")"},toArray:function(){return[this.left,this.bottom,this.right,this.top]},toBBOX:function(a){if(a==null)a=6;a=Math.pow(10,a);return Math.round(this.left*a)/a+","+Math.round(this.bottom*a)/a+","+Math.round(this.right*a)/a+","+Math.round(this.top*a)/a},toGeometry:function(){return new Mapabc.Geometry.Polygon([new Mapabc.Geometry.LinearRing([new Mapabc.Geometry.Point(this.left,this.bottom),
new Mapabc.Geometry.Point(this.right,this.bottom),new Mapabc.Geometry.Point(this.right,this.top),new Mapabc.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new Mapabc.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new Mapabc.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat)this.centerLonLat=new Mapabc.LonLat((this.left+
this.right)/2,(this.bottom+this.top)/2);return this.centerLonLat},scale:function(a,b){if(b==null)b=this.getCenterLonLat();var c,d;if(b.CLASS_NAME=="Mapabc.LonLat"){c=b.lon;d=b.lat}else{c=b.x;d=b.y}return new Mapabc.Bounds((this.left-c)*a+c,(this.bottom-d)*a+d,(this.right-c)*a+c,(this.top-d)*a+d)},add:function(a,b){if(a==null||b==null){Mapabc.i18n("boundsAddError");return null}return new Mapabc.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case "Mapabc.LonLat":b=
new Mapabc.Bounds(a.lon,a.lat,a.lon,a.lat);break;case "Mapabc.Geometry.Point":b=new Mapabc.Bounds(a.x,a.y,a.x,a.y);break;case "Mapabc.Bounds":b=a;break}if(b){this.centerLonLat=null;if(this.left==null||b.left<this.left)this.left=b.left;if(this.bottom==null||b.bottom<this.bottom)this.bottom=b.bottom;if(this.right==null||b.right>this.right)this.right=b.right;if(this.top==null||b.top>this.top)this.top=b.top}}},containsLonLat:function(a,b){return this.contains(a.lon,a.lat,b)},containsPixel:function(a,
b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(c==null)c=true;if(a==null||b==null)return false;a=Mapabc.Util.toFloat(a);b=Mapabc.Util.toFloat(b);var d=false;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){if(b==null)b=true;var c=false,d=this.left==a.right||this.right==a.left||this.top==a.bottom||this.bottom==a.top;if(b||!d){c=a.top>=this.bottom&&a.top<=this.top||this.top>a.bottom&&
this.top<a.top;d=a.left>=this.left&&a.left<=this.right||this.left>=a.left&&this.left<=a.right;var e=a.right>=this.left&&a.right<=this.right||this.right>=a.left&&this.right<=a.right;c=(a.bottom>=this.bottom&&a.bottom<=this.top||this.bottom>=a.bottom&&this.bottom<=a.top||c)&&(d||e)}return c},containsBounds:function(a,b,c){if(b==null)b=false;if(c==null)c=true;var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c);a=this.contains(a.right,a.top,c);return b?
d||e||f||a:d&&e&&f&&a},determineQuadrant:function(a){var b="",c=this.getCenterLonLat();b+=a.lat<c.lat?"b":"t";b+=a.lon<c.lon?"l":"r";return b},transform:function(a,b){this.centerLonLat=null;var c=Mapabc.Projection.transform({x:this.left,y:this.bottom},a,b),d=Mapabc.Projection.transform({x:this.right,y:this.bottom},a,b),e=Mapabc.Projection.transform({x:this.left,y:this.top},a,b),f=Mapabc.Projection.transform({x:this.right,y:this.top},a,b);this.left=Math.min(c.x,e.x);this.bottom=Math.min(c.y,d.y);this.right=
Math.max(d.x,f.x);this.top=Math.max(e.y,f.y);return this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(;e.left<a.left&&e.right-d<=a.left;)e=e.add(a.getWidth(),0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-a.getWidth(),0)}return e},CLASS_NAME:"Mapabc.Bounds"});Mapabc.Bounds.fromString=function(a){a=a.split(",");return Mapabc.Bounds.fromArray(a)};
Mapabc.Bounds.fromArray=function(a){return new Mapabc.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};Mapabc.Bounds.fromSize=function(a){return new Mapabc.Bounds(0,a.h,a.w,0)};Mapabc.Bounds.oppositeQuadrant=function(a){var b="";b+=a.charAt(0)=="t"?"b":"t";b+=a.charAt(1)=="l"?"r":"l";return b};
Mapabc.Element={visible:function(a){return Mapabc.Util.getElement(a).style.display!="none"},toggle:function(){for(var a=0,b=arguments.length;a<b;a++){var c=Mapabc.Util.getElement(arguments[a]),d=Mapabc.Element.visible(c)?"hide":"show";Mapabc.Element[d](c)}},hide:function(){for(var a=0,b=arguments.length;a<b;a++)Mapabc.Util.getElement(arguments[a]).style.display="none"},show:function(){for(var a=0,b=arguments.length;a<b;a++)Mapabc.Util.getElement(arguments[a]).style.display=""},remove:function(a){(a=
Mapabc.Util.getElement(a))&&a.parentNode&&a.parentNode.removeChild(a)},getHeight:function(a){a=Mapabc.Util.getElement(a);return a.offsetHeight},getDimensions:function(a){a=Mapabc.Util.getElement(a);if(Mapabc.Element.getStyle(a,"display")!="none")return{width:a.offsetWidth,height:a.offsetHeight};var b=a.style,c=b.visibility,d=b.position;b.visibility="hidden";b.position="absolute";b.display="";var e=a.clientWidth;a=a.clientHeight;b.display="none";b.position=d;b.visibility=c;return{width:e,height:a}},
hasClass:function(a,b){var c=a.className;return!!c&&(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(c)},addClass:function(a,b){Mapabc.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b);return a},removeClass:function(a,b){var c=a.className;if(c)a.className=Mapabc.String.trim(c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "));return a},toggleClass:function(a,b){Mapabc.Element.hasClass(a,b)?Mapabc.Element.removeClass(a,b):Mapabc.Element.addClass(a,b);return a},getStyle:function(a,b){a=Mapabc.Util.getElement(a);
var c=null;if(a&&a.style){c=a.style[Mapabc.String.camelize(b)];if(!c)if(document.defaultView&&document.defaultView.getComputedStyle)c=(c=document.defaultView.getComputedStyle(a,null))?c.getPropertyValue(b):null;else if(a.currentStyle)c=a.currentStyle[Mapabc.String.camelize(b)];var d=["left","top","right","bottom"];if(window.opera&&Mapabc.Util.indexOf(d,b)!=-1&&Mapabc.Element.getStyle(a,"position")=="static")c="auto"}return c=="auto"?null:c}};
Mapabc.LonLat=Mapabc.Class({lon:0,lat:0,initialize:function(a,b){this.lon=Mapabc.Util.toFloat(a);this.lat=Mapabc.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new Mapabc.LonLat(this.lon,this.lat)},add:function(a,b){if(a==null||b==null){Mapabc.i18n("lonlatAddError");return null}return new Mapabc.LonLat(this.lon+a,this.lat+b)},equals:function(a){var b=false;if(a!=null)b=this.lon==a.lon&&this.lat==
a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat);return b},transform:function(a,b){var c=Mapabc.Projection.transform({x:this.lon,y:this.lat},a,b);this.lon=c.x;this.lat=c.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"Mapabc.LonLat"});Mapabc.LonLat.fromString=function(a){a=a.split(",");return new Mapabc.LonLat(parseFloat(a[0]),parseFloat(a[1]))};
Mapabc.Pixel=Mapabc.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new Mapabc.Pixel(this.x,this.y)},equals:function(a){var b=false;if(a!=null)b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y);return b},add:function(a,b){if(a==null||b==null){Mapabc.i18n("pixelAddError");return null}return new Mapabc.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();
if(a)b=this.add(a.x,a.y);return b},CLASS_NAME:"Mapabc.Pixel"});Mapabc.Size=Mapabc.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new Mapabc.Size(this.w,this.h)},equals:function(a){var b=false;if(a!=null)b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h);return b},CLASS_NAME:"Mapabc.Size"});
Mapabc.Control=Mapabc.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("Mapabc.","ol").replace(/\./g,"");Mapabc.Util.extend(this,a);this.events=new Mapabc.Events(this,null,this.EVENT_TYPES);this.eventListeners instanceof Object&&this.events.on(this.eventListeners);if(this.id==null)this.id=Mapabc.Util.createUniqueID(this.CLASS_NAME+
"_")},destroy:function(){if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"&&this.handlers[a].destroy();this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}},setMap:function(a){this.map=a;this.handler&&this.handler.setMap(a)},
draw:function(a){if(this.div==null){this.div=Mapabc.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=function(){return false}}if(this.title!="")this.div.title=this.title}if(a!=null)this.position=a.clone();this.moveTo(this.position);return this.div},moveTo:function(a){if(a!=null&&this.div!=null){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},
activate:function(){if(this.active)return false;this.handler&&this.handler.activate();this.active=true;this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){this.handler&&this.handler.deactivate();this.active=false;this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"Mapabc.Control"});Mapabc.Control.TYPE_BUTTON=1;Mapabc.Control.TYPE_TOGGLE=2;Mapabc.Control.TYPE_TOOL=3;
Mapabc.Icon=Mapabc.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a;this.size=b?b?b:new Mapabc.Size(20,20):null;this.offset=c?c?c:new Mapabc.Pixel(-(this.size.w/2),-(this.size.h/2)):new Mapabc.Pixel(0,0);this.calculateOffset=d;a=Mapabc.Util.createUniqueID("OL_Icon_");this.imageDiv=Mapabc.Util.createAlphaImageDiv(a)},destroy:function(){this.erase();Mapabc.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML=
"";this.imageDiv=null},clone:function(){return new Mapabc.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){if(a!=null)this.size=a;this.draw()},setUrl:function(a){if(a!=null)this.url=a;this.draw()},draw:function(a){Mapabc.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},erase:function(){this.imageDiv!=null&&this.imageDiv.parentNode!=null&&Mapabc.Element.remove(this.imageDiv)},setOpacity:function(a){Mapabc.Util.modifyAlphaImageDiv(this.imageDiv,
null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null)this.px=a;if(this.imageDiv!=null)if(this.px==null)this.display(false);else{if(this.calculateOffset)this.offset=this.calculateOffset(this.size);a=this.px.offset(this.offset);Mapabc.Util.modifyAlphaImageDiv(this.imageDiv,null,a)}},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&this.imageDiv.parentNode.nodeType!=11},CLASS_NAME:"Mapabc.Icon"});
Mapabc.Popup=Mapabc.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,titleHTML:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",boxcontent:null,titleDiv:null,contentDiv:null,bubble:null,tipType:null,overlayType:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number")this.padding=new Mapabc.Bounds(this.padding,
this.padding,this.padding,this.padding)},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,tipOption:null,saveOverlayId:null,offset:null,MapEventList:null,overlayId:null,closeBox:null,overlay:null,initialize:function(a,b,c,d,e,f,g,h,i,j){if(a==null)a=Mapabc.Util.createUniqueID(this.CLASS_NAME+"_");this.id=a;this.lonlat=b;this.tipOption=d;this.offset=g;this.MapEventList=h;this.saveOverlayId=this.overlayId=i;this.closeBox=e;this._contentSize=c;this.closeBoxCallback=f;this.overlayType=
j;if(parseInt(this.tipOption.tipWidth)<150)this.tipOption.tipWidth="150px";if(g)if(parseInt(this.tipOption.tipWidth)>g.map.getSize().w-80)this.tipOption.tipWidth=g.map.getSize().w-80+"px";this.div=Mapabc.Util.createDiv(this.id,null,null,null,null,null,"visible");this.div.className=this.displayClass;if(d.tipType==1)this.createDivTip(d);else if(d.tipType==2){if(d.content!=null)this.div.innerHTML=d.content;if(this.div.firstChild){a=this.div.firstChild.style.width;d=this.div.firstChild.style.height}else{a=
d.tipWidth;d=d.tipHeight}this.contentSize=c!=null?c:new Mapabc.Size(a,d)}else if(d.tipType==3){if(parseInt(this.tipOption.tipWidth)>700)this.tipOption.tipHeight="700px";if(parseInt(this.tipOption.tipHeight)>700)this.tipOption.tipHeight="700px";this.createImgTip(d)}this.registerEvents()},createImgTip:function(a){this.groupDiv=Mapabc.Util.createDiv(this.id+"_GroupDiv");this.groupDiv.className="MAME_img_mapTip";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.setAttribute("jstype",
"img");var b="";if(a.titleFontStyle.bold)b="bold";var c="";if(a.contentFontStyle.bold)c="bold";var d="";d=a.titleFontStyle.color=="0xffffff"?"#000":Mapabc.Util.MChangeColor(a.titleFontStyle.color);var e="";e=a.contentFontStyle.color=="0xffffff"?"#000":Mapabc.Util.MChangeColor(a.contentFontStyle.color);if(isNaN(a.contentFontStyle.size)){if(a.contentFontStyle.size=="xx-large"||a.contentFontStyle.size=="x-large")a.contentFontStyle.size="large"}else if(a.contentFontStyle.size>25){var f=29;a.contentFontStyle.size=
"25px"}else{f=a.contentFontStyle.size+4;a.contentFontStyle.size+="px"}if(isNaN(a.titleFontStyle.size)){if(a.titleFontStyle.size=="xx-large"||a.titleFontStyle.size=="x-large")a.titleFontStyle.size="large"}else if(a.titleFontStyle.size>25)a.titleFontStyle.size="25px";else a.titleFontStyle.size+="px";var g=[];g.push("<table cellpadding=0 cellspacing=0 border=0 >");g.push("<tr><td class='MAME_img_westNorth' style='background:url("+Mapabc.Util.getImagesLocation()+"back_img.gif) no-repeat 0 0'></td><td style='background:url("+
Mapabc.Util.getImagesLocation()+"back_img.gif) no-repeat -9px 0px'></td>");g.push('<td class="MAME_img_eastNorth" style="background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat -721px 0"></td></tr>');g.push('<tr><td class="MAME_img_verticalL" style="background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat 0px -10px">&nbsp;&nbsp;&nbsp;</td>');g.push('<td valign="top"><div class="MAME_img_cont" id="'+this.id+'_boxcontent" >');g.push("<table cellpadding=0 cellspacing=0 border=0>");
g.push('<tr><td valign="top"><span id="'+this.id+'_titleDiv" class="MAME_img_span" style="width:'+(parseInt(a.tipWidth)-55)+"px;font-size: "+a.titleFontStyle.size+"; color:"+d+"; font-weight:"+b+"; font-family:"+a.titleFontStyle.name+';">'+a.title+"</span>&nbsp;");g.push('<span  id="'+this.id+'_close" style="cursor:pointer;background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat -36px -725px;width:17px;height:17px;position:relative;right:0;float:right;_margin-top:-17px;"></span></td></tr>');
g.push('<tr><td><div id="'+this.id+'_contentDiv" style="margin-bottom:10px;overflow:auto;width:'+(parseInt(a.tipWidth)-20)+"px;height:"+(parseInt(a.tipHeight)-81)+"px; line-height:"+f+"px;font-size: "+a.contentFontStyle.size+"; color:"+e+"; font-weight:"+c+"; font-family:"+a.contentFontStyle.name+';">'+a.content+"</div></td></tr>");g.push("</table></div></td>");g.push('<td class="MAME_img_verticalR" style="background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat -721px -15px">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>');
g.push('<tr><td class="MAME_img_westSouth" style="background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat 0 -710px"></td>');g.push('<td class="MAME_img_horizontalB" style="background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat -9px -710px"></td><td style="background:url('+Mapabc.Util.getImagesLocation()+'back_img.gif) no-repeat -721px -710px"></td></tr>');g.push("<tr><td colspan=3>");g.push("</td></tr></table>");this.arrow=Mapabc.Util.createDiv(this.id+"_bar",
null,null,null,"absolute");this.arrow.id=this.id+"_Bar";this.arrow.className="MAME_img_arrow";this.arrow.style.background="url("+Mapabc.Util.getImagesLocation()+"back_img.gif)  no-repeat  0px -724px";this.groupDiv.innerHTML=g.join("");this.groupDiv.appendChild(this.arrow);this.div.appendChild(this.groupDiv)},createDivTip:function(a){this.contentSize=this._contentSize!=null?this._contentSize:new Mapabc.Size(a.tipWidth,a.tipHeight);if(a.content!=null){if(isNaN(a.contentFontStyle.size)){if(a.contentFontStyle.size==
"xx-large"||a.contentFontStyle.size=="x-large")a.contentFontStyle.size="large"}else if(a.contentFontStyle.size>25)a.contentFontStyle.size="25px";else a.contentFontStyle.size+="px";var b="";if(a.contentFontStyle.bold)b="bold";this.contentHTML="<span style='font-size: "+a.contentFontStyle.size+"; color:"+Mapabc.Util.MChangeColor(a.contentFontStyle.color)+"; font-weight:"+b+"; font-family:"+a.contentFontStyle.name+"'>"+a.content+"</span>"}if(a.title!=null){if(isNaN(a.titleFontStyle.size)){if(a.titleFontStyle.size==
"xx-large"||a.titleFontStyle.size=="x-large")a.titleFontStyle.size="large"}else if(a.titleFontStyle.size>25)a.titleFontStyle.size="25px";else a.titleFontStyle.size+="px";b="";if(a.titleFontStyle.bold)b="bold";this.titleHTML="<span style='font-size: "+a.titleFontStyle.size+"; color:"+Mapabc.Util.MChangeColor(a.titleFontStyle.color)+"; font-weight:"+b+"; font-family:"+a.titleFontStyle.name+"'>"+a.title+"</span>"}this.backgroundColor=Mapabc.Popup.COLOR;this.opacity=Mapabc.Popup.OPACITY;this.border=Mapabc.Popup.BORDER;
this.groupDiv=Mapabc.Util.createDiv(this.id+"_GroupDiv");this.groupDiv.className="MAME_tip";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.setAttribute("jstype","div");this.groupDiv.setAttribute("jsoverlaytype",this.overlayType);this.boxcontent=Mapabc.Util.createDiv(this.div.id+"_boxcontent",null,null,null,"relative");this.boxcontent.className="MAME_cont";this.boxcontent.style.borderColor=Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color);b=0;b=parseInt(a.tipWidth)-
4;this.boxcontent.style.width=b+"px";this.boxcontent.style.opacity=this.tipOption.alpha;this.boxcontent.style.filter="alpha(opacity="+parseFloat(this.tipOption.alpha)*100+")";this.boxcontent.style.background=Mapabc.Util.MChangeColor(a.fillStyle.color);this.contentDiv=Mapabc.Util.createDiv(this.div.id+"_contentDiv",null,null,null,null,null,"auto");this.contentDiv.className="MAME_content";this.contentDiv.style.width=parseInt(this.contentSize.w)-4+"px";if(this.contentSize.h!=0&&this.contentSize.h>73)this.contentDiv.style.height=
this.contentSize.h-69+"px";this.titleDiv=Mapabc.Util.createDiv(this.div.id+"_titleDiv",null,null,null,null);this.titleDiv.className="MAME_title";this.titleDiv.style.background=Mapabc.Util.MChangeColor(a.titleFillStyle.color);this.boxcontent.appendChild(this.titleDiv);this.boxcontent.appendChild(this.contentDiv);this.groupDiv.appendChild(this.boxcontent);this.div.appendChild(this.groupDiv);this.closeBox&&this.addCloseBox(this.closeBoxCallback)},destroy:function(){this.border=this.opacity=this.backgroundColor=
this.contentHTML=this.size=this.lonlat=this.id=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;if(this.closeDiv){Mapabc.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;this.map!=null&&this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(a){if(!(this.tipOption.content==
""&&this.tipOption.title=="")){a==null&&this.lonlat!=null&&this.map!=null&&this.map.getLayerPxFromLonLat(this.lonlat);this.closeOnMove&&this.map.events.register("movestart",this,this.hide);!this.autoSize&&!this.size&&this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();return this.div}},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){if(a!=null&&
this.div!=null){var b=this.tipOption.tipAlign;if(b>9||b<1)b=8;if(this.tipOption.tipType==1&&this.overlayType=="_MARKER_"){b=Mapabc.Util.getElement(this.overlayId);if(!this.contentDiv)return;if(!b)return;if(this.lonlat&&this.map)a=this.map.getLayerPxFromLonLat(this.lonlat);a.x-=45;if(navigator.appVersion.indexOf("MSIE 6.0")!=-1){if(this.contentDiv)a.y=a.y-parseInt(this.contentDiv.offsetHeight)-77}else if(this.contentDiv)a.y=a.y-parseInt(this.contentDiv.offsetHeight)-65;b=this.offset.imageAlign;switch(b){case 1:var c=
a.y,d=a.x+this.offset.width/2;break;case 2:c=a.y;d=a.x;break;case 3:c=a.y;d=a.x-this.offset.width/2;break;case 4:c=a.y-this.offset.height/2;d=a.x+this.offset.width/2;break;case 5:c=a.y-this.offset.height/2;d=a.x;break;case 6:c=a.y-this.offset.height/2;d=a.x-this.offset.width/2;break;case 7:c=a.y-this.offset.height;d=a.x+this.offset.width/2;break;case 8:c=a.y-this.offset.height;d=a.x;break;case 9:c=a.y-this.offset.height;d=a.x-this.offset.width/2;break}d=d+this.offset.anchor.x;c=c+this.offset.anchor.y}else if(this.tipOption.tipType==
2){var e=parseInt(this.div.firstChild.offsetWidth),f=parseInt(this.div.firstChild.offsetHeight);if(isNaN(e))e=0;if(isNaN(f))f=0;switch(b){case 1:c=a.y;d=a.x;break;case 2:c=a.y;d=a.x-e/2;break;case 3:c=a.y;d=a.x-e;break;case 4:c=a.y-f/2;d=a.x;break;case 5:c=a.y-f/2;d=a.x-e/2;break;case 6:c=a.y-f/2;d=a.x-e;break;case 7:c=a.y-f;d=a.x;break;case 8:c=a.y-f;d=a.x-e/2;break;case 9:c=a.y-f;d=a.x-e;break}if(isNaN(d))d=0;if(isNaN(c))c=0;d=d;c=c}else if(this.tipOption.tipType==3){var g=Mapabc.Util.getElement(this.id+
"_close"),h=this;if(g){g.onclick=function(){h.map.ameMap.closeTip()};g.onmouseover=function(){if(Mapabc.Util.getBrowserName()=="msie")g.style.backgroundPositionX="-53px";else if(Mapabc.Util.getBrowserName()=="firefox")g.style.backgroundPosition="-53px -725px";g.style.cursor="pointer"};g.onmouseout=function(){if(Mapabc.Util.getBrowserName()=="msie")g.style.backgroundPositionX="-36px";else if(Mapabc.Util.getBrowserName()=="firefox")g.style.backgroundPosition="-36px -725px";g.style.cursor="url('"+Mapabc._getScriptLocation()+
"theme/default/img/openhand.cur'), pointer"}}e=Mapabc.Util.getElement("popup_contentDiv");f=Mapabc.Util.getElement("popup_titleDiv");if(!e||!f)return;if(this.arrow){this.arrow.style.left=parseInt(e.offsetWidth)/2-10+"px";this.arrow.style.top=parseInt(e.offsetHeight)+parseInt(f.offsetHeight)+50-21+"px"}if(this.lonlat&&this.map)a=this.map.getLayerPxFromLonLat(this.lonlat);if(this.overlayType=="_MARKER_"){b=Mapabc.Util.getElement(this.overlayId);b=this.offset.imageAlign;switch(b){case 1:c=a.y;d=a.x+
this.offset.width/2;break;case 2:c=a.y;d=a.x;break;case 3:c=a.y;d=a.x-this.offset.width/2;break;case 4:c=a.y-this.offset.height/2;d=a.x+this.offset.width/2;break;case 5:c=a.y-this.offset.height/2;d=a.x;break;case 6:c=a.y-this.offset.height/2;d=a.x-this.offset.width/2;break;case 7:c=a.y-this.offset.height;d=a.x+this.offset.width/2;break;case 8:c=a.y-this.offset.height;d=a.x;break;case 9:c=a.y-this.offset.height;d=a.x-this.offset.width/2;break}d=d-parseInt(this.tipOption.tipWidth)/2+this.offset.anchor.x;
c=c-(parseInt(e.offsetHeight)+parseInt(f.offsetHeight)+56)+this.offset.anchor.y}else{d=a.x-parseInt(this.tipOption.tipWidth)/2;c=a.y-(parseInt(e.offsetHeight)+parseInt(f.offsetHeight)+55)}}else{d=a.x-43;c=a.y;if(navigator.appVersion.indexOf("MSIE 6.0")!=-1){if(this.contentDiv)c=a.y-parseInt(this.contentDiv.offsetHeight)-77}else if(this.contentDiv)c=a.y-parseInt(this.contentDiv.offsetHeight)-65}this.div.style.left=d+this.tipOption.tipPosition.x+"px";this.div.style.top=c+this.tipOption.tipPosition.y+
"px"}},visible:function(){return Mapabc.Element.visible(this.div)},toggle:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}this.show()},show:function(){Mapabc.Element.show(this.div);if(this.contentHTML)if(this.contentDiv.innerHTML=="")if(this.contentHTML.toLowerCase().indexOf("embed")!=-1||this.contentHTML.toLowerCase().indexOf("object")!=-1)this.contentDiv.innerHTML=this.contentHTML},hide:function(){Mapabc.Element.hide(this.div);for(var a in this.MapEventList)if(this.MapEventList[a].type==
"popupclose"){var b={};b.mapId=this.MapEventList[a].obj.id;b.eventType=this.MapEventList[a].type;b.overlayId=this.overlayId}this.map.events.triggerEvent("popupclose",b);if(this.contentDiv)if(this.contentDiv.innerHTML!="")if(this.contentDiv.innerHTML.toLowerCase().indexOf("embed")!=-1||this.contentDiv.innerHTML.toLowerCase().indexOf("object")!=-1)this.contentDiv.innerHTML=""},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding();a=b.left+b.right;b=b.top+b.bottom;this.fixPadding();
this.closeDiv&&parseInt(this.closeDiv.style.width);this.size.w+=a;this.size.h+=b;this.contentSize=this.size},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.layerContainerDiv:document.body;if(this.tipOption.tipType==1)var c=this.tipOption.tipWidth,d=this.tipOption.tipHeight;else if(this.tipOption.tipType==2)if(this.div.firstChild){c=this.div.firstChild.style.width;d=this.div.firstChild.style.height}else{c=this.tipOption.tipWidth;
d=this.tipOption.tipHeight}var e=new Mapabc.Size(c,d);c=this.getSafeContentSize(e);d=null;if(c.equals(e))d=e;else{d=new Mapabc.Size;d.w=c.w<e.w?c.w:null;d.h=c.h<e.h?c.h:null;if(d.w&&d.h)d=c;else{a=Mapabc.Util.getRenderedDimensions(a,d,{displayClass:this.contentDisplayClass,containerElement:b});if(Mapabc.Element.getStyle(this.contentDiv,"overflow")!="hidden"&&a.equals(c)){b=Mapabc.Util.getScrollbarWidth();if(d.w)a.h+=b;else a.w+=b}d=this.getSafeContentSize(a)}}this.setSize(d)},setBackgroundColor:function(a){if(a!=
undefined)this.backgroundColor=a;if(this.div!=null)this.div.style.backgroundColor=this.backgroundColor},setOpacity:function(a){if(a!=undefined)this.opacity=a;if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(a){if(a!=undefined)this.border=a;if(this.div!=null)this.div.style.border=this.border},setContentHTML:function(a,b,c){if(a){a="";if(this.groupDiv)a=this.groupDiv.getAttribute("jsoverlaytype");if(this.saveOverlayId!=
this.overlayId||a!=this.overlayType){this.saveOverlayId=this.overlayId;if(this.tipOption.tipType==1){if(this.groupDiv==null){this.div.innerHTML="";this.createDivTip(this.tipOption);this.createBlocks()}else{c=this.groupDiv.getAttribute("jstype");if(c=="div")this.div.appendChild(this.groupDiv);else{this.div.innerHTML="";this.createDivTip(this.tipOption);this.createBlocks()}this.groupDiv.setAttribute("jsoverlaytype",this.overlayType)}this.setSize(new Mapabc.Size(this.tipOption.tipWidth,this.tipOption.tipHeight));
c="";if(this.tipOption.contentFontStyle.bold)c="bold";var d="";if(this.tipOption.titleFontStyle.bold)d="bold";if(isNaN(this.tipOption.contentFontStyle.size)){if(this.tipOption.contentFontStyle.size=="xx-large"||this.tipOption.contentFontStyle.size=="x-large")this.tipOption.contentFontStyle.size="large"}else if(this.tipOption.contentFontStyle.size>25)this.tipOption.contentFontStyle.size="25px";else this.tipOption.contentFontStyle.size+="px";if(isNaN(this.tipOption.titleFontStyle.size)){if(this.tipOption.titleFontStyle.size==
"xx-large"||this.tipOption.titleFontStyle.size=="x-large")this.tipOption.titleFontStyle.size="large"}else if(this.tipOption.titleFontStyle.size>25)this.tipOption.titleFontStyle.size="25px";else this.tipOption.titleFontStyle.size+="px";c="<span style='font-size: "+this.tipOption.contentFontStyle.size+"; color:"+Mapabc.Util.MChangeColor(this.tipOption.contentFontStyle.color)+"; font-weight:"+c+"; font-family:"+this.tipOption.contentFontStyle.name+"'>"+this.tipOption.content+"</span>";d="<span style='font-size: "+
this.tipOption.titleFontStyle.size+"; color:"+Mapabc.Util.MChangeColor(this.tipOption.titleFontStyle.color)+"; font-weight:"+d+"; font-family:"+this.tipOption.titleFontStyle.name+"'>"+this.tipOption.title+"</span>";if(c!=null)this.contentHTML=c;if(d!=null)this.titleHTML=d;b=Mapabc.Util.getElement(this.id+"_close");b.style.right="8px";this.boxcontent.style.borderColor=Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color);d=0;if(this.contentSize.h!=0&&this.contentSize.h>77)this.contentDiv.style.height=
this.contentSize.h-77+"px";this.boxcontent.style.opacity=this.tipOption.alpha;this.boxcontent.style.filter="alpha(opacity="+parseFloat(this.tipOption.alpha)*100+")";this.boxcontent.style.background=Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color);this.titleDiv.style.background=Mapabc.Util.MChangeColor(this.tipOption.titleFillStyle.color);d=0;d=Mapabc.String.contains(navigator.appName,"Microsoft")?"filter:alpha(opacity="+parseFloat(this.tipOption.alpha)*100+");":"opacity:"+this.tipOption.alpha;
if(this._THBorder!=null){this._THBorder.style.marginTop="-"+(parseInt(this.contentDiv.offsetHeight)+29+10)+"px";this._THBorder.innerHTML='<b class="MAME_b1" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+';"></b><b class="MAME_b2" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+
";"+d+';"></b><b class="MAME_b3" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+";background:"+Mapabc.Util.MChangeColor(this.tipOption.titleFillStyle.color)+';"></b><b class="MAME_b4" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+";background:"+Mapabc.Util.MChangeColor(this.tipOption.titleFillStyle.color)+';"></b>'}if(this._BHBorder!=null){this._BHBorder.style.marginTop=parseInt(this.contentDiv.offsetHeight)+25+9+"px";
this._BHBorder.innerHTML='<b class="MAME_b4 MAME_back" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+";background:"+Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color)+';"></b><b class="MAME_b3 MAME_back" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+";background:"+Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color)+';"></b><b class="MAME_b2" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+
";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+';"></b><b class="MAME_b1" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+';"></b>'}if(this._Bar!=null){this._Bar.innerHTML="";for(c=26;c>=1;c-=1){s=c;this._Bar.innerHTML+="<div class='MAME_w' style=\"width:"+c+"px;*width:"+s+"px;background:"+Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color)+
";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+';"></div>'}this._Bar.innerHTML+="<div class='MAME_w'  style=\"width:2px;height:2px;border:none;background:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+d+';"></div>'}this.div.style.display=""}else if(this.tipOption.tipType==2){this.div.innerHTML=this.tipOption.content;this.groupDiv=null}else if(this.tipOption.tipType==3){if(parseInt(this.tipOption.tipWidth)>700)this.tipOption.tipWidth="700px";if(parseInt(this.tipOption.tipHeight)>
700)this.tipOption.tipHeight="700px";this.setSize(new Mapabc.Size(this.tipOption.tipWidth,this.tipOption.tipHeight));if(this.groupDiv==null){this.div.innerHTML="";this.createImgTip(this.tipOption)}else{c=this.groupDiv.getAttribute("jstype");if(c=="img")this.div.appendChild(this.groupDiv);else{this.div.innerHTML="";this.createImgTip(this.tipOption)}}var e=Mapabc.Util.getElement(this.id+"_RTCorner"),f=Mapabc.Util.getElement(this.id+"_RBCorner"),g=Mapabc.Util.getElement(this.id+"_THBorder"),h=Mapabc.Util.getElement(this.id+
"_BHBorder"),i=Mapabc.Util.getElement(this.id+"_RVBorder");b=Mapabc.Util.getElement(this.id+"_close");var j=Mapabc.Util.getElement(this.id+"_Bar");a=Mapabc.Util.getElement(this.id+"_titleDiv");c=Mapabc.Util.getElement(this.id+"_contentDiv");Mapabc.Util.getElement(this.id+"_boxcontent");if(e)e.style.left=this.contentSize.w-parseInt(e.style.width)+"px";if(f)f.style.left=this.contentSize.w-parseInt(f.style.width)+"px";if(g)g.style.width=this.contentSize.w-parseInt(e.style.width)*2+"px";if(h)h.style.width=
this.contentSize.w-parseInt(f.style.width)*2+"px";if(i)i.style.left=this.contentSize.w-parseInt(e.style.width)+"px";if(b){b.style.right=0;if(Mapabc.Util.getBrowserName()=="msie")b.style.styleFloat="right";else b.style.cssFloat="right"}if(j){j.style.left=46+Math.round((this.contentSize.w-128)/2)+"px";j.style.top=parseInt(this.tipOption.tipHeight)-26+"px"}if(a){b=this.tipOption.titleFontStyle.bold?"bold":"";a.style.fontFamily=this.tipOption.titleFontStyle.name;if(this.tipOption.titleFontStyle.color==
"0xffffff")this.tipOption.titleFontStyle.color=19089;a.style.color=this.tipOption.titleFontStyle.color;a.style.fontSize=isNaN(this.tipOption.titleFontStyle.size)?this.tipOption.titleFontStyle.size=="xx-large"||this.tipOption.titleFontStyle.size=="x-large"?"large":this.tipOption.titleFontStyle.size.replace("px","")+"px":this.tipOption.titleFontStyle.size>25?"25px":this.tipOption.titleFontStyle.size+"px";a.style.fontWeight=b;a.style.width=parseInt(this.tipOption.tipWidth)-55+"px";a.innerHTML=this.tipOption.title}if(c){b=
this.tipOption.contentFontStyle.bold?"bold":"";c.style.fontFamily=this.tipOption.contentFontStyle.name;if(this.tipOption.contentFontStyle.color=="0xffffff")this.tipOption.contentFontStyle.color=19089;c.style.color=this.tipOption.contentFontStyle.color;if(isNaN(this.tipOption.contentFontStyle.size))c.style.fontSize=this.tipOption.contentFontStyle.size=="xx-large"||this.tipOption.contentFontStyle.size=="x-large"?"large":this.tipOption.contentFontStyle.size>25?"25px":this.tipOption.contentFontStyle.size.replace("px",
"")+"px";else if(this.tipOption.contentFontStyle.size>25){d=29;c.style.fontSize="25px"}else{d=this.tipOption.contentFontStyle.size+4;c.style.fontSize=this.tipOption.contentFontStyle.size+"px"}a="";a=this.tipOption.contentFontStyle.color=="0xffffff"?"#000":Mapabc.Util.MChangeColor(this.tipOption.contentFontStyle.color);if(d)c.style.lineHeight=d+"px";c.style.width=parseInt(this.contentSize.w)-4+"px";c.style.color=a;c.style.fontWeight=b;c.style.width=parseInt(this.tipOption.tipWidth)-20+"px";if(parseInt(this.tipOption.tipHeight)!=
0)c.style.height=parseInt(this.tipOption.tipHeight)-81+"px";c.innerHTML=this.tipOption.content}}}else if(this.tipType!=c||this.overlayId=="")if(c==1){this.div.innerHTML="";this.createDivTip(this.tipOption);this.createBlocks()}else if(c==2){this.div.innerHTML="";if(this.tipOption.content!=null)this.div.innerHTML=this.tipOption.content;if(this.div.firstChild){d=this.div.firstChild.style.width;c=this.div.firstChild.style.height}else{d=this.tipOption.tipWidth;c=this.tipOption.tipHeight}this.contentSize=
this.contentSize!=null?this.contentSize:new Mapabc.Size(d,c)}else{if(c==3){this.div.innerHTML="";if(parseInt(this.tipOption.tipWidth)>700)this.tipOption.tipHeight="700px";if(parseInt(this.tipOption.tipHeight)>700)this.tipOption.tipHeight="700px";this.createImgTip(this.tipOption)}}else{this.setSize(new Mapabc.Size(this.tipOption.tipWidth,this.tipOption.tipHeight));if(this.tipOption){c="";if(this.tipOption.contentFontStyle.bold)c="bold";d="";if(this.tipOption.titleFontStyle.bold)d="bold";if(String(this.tipOption.contentFontStyle.size).indexOf("px")==
-1)this.tipOption.contentFontStyle.size+="px";if(String(this.tipOption.titleFontStyle.size).indexOf("px")==-1)this.tipOption.titleFontStyle.size+="px";if(this.titleDiv)this.titleDiv.style.width=parseInt(this.contentSize.w)-4+"px";if(this.contentDiv)this.contentDiv.style.width=parseInt(this.contentSize.w)-4+"px";if(this.boxcontent)this.boxcontent.style.width=parseInt(this.contentSize.w)-4+"px";if(this.contentSize.h!=0&&this.contentSize.h>69)this.contentDiv.style.height=parseInt(this.contentSize.h)-
69+"px";c="<span style='font-size: "+this.tipOption.contentFontStyle.size.replace("px","")+"px; color:"+Mapabc.Util.MChangeColor(this.tipOption.contentFontStyle.color)+"; font-weight:"+c+"; font-family:"+this.tipOption.contentFontStyle.name+"'>"+this.tipOption.content+"</span>";d="<span style='font-size: "+this.tipOption.titleFontStyle.size.replace("px","")+"px; color:"+Mapabc.Util.MChangeColor(this.tipOption.titleFontStyle.color)+"; font-weight:"+d+"; font-family:"+this.tipOption.titleFontStyle.name+
"'>"+this.tipOption.title+"</span>";if(c!=null)this.contentHTML=c;if(d!=null)this.titleHTML=d;this.contentHTML.innerHTML=this.contentHTML;this.titleHTML.innerHTML=this.titleHTML}}}if(this.contentDiv!=null&&this.contentHTML!=null&&this.contentHTML!=this.contentDiv.innerHTML){this.contentDiv.innerHTML=this.contentHTML;if(this.titleHTML!=null&&this.titleHTML!=null&&this.titleHTML!=this.titleDiv.innerHTML)this.titleDiv.innerHTML=this.titleHTML;this.autoSize&&this.updateSize()}},registerImageListeners:function(){for(var a=
function(){this.popup.updateSize();this.popup.visible();Mapabc.Event.stopObserving(this.img,"load",this.img._onImageLoad)},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;c<d;c++){var e=b[c];if(e.width==0||e.height==0){e._onImgLoad=Mapabc.Function.bind(a,{popup:this,img:e});Mapabc.Event.observe(e,"load",e._onImgLoad)}}},getSafeContentSize:function(a){a=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;this.fixPadding();c+=this.padding.left+this.padding.right;
d+=this.padding.top+this.padding.bottom;if(this.closeDiv){var e=parseInt(this.closeDiv.style.width);c+=e+b.right}if(this.minSize){a.w=Math.max(a.w,this.minSize.w-c);a.h=Math.max(a.h,this.minSize.h-d)}if(this.maxSize){a.w=Math.min(a.w,this.maxSize.w-c);a.h=Math.min(a.h,this.maxSize.h-d)}if(this.map&&this.map.size){e=b=0;if(this.keepInMap&&!this.panMapIfOutOfView){e=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case "tr":b=e.x;e=this.map.size.h-e.y;break;case "tl":b=this.map.size.w-
e.x;e=this.map.size.h-e.y;break;case "bl":b=this.map.size.w-e.x;e=e.y;break;case "br":b=e.x;e=e.y;break;default:b=e.x;e=this.map.size.h-e.y;break}}d=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-d-e;a.w=Math.min(a.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-c-b);a.h=Math.min(a.h,d)}return a},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}if(this.tipOption.tipType==
1||this.tipOption.tipType==3)var b=this.groupDiv;else if(this.tipOption.tipType==2)b=this.div.firstChild;this._contentDivPadding=a=new Mapabc.Bounds(Mapabc.Element.getStyle(b,"padding-left"),Mapabc.Element.getStyle(b,"padding-bottom"),Mapabc.Element.getStyle(b,"padding-right"),Mapabc.Element.getStyle(b,"padding-top"));if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return a},addCloseBox:function(a){this.closeDiv=Mapabc.Util.createDiv(this.id+"_close",
null,new Mapabc.Size(17,17));if(this.tipOption.tipType==1){var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+2+"px";this.closeDiv.style.background='url("'+Mapabc._getScriptLocation()+'img/close.gif") no-repeat';this.closeDiv.style.cursor="pointer";this.boxcontent.appendChild(this.closeDiv)}else if(this.tipOption.tipType==3){this.closeDiv.style.top="40px";this.closeDiv.style.left=this.contentSize.w-27+"px";this.groupDiv.appendChild(this.closeDiv)}Mapabc.Event.observe(this.closeDiv,
"click",Mapabc.Function.bindAsEventListener(a||function(c){this.hide();Mapabc.Event.stop(c)},this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new Mapabc.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone(),d=Mapabc.Util.getElement("overviewMap");d=d?d.firstChild.style.display==""?160:0:0;if(b.x<this.map.paddingForPopups.left)c.x=this.map.paddingForPopups.left+50;else if(b.x+this.size.w>a.w-this.map.paddingForPopups.right)c.x=a.w-
this.map.paddingForPopups.right-this.size.w-d;if(this.size.h==0){var e=Mapabc.Util.getElement("popup_contentDiv");if(e)this.size.h=parseInt(e.offsetHeight)+65}if(b.y<this.map.paddingForPopups.top)c.y=this.map.paddingForPopups.top;else if(b.y+this.size.h+22>a.h-this.map.paddingForPopups.bottom){if(d==0)d=50;c.y=a.h-this.map.paddingForPopups.bottom-this.size.h-d}this.map.pan(b.x-c.x,b.y-c.y,null,null,SLIDING_EXPO)},registerEvents:function(){this.events=new Mapabc.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,
mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})},onmousedown:function(a){this.mousedown=true;Mapabc.Event.stop(a,true)},onmousemove:function(a){this.mousedown&&Mapabc.Event.stop(a,true)},onmouseup:function(a){if(this.mousedown){this.mousedown=false;Mapabc.Event.stop(a,true)}},onclick:function(a){Mapabc.Event.stop(a,true)},onmouseout:function(){this.mousedown=false},ondblclick:function(a){Mapabc.Event.stop(a,true)},
CLASS_NAME:"Mapabc.Popup"});
function Bubble(a,b){this.id=a;this.height=this.top=this.left=0;this.create=function(){var c=Mapabc.Util.createDiv(this.id);c.className="olImgPopupDiv";c.style.overflow="hidden";c.style.left=this.left+"px";c.style.top=this.top+"px";c.style.width="30px";c.style.height=this.height+"px";var d=Mapabc.Util.createImage(this.id+"_Img",null,new Mapabc.Size(690,764),null,"absolute");d.className="olImgPopup";if(window.HTMLElement){d.src=Mapabc.Util.getImagesLocation()+"context.png";d.style.filter=""}else{d.src=
Mapabc.Util.getImagesLocation()+"mbblank.gif";d.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+Mapabc.Util.getImagesLocation()+"context.png,sizingMethnod=crop)"}switch(b){case 1:d.style.left="0px";d.style.top="0px";break;case 2:d.style.left="0px";d.style.top="-660px";break;case 3:d.style.left="-660px";d.style.top="0px";break;case 4:d.style.left="-660px";d.style.top="-660px";break;default:break}c.appendChild(d);return c}}
function bubble_Shadow(a,b){this.id=a;this.height=this.width=this.top=this.left=0;this.create=function(){var c=Mapabc.Util.createDiv(this.id);c.className="olImgPopupDiv";c.style.overflow="hidden";c.style.left=this.left+"px";c.style.top=this.top+"px";c.style.width=this.width-60+"px";c.style.height=this.height+"px";var d=Mapabc.Util.createImage(this.id+"_Img",null,new Mapabc.Size(690,764),null,"absolute");d.className="olImgPopup";if(window.HTMLElement){d.src=Mapabc.Util.getImagesLocation()+"context.png";
d.style.filter=""}else{d.src=Mapabc.Util.getImagesLocation()+"mbblank.gif";d.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+Mapabc.Util.getImagesLocation()+"context.png,sizingMethnod=crop)"}switch(b){case 1:d.style.left="-31px";d.style.top="0px";break;case 2:d.style.left="-31px";d.style.top="-660px";break;case 3:d.style.left="0px";d.style.top="-31px";break;case 4:d.style.left="-660px";d.style.top="-31px";break;default:break}c.appendChild(d);return c}}
function tipContent(a,b){this.TipIdContent=a;this.f3=b.content;this.left=0;this.top=40;this.height=165;this.width=0;var c=b.contentFontStyle.bold?"bold":"";this.create=function(){var d=Mapabc.Util.createDiv(this.TipIdContent);d.className="olImgPopupContent";d.style.overflow="auto";d.style.backgroundColor="white";d.style.left=this.left+"px";d.style.top=this.top+"px";d.style.width=this.width+"px";d.style.height=this.height+"px";d.style.fontFamily=b.contentFontStyle.name;if(b.contentFontStyle.color==
"0xffffff")b.contentFontStyle.color=19089;d.style.color=b.contentFontStyle.color;d.style.fontSize=b.contentFontStyle.size+"px";d.style.fontWeight=c;d.innerHTML=this.f3;return d}}
function tipTitle(a,b){this.id=a;this.tid=a+"_TitleTd";this.width=this.height=this.top=this.left=0;var c=b.titleFontStyle.bold?"bold":"";this.create=function(){var d=Mapabc.Util.createDiv(this.id);d.className="olImgPopupContent";d.style.overflow="hidden";d.style.backgroundColor="white";d.style.left=this.left+"px";d.style.top=this.top;d.style.width=this.width+"px";d.style.height=this.height+"px";d.style.fontFamily=b.titleFontStyle.name;if(b.titleFontStyle.color=="0xffffff")b.titleFontStyle.color=19089;
d.style.color=b.titleFontStyle.color;d.style.fontSize=b.titleFontStyle.size+"px";d.style.fontWeight=c;d.style.filter="alpha(opacity=100)";d.innerHTML=b.title;return d};this.SetTitle=function(d){if(getDivObj(this.tid)!=undefined)getDivObj(this.getDivObjd).innerHTML="<strong style='font-size:14px'>"+d+"</strong>"};this.nw=function(){return getDivObj(this.id)!=undefined?getDivObj(this.id).clientHeight:this.height}}
function picBar(a){this.id=a;this.width=this.height=this.top=this.left=0;this.create=function(){var b=Mapabc.Util.createDiv(this.id);b.className="olImgPopupContent";b.style.overflow="hidden";b.style.left=this.left+"px";b.style.top=this.top+"px";b.style.width=this.width-35+"px";b.style.height=this.height-30+"px";b.style.zIndex=1;var c=Mapabc.Util.createImage(this.id+"_Img",null,new Mapabc.Size(690,764),null,"absolute");c.className="olImgPopup";if(window.HTMLElement){c.src=Mapabc.Util.getImagesLocation()+
"context.png";c.style.filter=""}else{c.src=Mapabc.Util.getImagesLocation()+"mbblank.gif";c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+Mapabc.Util.getImagesLocation()+"context.png,sizingMethnod=crop)"}c.style.left="0px";if(Mapabc.Util.getBrowserName()=="msie"){c.style.top="-700px";c.style.height="760px"}else if(Mapabc.Util.getBrowserName()=="firefox"){c.style.top="-687px";c.style.height="750px"}c.style.position="absolute";c.isPending="false";c.preCached="true";c.unselectable=
"on";c.galleryImg="no";b.appendChild(c);return b}}
function sieve(a){if(window.HTMLElement){a=a.replace(new RegExp("(\\[imgsrc\\])","g"),"src='"+Mapabc.Util.getImagesLocation()+"context.png'");a=a.replace(new RegExp("(\\[imgfilter\\])","g"),"");a=a.replace(new RegExp("(\\[shadowsrc\\])","g"),"src='"+Mapabc.Util.getImagesLocation()+"yy.png'");a=a.replace(new RegExp("(\\[shadowfilter\\])","g"),"")}else{a=a.replace(new RegExp("(\\[imgsrc\\])","g"),"src='"+Mapabc.Util.getImagesLocation()+"context.pngmbblank.gif'");a=a.replace(new RegExp("(\\[imgfilter\\])",
"g"),"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=crop,src="+Mapabc.Util.getImagesLocation()+"context.png);")}return a}Mapabc.Popup.WIDTH=200;Mapabc.Popup.HEIGHT=200;Mapabc.Popup.COLOR="white";Mapabc.Popup.OPACITY=1;Mapabc.Popup.BORDER="0px";
Mapabc.Renderer=Mapabc.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a){this.container=Mapabc.Util.getElement(a)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return false},setExtent:function(a,b){this.extent=a.clone();if(b)this.resolution=null},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||
this.map.getResolution()},drawFeature:function(a,b){if(b==null)b=a.style;if(a.geometry){var c=a.geometry.getBounds();if(c){c.intersectsBounds(this.extent)||(b={display:"none"});c=this.drawGeometry(a,b,a.id);b.display!="none"&&b.label&&c!==false?this.drawText(a.id,b,a.geometry.getCentroid()):this.removeText(a.id);return c}}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(a){a instanceof Array||(a=
[a]);for(var b=0,c=a.length;b<c;++b){this.eraseGeometry(a[b].geometry);this.removeText(a[b].id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},CLASS_NAME:"Mapabc.Renderer"});
Mapabc.Strategy=Mapabc.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(a){Mapabc.Util.extend(this,a);this.options=a;this.active=false},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(a){this.layer=a},activate:function(){if(!this.active)return this.active=true;return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"Mapabc.Strategy"});
Mapabc.Tween=Mapabc.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=a?a:Mapabc.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=true;this.begin=a;this.finish=b;this.duration=c;this.callbacks=d.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.interval=window.setInterval(Mapabc.Function.bind(this.play,
this),this.INTERVAL)},stop:function(){if(this.playing){this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish);window.clearInterval(this.interval);this.interval=null;this.playing=false}},play:function(){var a={};for(var b in this.begin){var c=this.begin[b];a[b]=this.easing.apply(this,[this.time,c,this.finish[b]-c,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,a);if(this.time>this.duration){if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,
this.finish);this.playing=false}window.clearInterval(this.interval);this.interval=null}},CLASS_NAME:"Mapabc.Tween"});Mapabc.Easing={CLASS_NAME:"Mapabc.Easing"};Mapabc.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"Mapabc.Easing.Linear"};
Mapabc.Easing.Expo={easeIn:function(a,b,c,d){return a==0?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){if(a==0)return b;if(a==d)return b+c;if((a/=d/2)<1)return c/2*Math.pow(2,10*(a-1))+b;return c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"Mapabc.Easing.Expo"};
Mapabc.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a+b;return-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"Mapabc.Easing.Quad"};
Mapabc.Rico.Color=Mapabc.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a;this.rgb=Mapabc.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a;this.rgb=Mapabc.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a;this.rgb=Mapabc.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},darken:function(a){var b=
this.asHSB();this.rgb=Mapabc.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=Mapabc.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>0.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+
")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return Mapabc.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});
Mapabc.Rico.Color.createFromHex=function(a){if(a.length==4){var b=a;a="#";for(var c=1;c<4;c++)a+=b.charAt(c)+b.charAt(c)}if(a.indexOf("#")==0)a=a.substring(1);b=a.substring(0,2);c=a.substring(2,4);a=a.substring(4,6);return new Mapabc.Rico.Color(parseInt(b,16),parseInt(c,16),parseInt(a,16))};
Mapabc.Rico.Color.createColorFromBackground=function(a){var b=RicoUtil.getElementsComputedStyle(Mapabc.Util.getElement(a),"backgroundColor","background-color");if(b=="transparent"&&a.parentNode)return Mapabc.Rico.Color.createColorFromBackground(a.parentNode);if(b==null)return new Mapabc.Rico.Color(255,255,255);if(b.indexOf("rgb(")==0){a=b.substring(4,b.length-1).split(",");return new Mapabc.Rico.Color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))}else return b.indexOf("#")==0?Mapabc.Rico.Color.createFromHex(b):
new Mapabc.Rico.Color(255,255,255)};
Mapabc.Rico.Color.HSBtoRGB=function(a,b,c){var d=0,e=0,f=0;if(b==0)f=e=d=parseInt(c*255+0.5);else{a=(a-Math.floor(a))*6;var g=a-Math.floor(a),h=c*(1-b),i=c*(1-b*g);b=c*(1-b*(1-g));switch(parseInt(a)){case 0:d=c*255+0.5;e=b*255+0.5;f=h*255+0.5;break;case 1:d=i*255+0.5;e=c*255+0.5;f=h*255+0.5;break;case 2:d=h*255+0.5;e=c*255+0.5;f=b*255+0.5;break;case 3:d=h*255+0.5;e=i*255+0.5;f=c*255+0.5;break;case 4:d=b*255+0.5;e=h*255+0.5;f=c*255+0.5;break;case 5:d=c*255+0.5;e=h*255+0.5;f=i*255+0.5;break}}return{r:parseInt(d),
g:parseInt(e),b:parseInt(f)}};Mapabc.Rico.Color.RGBtoHSB=function(a,b,c){var d,e=a>b?a:b;if(c>e)e=c;var f=a<b?a:b;if(c<f)f=c;d=e!=0?(e-f)/e:0;if(d==0)a=0;else{var g=(e-a)/(e-f),h=(e-b)/(e-f);c=(e-c)/(e-f);a=a==e?c-h:b==e?2+g-c:4+h-g;a/=6;if(a<0)a+=1}return{h:a,s:d,b:e/255}};
Mapabc.Control.Attribution=Mapabc.Class(Mapabc.Control,{separator:", ",initialize:function(){Mapabc.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});Mapabc.Control.prototype.destroy.apply(this,arguments)},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,
changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;b<c;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&a.push(d.attribution)}this.div.style.bottom="2px";this.div.style.right="15px";this.div.id="Attribution";this.div.unselectable="on";this.div.innerHTML=a.join(this.separator)}},
CLASS_NAME:"Mapabc.Control.Attribution"});Mapabc.Control.Button=Mapabc.Class(Mapabc.Control,{type:Mapabc.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"Mapabc.Control.Button"});
Mapabc.Control.MouseDefaults=Mapabc.Class(Mapabc.Control,{performedDrag:false,wheelObserver:null,initialize:function(){Mapabc.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.handler&&this.handler.destroy();this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});Mapabc.Event.stopObserving(window,"DOMMouseScroll",
this.wheelObserver);Mapabc.Event.stopObserving(window,"mousewheel",this.wheelObserver);Mapabc.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;Mapabc.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=
Mapabc.Function.bindAsEventListener(this.onWheelEvent,this);Mapabc.Event.observe(window,"DOMMouseScroll",this.wheelObserver);Mapabc.Event.observe(window,"mousewheel",this.wheelObserver);Mapabc.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(a){if(Mapabc.Event.isLeftClick(a)){a=!this.performedDrag;this.performedDrag=false;return a}},defaultDblClick:function(a){this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),this.map.zoom+1);Mapabc.Event.stop(a);return false},
defaultMouseDown:function(a){if(Mapabc.Event.isLeftClick(a)){this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=Mapabc.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox)}document.onselectstart=
function(){return false};Mapabc.Event.stop(a)}},defaultMouseMove:function(a){this.mousePosition=a.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var b=Math.abs(this.mouseDragStart.x-a.xy.x),c=Math.abs(this.mouseDragStart.y-a.xy.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,c)+"px";if(a.xy.x<this.mouseDragStart.x)this.zoomBox.style.left=a.xy.x+"px";if(a.xy.y<this.mouseDragStart.y)this.zoomBox.style.top=a.xy.y+"px"}else{b=this.mouseDragStart.x-a.xy.x;
c=this.mouseDragStart.y-a.xy.y;var d=this.map.getSize();this.map.setCenter(this.map.getLonLatFromViewPortPx(new Mapabc.Pixel(d.w/2+b,d.h/2+c)),null,true);this.mouseDragStart=a.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}},defaultMouseUp:function(a){if(Mapabc.Event.isLeftClick(a)){if(this.zoomBox)this.zoomBoxEnd(a);else this.performedDrag&&this.map.setCenter(this.map.center);this.mouseDragStart=document.onselectstart=null;this.map.div.style.cursor=""}},defaultMouseOut:function(a){if(this.mouseDragStart!=
null&&Mapabc.Util.mouseLeft(a,this.map.div)){this.zoomBox&&this.removeZoomBox();this.mouseDragStart=null}},defaultWheelUp:function(a){this.map.getZoom()<=this.map.getNumZoomLevels()&&this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1)},defaultWheelDown:function(a){this.map.getZoom()>0&&this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1)},zoomBoxEnd:function(a){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-a.xy.x)>5||Math.abs(this.mouseDragStart.y-
a.xy.y)>5){var b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);a=this.map.getLonLatFromViewPortPx(a.xy);var c=Math.max(b.lat,a.lat),d=Math.min(b.lat,a.lat);this.map.zoomToExtent(new Mapabc.Bounds(Math.min(b.lon,a.lon),d,Math.max(b.lon,a.lon),c))}else{a=this.map.getLonLatFromViewPortPx(a.xy);this.map.setCenter(new Mapabc.LonLat(a.lon,a.lat),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null},onWheelEvent:function(a){for(var b=
false,c=Mapabc.Event.element(a);c!=null;){if(this.map&&c==this.map.div){b=true;break}c=c.parentNode}if(b){b=0;if(!a)a=window.event;if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2)b=-b}else if(a.detail)b=-a.detail/3;if(b){a.xy=this.mousePosition;b<0?this.defaultWheelDown(a):this.defaultWheelUp(a)}Mapabc.Event.stop(a)}},CLASS_NAME:"Mapabc.Control.MouseDefaults"});
Mapabc.Control.MousePosition=Mapabc.Class(Mapabc.Control,{element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,lastXy:null,displayProjection:null,initialize:function(){Mapabc.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("mousemove",this,this.redraw);Mapabc.Control.prototype.destroy.apply(this,arguments)},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top=
"";this.element=this.div}this.redraw();return this.div},redraw:function(a){var b;if(a==null)b=new Mapabc.LonLat(0,0);else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return}b=this.map.getLonLatFromPixel(a.xy);if(!b)return;this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection);this.lastXy=a.xy}a=this.formatOutput(b);if(a!=this.element.innerHTML)this.element.innerHTML=a},
formatOutput:function(a){var b=parseInt(this.numDigits);return this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix},setMap:function(){Mapabc.Control.prototype.setMap.apply(this,arguments);this.map.events.register("mousemove",this,this.redraw)},CLASS_NAME:"Mapabc.Control.MousePosition"});
Mapabc.Control.Pan=Mapabc.Class(Mapabc.Control,{slideFactor:50,direction:null,type:Mapabc.Control.TYPE_BUTTON,initialize:function(a,b){this.direction=a;this.CLASS_NAME+=this.direction;Mapabc.Control.prototype.initialize.apply(this,[b])},trigger:function(){switch(this.direction){case Mapabc.Control.Pan.NORTH:this.map.pan(0,-this.slideFactor);break;case Mapabc.Control.Pan.SOUTH:this.map.pan(0,this.slideFactor);break;case Mapabc.Control.Pan.WEST:this.map.pan(-this.slideFactor,0);break;case Mapabc.Control.Pan.EAST:this.map.pan(this.slideFactor,
0);break}},CLASS_NAME:"Mapabc.Control.Pan"});Mapabc.Control.Pan.NORTH="North";Mapabc.Control.Pan.SOUTH="South";Mapabc.Control.Pan.EAST="East";Mapabc.Control.Pan.WEST="West";
Mapabc.Control.PanZoom=Mapabc.Class(Mapabc.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,isMINI:false,flag:false,initialize:function(a,b){this.flag=b;this.position=new Mapabc.Pixel(Mapabc.Control.PanZoom.X,Mapabc.Control.PanZoom.Y);Mapabc.Control.prototype.initialize.apply(this,arguments)},destroy:function(){Mapabc.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.position=this.buttons=null},draw:function(a){Mapabc.Control.prototype.draw.apply(this,arguments);
a=this.position;this.buttons=[];if(this.flag)var b=new Mapabc.Size(15,15),c=new Mapabc.Size(52,114);else{b=new Mapabc.Size(12,12);c=new Mapabc.Size(58,98)}var d=new Mapabc.Pixel(a.x+b.w/2,a.y);if(this.isMINI){this._addButton("zoomin","zoomin_mini.png",d.add(0,0),new Mapabc.Size(26,26));this.flag?this._addButton("zoomout","zoomout_mini.png",d.add(0,b.h+11),new Mapabc.Size(26,26)):this._addButton("zoomout","zoomout_mini.png",d.add(0,b.h+14),new Mapabc.Size(26,26))}else if(this.flag){var e=new Mapabc.Pixel(d.x-
8,d.y+1);this._addButton("panback","smallbackfortencent.png",e,c);d.x+=10;d.y+=2;this._addButton("panup","topfortencent.gif",d,b);a.x+=2;a.y=d.y+b.h+1;this._addButton("panleft","leftfortencent.gif",a,b);this._addButton("panright","rightfortencent.gif",a.add(b.w+16,0),b);this._addButton("pandown","bottomfortencent.gif",d.add(0,b.h*2+2),b);this._addButton("zoomin","zoominfortencent.gif",d.add(-2,b.h*3+15),new Mapabc.Size(18,18));this._addButton("zoomout","zoomoutfortencent.gif",d.add(-2,b.h*5+8),new Mapabc.Size(18,
18))}else{e=new Mapabc.Pixel(d.x-9,d.y+1);this._addButton("panback","smallback.png",e,c);d.x+=13;d.y+=6;this._addButton("panup","top.gif",d,b);a.x+=1;a.y=d.y+b.h+5;this._addButton("panleft","left.gif",a,b);this._addButton("panright","right.gif",a.add(b.w+24,0),b);this._addButton("pandown","bottom.gif",d.add(0,b.h*2+10),b);this._addButton("zoomin","zoomin.gif",d.add(0,b.h*3+19),b);this._addButton("zoomout","zoomout.gif",d.add(0,b.h*5+12),b)}return this.div},_addButton:function(a,b,c,d){b=Mapabc.Util.getImagesLocation()+
b;c=Mapabc.Util.createAlphaImageDiv(this.id+"_"+a,c,d,b,"absolute");if(this.id+"_"+a=="panZoom_panup"){c.title="\u5411\u4e0a\u5e73\u79fb";c.style.cursor="pointer"}if(this.id+"_"+a=="panZoom_panleft"){c.title="\u5411\u5de6\u5e73\u79fb";c.style.cursor="pointer"}if(this.id+"_"+a=="panZoom_panlast"){c.title="\u8fd4\u56de\u5730\u56fe\u521d\u59cb\u5316";c.style.cursor="pointer"}if(this.id+"_"+a=="panZoom_panright"){c.title="\u5411\u53f3\u5e73\u79fb";c.style.cursor="pointer"}if(this.id+"_"+a=="panZoom_pandown"){c.title=
"\u5411\u4e0b\u5e73\u79fb";c.style.cursor="pointer"}if(this.id+"_"+a=="panZoom_zoomin"){c.title="\u653e\u5927";c.style.cursor="pointer"}if(this.id+"_"+a=="panZoom_zoomout"){c.title="\u7f29\u5c0f";c.style.cursor="pointer"}this.div.appendChild(c);c.oncontextmenu=function(){return false};(new Mapabc.Events(this,c,null,true)).on({mousedown:this.map.onmousedown,mousemove:this.map.onmousemove,mouseout:this.map.onmouseout,mouseover:function(){this.map.events.unregister(MOUSE_MOVING,this.map,this.map._MMAPABC_EVENT_MOUSEMOVE_)},
contextmenu:this.map.oncontextmenu,click:this.map.onclick,scope:this});Mapabc.Event.observe(c,"mousedown",Mapabc.Function.bindAsEventListener(this.buttonDown,c));Mapabc.Event.observe(c,"dblclick",Mapabc.Function.bindAsEventListener(this.doubleClick,c));Mapabc.Event.observe(c,"click",Mapabc.Function.bindAsEventListener(this.doubleClick,c));c.action=a;c.map=this.map;if(this.slideRatio){var e=this.slideRatio;a=function(g){return this.map.getSize()[g]*e}}else{var f=this.slideFactor;a=function(){return f}}c.getSlideFactor=
a;this.buttons.push(c);return c},_removeButton:function(a){Mapabc.Event.stopObservingElement(a);a.map=null;this.div.removeChild(a);Mapabc.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a)this._removeButton(this.buttons[a])},doubleClick:function(a){Mapabc.Event.stop(a);return false},buttonDown:function(a){if(Mapabc.Event.isLeftClick(a)){switch(this.action){case "panup":this.map.pan(0,-this.getSlideFactor("h"),null,null,SLIDING_EXPO);break;case "pandown":this.map.pan(0,
this.getSlideFactor("h"),null,null,SLIDING_EXPO);break;case "panlast":this.map.setCenter(this.map.defaultcenter,this.map.defaultzoom);break;case "panleft":this.map.pan(-this.getSlideFactor("w"),0,null,null,SLIDING_EXPO);break;case "panright":this.map.pan(this.getSlideFactor("w"),0,null,null,SLIDING_EXPO);break;case "zoomin":this.map.zoomIn();break;case "zoomout":this.map.zoomOut();break;case "zoomworld":this.map.zoomToMaxExtent();break}Mapabc.Event.stop(a)}},CLASS_NAME:"Mapabc.Control.PanZoom"});
Mapabc.Control.PanZoom.X=4;Mapabc.Control.PanZoom.Y=4;
Mapabc.Control.Panel=Mapabc.Class(Mapabc.Control,{controls:null,defaultControl:null,initialize:function(a){Mapabc.Control.prototype.initialize.apply(this,[a]);this.controls=[]},destroy:function(){Mapabc.Control.prototype.destroy.apply(this,arguments);for(var a=this.controls.length-1;a>=0;a--){this.controls[a].events&&this.controls[a].events.un({activate:this.redraw,deactivate:this.redraw,scope:this});Mapabc.Event.stopObservingElement(this.controls[a].panel_div);this.controls[a].panel_div=null}},activate:function(){if(Mapabc.Control.prototype.activate.apply(this,
arguments)){for(var a=0,b=this.controls.length;a<b;a++)this.controls[a]==this.defaultControl&&this.controls[a].activate();this.redraw();return true}else return false},deactivate:function(){if(Mapabc.Control.prototype.deactivate.apply(this,arguments)){for(var a=0,b=this.controls.length;a<b;a++)this.controls[a].deactivate();return true}else return false},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);for(var a=0,b=this.controls.length;a<b;a++){this.map.addControl(this.controls[a]);
this.controls[a].deactivate();this.controls[a].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.activate();return this.div},redraw:function(){this.div.innerHTML="";if(this.active)for(var a=0,b=this.controls.length;a<b;a++){var c=this.controls[a].panel_div;c.className=this.controls[a].active?this.controls[a].displayClass+"ItemActive":this.controls[a].displayClass+"ItemInactive";this.div.appendChild(c)}},activateControl:function(a){if(!this.active)return false;if(a.type==Mapabc.Control.TYPE_BUTTON){a.trigger();
this.redraw()}else if(a.type==Mapabc.Control.TYPE_TOGGLE){a.active?a.deactivate():a.activate();this.redraw()}else{for(var b=0,c=this.controls.length;b<c;b++)this.controls[b]!=a&&this.controls[b].type!=Mapabc.Control.TYPE_TOGGLE&&this.controls[b].deactivate();a.activate()}},addControls:function(a){a instanceof Array||(a=[a]);this.controls=this.controls.concat(a);for(var b=0,c=a.length;b<c;b++){var d=document.createElement("div");document.createTextNode(" ");a[b].panel_div=d;if(a[b].title!="")a[b].panel_div.title=
a[b].title;Mapabc.Event.observe(a[b].panel_div,"click",Mapabc.Function.bind(this.onClick,this,a[b]));Mapabc.Event.observe(a[b].panel_div,"mousedown",Mapabc.Function.bindAsEventListener(Mapabc.Event.stop))}if(this.map){b=0;for(c=a.length;b<c;b++){this.map.addControl(a[b]);a[b].deactivate();a[b].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.redraw()}},onClick:function(a,b){Mapabc.Event.stop(b?b:window.event);this.activateControl(a)},getControlsBy:function(a,b){var c=typeof b.test==
"function";return Mapabc.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])})},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"Mapabc.Control.Panel"});
Mapabc.Control.Scale=Mapabc.Class(Mapabc.Control,{element:null,initialize:function(a,b){Mapabc.Control.prototype.initialize.apply(this,[b]);this.element=Mapabc.Util.getElement(a)},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var a=this.map.getScale();if(a){a=a>=9500&&
a<=95E4?Math.round(a/1E3)+"K":a>=95E4?Math.round(a/1E6)+"M":Math.round(a);this.element.innerHTML=Mapabc.i18n("scale",{scaleDenom:a})}},CLASS_NAME:"Mapabc.Control.Scale"});
Mapabc.Control.ScaleLine=Mapabc.Class(Mapabc.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,initialize:function(a){Mapabc.Control.prototype.initialize.apply(this,[a])},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.div.style.display="block";this.div.style.position="absolute";this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";this.div.appendChild(this.eTop);
this.eTop.style.visibility=this.topOutUnits==""||this.topInUnits==""?"hidden":"visible";this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);this.eBottom.style.visibility=this.bottomOutUnits==""||this.bottomInUnits==""?"hidden":"visible"}this.map.events.register("moveend",this,this.update);this.map.events.register("zoomchanged",this,this.update);this.update();return this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/
Math.log(10));b=Math.pow(10,b);a=parseInt(a/b);return(a>5?5:a>2?2:1)*b},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=Mapabc.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e,f;if(d>1E5){e=this.topOutUnits;f=this.bottomOutUnits}else{e=this.topInUnits;f=this.bottomInUnits}var g=d/c[e];d=d/c[f];var h=this.getBarLen(g),i=this.getBarLen(d);g=h/c[b]*c[e];d=i/c[b]*c[f];if(f=="mi")f="\u82f1\u91cc";if(e=="km")e="\u516c\u91cc";if(f=="ft")if(i==5E3){i/=5E3;f="\u82f1\u91cc"}else f=
"\u82f1\u5c3a";if(e=="m")if(h==1E3){h/=1E3;e="\u516c\u91cc"}else e="\u7c73";if(i==100&&h==100)h=200;if(i==1&&h==2)i=2;if(h==100&&i==500)h=200;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(d/a)+"px";this.eBottom.style.fontSize="9px";this.eBottom.unselectable="on";this.eBottom.innerHTML=i+" "+f}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(g/a)+"px";this.eTop.style.fontSize="9px";this.eTop.unselectable="on";this.eTop.innerHTML=h+" "+e}}},
CLASS_NAME:"Mapabc.Control.ScaleLine"});Mapabc.Control.ZoomIn=Mapabc.Class(Mapabc.Control,{type:Mapabc.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"Mapabc.Control.ZoomIn"});Mapabc.Control.ZoomOut=Mapabc.Class(Mapabc.Control,{type:Mapabc.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"Mapabc.Control.ZoomOut"});
Mapabc.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return a.which&&a.which==1||a.button&&a.button==1},isRightClick:function(a){return a.which&&a.which==3||a.button&&a.button==2},stop:function(a,b){if(!b)if(a.preventDefault)a.preventDefault();else a.returnValue=false;if(a.stopPropagation)a.stopPropagation();else a.cancelBubble=true},findElement:function(a,
b){for(var c=Mapabc.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){a=Mapabc.Util.getElement(a);d=d||false;if(b=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent))b="keydown";if(!this.observers)this.observers={};if(!a._eventCacheID){var e="eventCacheID_";if(a.id)e=a.id+"_"+e;a._eventCacheID=Mapabc.Util.createUniqueID(e)}e=a._eventCacheID;this.observers[e]||(this.observers[e]=[]);
this.observers[e].push({element:a,name:b,observer:c,useCapture:d});if(a.addEventListener)a.addEventListener(b,c,d);else a.attachEvent&&a.attachEvent("on"+b,c)},stopObservingElement:function(a){a=Mapabc.Util.getElement(a)._eventCacheID;this._removeElementObservers(Mapabc.Event.observers[a])},_removeElementObservers:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];Mapabc.Event.stopObserving.apply(this,new Array(c.element,c.name,c.observer,c.useCapture))}},stopObserving:function(a,b,c,d){d=
d||false;a=Mapabc.Util.getElement(a);var e=a._eventCacheID;if(b=="keypress")if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)b="keydown";var f=false,g=Mapabc.Event.observers[e];if(g)for(var h=0;!f&&h<g.length;){var i=g[h];if(i.name==b&&i.observer==c&&i.useCapture==d){g.splice(h,1);g.length==0&&delete Mapabc.Event.observers[e];f=true;break}h++}if(f)if(a.removeEventListener)a.removeEventListener(b,c,d);else a&&a.detachEvent&&a.detachEvent("on"+b,c);return f},unloadCache:function(){if(Mapabc.Event&&
Mapabc.Event.observers){for(var a in Mapabc.Event.observers)Mapabc.Event._removeElementObservers.apply(this,[Mapabc.Event.observers[a]]);Mapabc.Event.observers=false}},CLASS_NAME:"Mapabc.Event"};Mapabc.Event.observe(window,"unload",Mapabc.Event.unloadCache,false);if(window.Event)Mapabc.Util.applyDefaults(window.Event,Mapabc.Event);else var Event=Mapabc.Event;
Mapabc.Events=Mapabc.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","contextmenu","menuItemclick","measureend"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(a,b,c,d,e){Mapabc.Util.extend(this,e);this.object=a;this.fallThrough=d;this.listeners={};this.eventHandler=Mapabc.Function.bindAsEventListener(this.handleBrowserEvent,
this);this.clearMouseListener=Mapabc.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(c!=null){a=0;for(d=c.length;a<d;a++)this.addEventType(c[a])}b!=null&&this.attachToElement(b)},destroy:function(){if(this.element){Mapabc.Event.stopObservingElement(this.element);this.element.hasScrollEvent&&Mapabc.Event.stopObserving(window,"scroll",this.clearMouseListener)}this.eventHandler=this.fallThrough=this.eventTypes=this.object=this.listeners=this.element=null},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);
this.listeners[a]=[]}},attachToElement:function(a){this.element&&Mapabc.Event.stopObservingElement(this.element);this.element=a;for(var b=0,c=this.BROWSER_EVENTS.length;b<c;b++){var d=this.BROWSER_EVENTS[b];this.addEventType(d);Mapabc.Event.observe(a,d,this.eventHandler)}Mapabc.Event.observe(a,"dragstart",Mapabc.Event.stop)},on:function(a){for(var b in a)b!="scope"&&this.register(b,a.scope,a[b])},on_dom:function(a){this.register(a.type,a.scope,a.functionName)},register:function(a,b,c){if(c!=null&&
Mapabc.Util.indexOf(this.eventTypes,a)!=-1){if(b==null)b=this.object;this.listeners[a].push({obj:b,func:c})}},registerPriority:function(a,b,c){if(c!=null){if(b==null)b=this.object;a=this.listeners[a];a!=null&&a.unshift({obj:b,func:c})}},un:function(a){for(var b in a)b!="scope"&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){if(b==null)b=this.object;a=this.listeners[a];if(a!=null)for(var d=0,e=a.length;d<e;d++)if(a[d].obj==b&&a[d].func==c){a.splice(d,1);break}},remove:function(a){if(this.listeners[a]!=
null)this.listeners[a]=[]},triggerEvent:function(a,b){var c=this.listeners[a];if(!(!c||c.length==0)){if(b==null)b={};b.object=this.object;b.element=this.element;if(!b.type)b.type=a;c=c.slice();for(var d,e=0,f=c.length;e<f;e++){d=c[e];if(a=="mousefeatureadded")b.sourceobj=c[e].obj;d=d.func.apply(d.obj,[b]);if(d!=undefined&&d==false)break}return d}},handleBrowserEvent:function(a){if(this.includeXY)a.xy=this.getMousePosition(a);this.triggerEvent(a.type,a)},clearMouseCache:function(){this.element.scrolls=
null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){if(this.includeXY){if(!this.element.hasScrollEvent){Mapabc.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}else this.clearMouseCache();if(!this.element.scrolls)this.element.scrolls=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];if(!this.element.lefttop)this.element.lefttop=[document.documentElement.clientLeft||
0,document.documentElement.clientTop||0];if(!this.element.offsets){this.element.offsets=Mapabc.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1]}return new Mapabc.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"Mapabc.Events"});
Mapabc.Format=Mapabc.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){Mapabc.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){return a},write:function(a){return a},CLASS_NAME:"Mapabc.Format"});
Mapabc.Popup.Anchored=Mapabc.Class(Mapabc.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(a,b,c,d,e,f,g,h,i,j,k){Mapabc.Popup.prototype.initialize.apply(this,[a,b,c,d,f,g,h,i,j,k]);this.anchor=e!=null?e:{size:new Mapabc.Size(0,0),offset:new Mapabc.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null;Mapabc.Popup.prototype.destroy.apply(this,arguments)},show:function(){Mapabc.Popup.prototype.show.apply(this,arguments)},moveTo:function(a){var b=this.relativePosition;
this.relativePosition="tr";this.calculateNewPx(a);Mapabc.Popup.prototype.moveTo.apply(this,arguments);this.relativePosition!=b&&this.updateRelativePosition()},setSize:function(){Mapabc.Popup.prototype.setSize.apply(this,arguments);this.lonlat&&this.map&&this.moveTo(this.map.getLayerPxFromLonLat(this.lonlat))},calculateRelativePosition:function(a){a=this.map.getLonLatFromLayerPx(a);a=this.map.getExtent().determineQuadrant(a);return Mapabc.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},
calculateNewPx:function(a){a=a.offset(this.anchor.offset);var b=this.size||this.contentSize,c=this.relativePosition.charAt(0)=="t";a.y+=c?-b.h:this.anchor.size.h;c=this.relativePosition.charAt(1)=="l";a.x+=c?-b.w:this.anchor.size.w;return a},CLASS_NAME:"Mapabc.Popup.Anchored"});
Mapabc.Projection=Mapabc.Class({proj:null,projCode:null,initialize:function(a,b){Mapabc.Util.extend(this,b);this.projCode=a;if(window.Proj4js)this.proj=new Proj4js.Proj(a)},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){return a&&a.getCode?this.getCode()==a.getCode():false},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"Mapabc.Projection"});
Mapabc.Projection.transforms={};Mapabc.Projection.addTransform=function(a,b,c){Mapabc.Projection.transforms[a]||(Mapabc.Projection.transforms[a]={});Mapabc.Projection.transforms[a][b]=c};Mapabc.Projection.transform=function(a,b,c){if(b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else b&&c&&Mapabc.Projection.transforms[b.getCode()]&&Mapabc.Projection.transforms[b.getCode()][c.getCode()]&&Mapabc.Projection.transforms[b.getCode()][c.getCode()](a);return a};
Mapabc.Renderer.Canvas=Mapabc.Class(Mapabc.Renderer,{canvas:null,features:null,geometryMap:null,initialize:function(){Mapabc.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.geometryMap={}},eraseGeometry:function(a){this.eraseFeatures(this.features[this.geometryMap[a.id]][0])},supported:function(){return!!document.createElement("canvas").getContext},setExtent:function(a){this.extent=
a.clone();this.resolution=null;this.redraw()},setSize:function(a){this.size=a.clone();this.root.style.width=a.w+"px";this.root.style.height=a.h+"px";this.root.width=a.w;this.root.height=a.h;this.resolution=null},drawFeature:function(a,b){if(b==null)b=a.style;b=Mapabc.Util.extend({fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1},b);this.features[a.id]=[a,b];if(a.geometry)this.geometryMap[a.geometry.id]=a.id;this.redraw()},drawGeometry:function(a,b){var c=a.CLASS_NAME;
if(c=="Mapabc.Geometry.Collection"||c=="Mapabc.Geometry.MultiPoint"||c=="Mapabc.Geometry.MultiLineString"||c=="Mapabc.Geometry.MultiPolygon")for(c=0;c<a.components.length;c++)this.drawGeometry(a.components[c],b);else switch(a.CLASS_NAME){case "Mapabc.Geometry.Point":this.drawPoint(a,b);break;case "Mapabc.Geometry.LineString":this.drawLineString(a,b);break;case "Mapabc.Geometry.LinearRing":this.drawLinearRing(a,b);break;case "Mapabc.Geometry.Polygon":this.drawPolygon(a,b);break;default:break}},drawExternalGraphic:function(a,
b){var c=new Image;c.src=b.externalGraphic;if(b.graphicTitle)c.title=b.graphicTitle;var d=b.graphicWidth||b.graphicHeight,e=b.graphicHeight||b.graphicWidth;d=d?d:b.pointRadius*2;e=e?e:b.pointRadius*2;c.onload=Mapabc.Function.bind(function(){this.canvas.drawImage(this.img,this.x,this.y,this.width,this.height)},{img:c,x:a[0]+(b.graphicXOffset!=undefined?b.graphicXOffset:-(0.5*d)),y:a[1]+(b.graphicYOffset!=undefined?b.graphicYOffset:-(0.5*e)),width:d,height:e,canvas:this.canvas})},setCanvasStyle:function(a,
b){if(a=="fill"){this.canvas.globalAlpha=b.fillOpacity;this.canvas.fillStyle=b.fillColor}else if(a=="stroke"){this.canvas.globalAlpha=b.strokeOpacity;this.canvas.strokeStyle=b.strokeColor;this.canvas.lineWidth=b.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}},drawPoint:function(a,b){if(b.graphic!==false){var c=this.getLocalXY(a);if(b.externalGraphic)this.drawExternalGraphic(c,b);else{if(b.fill!==false){this.setCanvasStyle("fill",b);this.canvas.beginPath();this.canvas.arc(c[0],
c[1],6,0,Math.PI*2,true);this.canvas.fill()}if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();this.canvas.arc(c[0],c[1],6,0,Math.PI*2,true);this.canvas.stroke();this.setCanvasStyle("reset")}}}},drawLineString:function(a,b){if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();var c=this.getLocalXY(a.components[0]);this.canvas.moveTo(c[0],c[1]);for(c=1;c<a.components.length;c++){var d=this.getLocalXY(a.components[c]);this.canvas.lineTo(d[0],d[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},
drawLinearRing:function(a,b){if(b.fill!==false){this.setCanvasStyle("fill",b);this.canvas.beginPath();var c=this.getLocalXY(a.components[0]);this.canvas.moveTo(c[0],c[1]);for(c=1;c<a.components.length-1;c++){var d=this.getLocalXY(a.components[c]);this.canvas.lineTo(d[0],d[1])}this.canvas.fill()}if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();c=this.getLocalXY(a.components[0]);this.canvas.moveTo(c[0],c[1]);for(c=1;c<a.components.length;c++){d=this.getLocalXY(a.components[c]);
this.canvas.lineTo(d[0],d[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawPolygon:function(a,b){this.drawLinearRing(a.components[0],b);for(var c=1;c<a.components.length;c++)this.drawLinearRing(a.components[c],{fillOpacity:0,strokeWidth:0,strokeOpacity:0,strokeColor:"#000000",fillColor:"#000000"})},drawText:function(a,b){b=Mapabc.Util.extend({fontColor:"#000000",labelAlign:"cm"},b);var c=this.getLocalXY(a);this.setCanvasStyle("reset");this.canvas.fillStyle=b.fontColor;this.canvas.globalAlpha=
1;var d=b.fontWeight+" "+b.fontSize+" "+b.fontFamily;if(this.canvas.fillText){var e=Mapabc.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"middle";this.canvas.font=d;this.canvas.textAlign=e;this.canvas.fillText(b.label,c[0],c[1])}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;d=this.canvas.mozMeasureText(b.label);switch(b.labelAlign[0]){case "l":break;case "r":c[0]-=d;break;case "c":default:c[0]-=d/2}this.canvas.translate(c[0],c[1]);this.canvas.mozDrawText(b.label);this.canvas.translate(-1*
c[0],-1*c[1])}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent;return[a.x/b+-c.left/b,c.top/b-a.y/b]},clear:function(){this.canvas.clearRect(0,0,this.root.width,this.root.height)},getFeatureIdFromEvent:function(a){a=this.map.getLonLatFromPixel(a.xy);var b=this.getResolution();a=(new Mapabc.Bounds(a.lon-b*5,a.lat-b*5,a.lon+b*5,a.lat+b*5)).toGeometry();for(var c in this.features)if(this.features.hasOwnProperty(c))if(this.features[c][0].geometry.intersects(a))return c;
return null},eraseFeatures:function(a){a instanceof Array||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];this.redraw()},redraw:function(){if(!this.locked){this.clear();var a=[],b,c;for(var d in this.features)if(this.features.hasOwnProperty(d)){b=this.features[d][0];c=this.features[d][1];if(b.geometry){this.drawGeometry(b.geometry,c);c.label&&a.push([b,c])}}for(c=0;len=a.length,c<len;++c){b=a[c];this.drawText(b[0].geometry.getCentroid(),b[1])}}},CLASS_NAME:"Mapabc.Renderer.Canvas"});
Mapabc.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right"};
Mapabc.ElementsIndexer=Mapabc.Class({maxZIndex:null,order:null,indices:null,compare:null,feature:null,initialize:function(a){this.compare=a?Mapabc.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:Mapabc.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c=-1,d=this.order.length,e;d-c>1;){e=parseInt((c+d)/2);if(this.compare(this,a,Mapabc.Util.getElement(this.order[e]))>
0)c=e;else d=e}this.order.splice(d,0,b);this.indices[b]=this.getZIndex(a);return this.getNextElement(d)},remove:function(a){a=a.id;var b=Mapabc.Util.indexOf(this.order,a);if(b>=0){this.order.splice(b,1);delete this.indices[a];this.maxZIndex=this.order.length>0?this.indices[this.order[this.order.length-1]]:0}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return this.indices[a.id]!=null},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=
a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b}else if(b>this.maxZIndex)this.maxZIndex=b},getNextElement:function(a){a=a+1;if(a<this.order.length){var b=Mapabc.Util.getElement(this.order[a]);if(b==undefined)b=this.getNextElement(a);return b}else return null},CLASS_NAME:"Mapabc.ElementsIndexer"});
Mapabc.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){b=a.getZIndex(b);var d=0;if(c){a=a.getZIndex(c);d=b-a}return d},Z_ORDER_DRAWING_ORDER:function(a,b,c){a=Mapabc.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&a==0)a=1;return a},Z_ORDER_Y_ORDER:function(a,b,c){a=Mapabc.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&a==0){b=b._geometry.getBounds().bottom;c=c._geometry.getBounds().bottom-b;a=c==0?1:c}return a}};
Mapabc.Renderer.Elements=Mapabc.Class(Mapabc.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",minimumSymbolizer:{strokeLinecap:"round",strokeOpacity:1,strokeDashstyle:"solid",fillOpacity:1,pointRadius:0},initialize:function(a,b){Mapabc.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");
this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering))this.indexer=new Mapabc.ElementsIndexer(b.yOrdering)},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;Mapabc.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){if(this.vectorRoot)for(;this.vectorRoot.childNodes.length>0;)this.vectorRoot.removeChild(this.vectorRoot.firstChild);
if(this.textRoot)for(;this.textRoot.childNodes.length>0;)this.textRoot.removeChild(this.textRoot.firstChild);this.indexer&&this.indexer.clear()},getNodeType:function(){},drawGeometry:function(a,b,c){this.feature=a;var d=a.geometry.CLASS_NAME,e=true;if(d=="Mapabc.Geometry.Collection"||d=="Mapabc.Geometry.MultiPoint"||d=="Mapabc.Geometry.MultiLineString"||d=="Mapabc.Geometry.MultiPolygon"){d=0;for(var f=a.geometry.components.length;d<f;d++)e=this.drawGeometry(a.geometry.components[d],b,c)&&e;return e}e=
false;if(b.display!="none"){b.backgroundGraphic&&this.redrawBackgroundNode(a.geometry.id,a.geometry,b,c);e=this.redrawNode(a.geometry.id,a.geometry,b,c)}if(e==false)if(b=document.getElementById(a.geometry.id)){b._style.backgroundGraphic&&b.parentNode.removeChild(document.getElementById(a.geometry.id+this.BACKGROUND_ID_SUFFIX));b.parentNode.removeChild(b)}return e},redrawNode:function(a,b,c,d){a=this.nodeFactory(d,this.getNodeType(b,c));b.id=d;a._featureId=d;a._geometry=b;a._geometryClass=b.CLASS_NAME;
a._style=c;b=this.drawGeometryNode(a,b,c);if(b===false)return false;a=b.node;if(this.indexer)(c=this.indexer.insert(a))?this.vectorRoot.insertBefore(a,c):this.vectorRoot.appendChild(a);else a.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(a);this.postDraw(a);return b.complete},redrawBackgroundNode:function(a,b,c){c=Mapabc.Util.extend({},c);c.externalGraphic=c.backgroundGraphic;c.graphicXOffset=c.backgroundXOffset;c.graphicYOffset=c.backgroundYOffset;c.graphicZIndex=c.backgroundGraphicZIndex;
c.graphicWidth=c.backgroundWidth||c.graphicWidth;c.graphicHeight=c.backgroundHeight||c.graphicHeight;c.backgroundGraphic=null;c.backgroundXOffset=null;c.backgroundYOffset=null;c.backgroundGraphicZIndex=null;return this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,c,null)},drawGeometryNode:function(a,b,c){c=c||a._style;Mapabc.Util.applyDefaults(c,this.minimumSymbolizer);var d={isFilled:c.fill===undefined?true:c.fill,isStroked:c.stroke===undefined?!!c.strokeWidth:c.stroke},e;switch(b.CLASS_NAME){case "Mapabc.Geometry.Point":if(c.graphic===
false){d.isFilled=false;d.isStroked=false}e=this.drawPoint(a,b);break;case "Mapabc.Geometry.Circle":e=this.drawCircle(a,b,b.radius);break;case "Mapabc.Geometry.LineString":d.isFilled=false;e=this.drawLineString(a,b);break;case "Mapabc.Geometry.LinearRing":e=this.drawLinearRing(a,b);break;case "Mapabc.Geometry.Polygon":e=this.drawPolygon(a,b);break;case "Mapabc.Geometry.Surface":e=this.drawSurface(a,b);break;case "Mapabc.Geometry.Rectangle":e=this.drawRectangle(a,b);break;default:break}a._style=c;
a._options=d;return e!=false?{node:this.setStyle(a,c,d,b),complete:e}:false},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},drawSurface:function(){},removeText:function(a){(a=document.getElementById(a+this.LABEL_ID_SUFFIX))&&this.textRoot.removeChild(a)},getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement;return(c?c:b||a.srcElement)._featureId},
eraseGeometry:function(a){if(a.CLASS_NAME=="Mapabc.Geometry.MultiPoint"||a.CLASS_NAME=="Mapabc.Geometry.MultiLineString"||a.CLASS_NAME=="Mapabc.Geometry.MultiPolygon"||a.CLASS_NAME=="Mapabc.Geometry.Collection"||a.CLASS_NAME=="Mapabc.Geometry.Rectangle")for(var b=0,c=a.components.length;b<c;b++)this.eraseGeometry(a.components[b]);else if((b=Mapabc.Util.getElement(a.id))&&b.parentNode){if(b.geometry){b.geometry.destroy();b.geometry=null}b.parentNode.removeChild(b);this.indexer&&this.indexer.remove(b);
if(b._style.backgroundGraphic)(a=Mapabc.Util.getElement(a.id+this.BACKGROUND_ID_SUFFIX))&&a.parentNode&&a.parentNode.removeChild(a)}},nodeFactory:function(a,b){var c=Mapabc.Util.getElement(a);if(c){if(!this.nodeTypeCompare(c,b)){c.parentNode.removeChild(c);c=this.nodeFactory(a,b)}}else c=this.createNode(b,a);return c},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(a){var b=this.root;if(a.root.parentNode==this.rendererRoot)b=a.root;b.parentNode.removeChild(b);a.rendererRoot.appendChild(b)},
getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return a!="circle"&&!!a},CLASS_NAME:"Mapabc.Renderer.Elements"});Mapabc.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};
Mapabc.Strategy.Cluster=Mapabc.Class(Mapabc.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,initialize:function(a){Mapabc.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=Mapabc.Strategy.prototype.activate.call(this);a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this});return a},deactivate:function(){var a=Mapabc.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,
moveend:this.cluster,scope:this})}return a},cacheFeatures:function(a){var b=true;if(!this.clustering){this.clearCache();this.features=a.features;this.cluster();b=false}return b},clearCache:function(){this.features=null},cluster:function(a){if((!a||a.zoomChanged)&&this.features){a=this.layer.map.getResolution();if(a!=this.resolution||!this.clustersExist()){this.resolution=a;a=[];for(var b,c,d,e=0;e<this.features.length;++e){b=this.features[e];if(b.geometry){c=false;for(var f=0;f<a.length;++f){d=a[f];
if(this.shouldCluster(d,b)){this.addToCluster(d,b);c=true;break}}c||a.push(this.createCluster(this.features[e]))}}this.layer.destroyFeatures();if(a.length>0){if(this.threshold>1){b=a.slice();a=[];e=0;for(d=b.length;e<d;++e){c=b[e];c.attributes.count<this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c)}}this.clustering=true;this.layer.addFeatures(a);this.clustering=false}this.clusters=a}}},clustersExist:function(){var a=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==
this.layer.features.length){a=true;for(var b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=false;break}}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution<=this.distance},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat();
b=new Mapabc.Feature.Vector(new Mapabc.Geometry.Point(b.lon,b.lat),{count:1});b.cluster=[a];return b},CLASS_NAME:"Mapabc.Strategy.Cluster"});
Mapabc.Strategy.Fixed=Mapabc.Class(Mapabc.Strategy,{preload:false,initialize:function(a){Mapabc.Strategy.prototype.initialize.apply(this,[a])},destroy:function(){Mapabc.Strategy.prototype.destroy.apply(this,arguments)},activate:function(){if(Mapabc.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});this.layer.visibility==true||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this});return true}return false},deactivate:function(){var a=
Mapabc.Strategy.prototype.deactivate.call(this);a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return a},load:function(a){this.layer.events.triggerEvent("loadstart");this.layer.protocol.read(Mapabc.Util.applyDefaults({callback:this.merge,scope:this},a));this.layer.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){this.layer.destroyFeatures();if((a=a.features)&&a.length>0){var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b))for(var d,
e=0,f=a.length;e<f;++e)(d=a[e].geometry)&&d.transform(b,c);this.layer.addFeatures(a)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"Mapabc.Strategy.Fixed"});
Mapabc.Strategy.Paging=Mapabc.Class(Mapabc.Strategy,{features:null,length:10,num:null,paging:false,initialize:function(a){Mapabc.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=Mapabc.Strategy.prototype.activate.call(this);a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this});return a},deactivate:function(){var a=Mapabc.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},
cacheFeatures:function(a){if(!this.paging){this.clearCache();this.features=a.features;this.pageNext(a)}},clearCache:function(){if(this.features)for(var a=0;a<this.features.length;++a)this.features[a].destroy();this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(a){if(a&&a>0)this.length=a;return this.length},pageNext:function(a){var b=false;if(this.features){if(this.num===null)this.num=
-1;b=this.page((this.num+1)*this.length,a)}return b},pagePrevious:function(){var a=false;if(this.features){if(this.num===null)this.num=this.pageCount();a=this.page((this.num-1)*this.length)}return a},page:function(a,b){var c=false;if(this.features)if(a>=0&&a<this.features.length){var d=Math.floor(a/this.length);if(d!=this.num){this.paging=true;c=this.features.slice(a,a+this.length);this.layer.removeFeatures(this.layer.features);this.num=d;if(b&&b.features)b.features=c;else this.layer.addFeatures(c);
this.paging=false;c=true}}return c},CLASS_NAME:"Mapabc.Strategy.Paging"});
Mapabc.Strategy.Save=Mapabc.Class(Mapabc.Strategy,{auto:false,timer:null,initialize:function(a){Mapabc.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=Mapabc.Strategy.prototype.activate.call(this);if(a)if(this.auto)if(typeof this.auto==="number")this.timer=window.setInterval(Mapabc.Function.bind(this.save,this),this.auto*1E3);else this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this});return a},deactivate:function(){var a=Mapabc.Strategy.prototype.deactivate.call(this);
if(a)if(this.auto)typeof this.auto==="number"?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this});return a},triggerSave:function(a){var b=a.feature;if(b.state===Mapabc.State.INSERT||b.state===Mapabc.State.UPDATE||b.state===Mapabc.State.DELETE)this.save([a.feature])},save:function(a){if(!a)a=this.layer.features;var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b)){for(var d=a.length,e=
new Array(d),f,g,h=0;h<d;++h){f=a[h];g=f.clone();g.fid=f.fid;g.state=f.state;g._original=f;g.geometry.transform(c,b);e[h]=g}a=e}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){if(a.success()){for(var b=a.reqFeatures,c,d=[],e=a.insertIds||[],f=0,g=0,h=b.length;g<h;++g){c=b[g];c=c._original||c;if(a=c.state){if(a==Mapabc.State.DELETE)d.push(c);else if(a==Mapabc.State.INSERT){c.fid=e[f];++f}c.state=null}}d.length>0&&this.layer.destroyFeatures(d)}},CLASS_NAME:"Mapabc.Strategy.Save"});
Mapabc.Tile=Mapabc.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(a,b,c,d,e){this.layer=a;this.position=b.clone();this.bounds=c.clone();this.url=d;this.size=e.clone();this.id=Mapabc.Util.createUniqueID("Tile_");this.events=new Mapabc.Events(this,null,this.EVENT_TYPES)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.position=
this.size=this.bounds=this.layer=null;this.events.destroy();this.events=null},clone:function(a){if(a==null)a=new Mapabc.Tile(this.layer,this.position,this.bounds,this.url,this.size);Mapabc.Util.applyDefaults(a,this);return a},draw:function(){var a=this.layer.maxExtent;this.shouldDraw=a&&this.bounds.intersectsBounds(a,false)||this.layer.displayOutsideMaxExtent;this.clear();return this.shouldDraw},moveTo:function(a,b,c){if(c==null)c=true;this.bounds=a.clone();this.position=b.clone();c&&this.draw()},
clear:function(){},getBoundsFromBaseLayer:function(a){Mapabc.i18n("reprojectDeprecated",{layerName:this.layer.name});var b=this.layer.map.getLonLatFromLayerPx(a);a=a.clone();a.x+=this.size.w;a.y+=this.size.h;a=this.layer.map.getLonLatFromLayerPx(a);if(b.lon>a.lon)if(b.lon<0)b.lon=-180-(b.lon+180);else a.lon=180+a.lon+180;return new Mapabc.Bounds(b.lon,a.lat,a.lon,b.lat)},showTile:function(){this.shouldDraw&&this.show()},show:function(){},hide:function(){},CLASS_NAME:"Mapabc.Tile"});
Mapabc.Control.MouseToolbar=Mapabc.Class(Mapabc.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(a,b){Mapabc.Control.prototype.initialize.apply(this,arguments);this.position=new Mapabc.Pixel(Mapabc.Control.MouseToolbar.X,Mapabc.Control.MouseToolbar.Y);if(a)this.position=a;if(b)this.direction=b;this.measureDivs=[]},destroy:function(){for(var a in this.buttons){var b=this.buttons[a];b.map=null;b.events.destroy()}Mapabc.Control.MouseDefaults.prototype.destroy.apply(this,
arguments)},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);Mapabc.Control.MouseDefaults.prototype.draw.apply(this,arguments);this.buttons={};var a=new Mapabc.Size(28,28),b=new Mapabc.Pixel(Mapabc.Control.MouseToolbar.X,0);this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",b,a,"Shift->Drag to zoom to area");b=b.add(this.direction=="vertical"?0:a.w,this.direction=="vertical"?a.h:0);this._addButton("pan","panning-hand-off.png","panning-hand-on.png",b,a,"Drag the map to pan.");
b.add(this.direction=="vertical"?0:a.w,this.direction=="vertical"?a.h:0);this.switchModeTo("pan");return this.div},_addButton:function(a,b,c,d,e,f){b=Mapabc.Util.getImagesLocation()+b;c=Mapabc.Util.getImagesLocation()+c;d=Mapabc.Util.createAlphaImageDiv("Mapabc_Control_MouseToolbar_"+a,d,e,b,"absolute");this.div.appendChild(d);d.imgLocation=b;d.activeImgLocation=c;d.events=new Mapabc.Events(this,d,null,true);d.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:Mapabc.Event.stop,scope:this});
d.action=a;d.title=f;d.alt=f;d.map=this.map;return this.buttons[a]=d},buttonDown:function(a){if(Mapabc.Event.isLeftClick(a)){this.buttonClicked=a.element.action;Mapabc.Event.stop(a)}},buttonUp:function(a){if(Mapabc.Event.isLeftClick(a))if(this.buttonClicked!=null){this.buttonClicked==a.element.action&&this.switchModeTo(a.element.action);Mapabc.Event.stop(a);this.buttonClicked=null}},defaultDblClick:function(a){this.switchModeTo("pan");this.performedDrag=false;this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),
this.map.zoom+1);Mapabc.Event.stop(a);return false},defaultMouseDown:function(a){if(Mapabc.Event.isLeftClick(a)){this.mouseDragStart=a.xy.clone();this.startViaKeyboard=this.performedDrag=false;if(a.shiftKey&&this.mode!="zoombox"){this.switchModeTo("zoombox");this.startViaKeyboard=true}else if(a.altKey&&this.mode!="measure")this.switchModeTo("measure");else this.mode||this.switchModeTo("pan");switch(this.mode){case "zoombox":this.map.div.style.cursor="crosshair";this.zoomBox=Mapabc.Util.createDiv("zoomBox",
this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.performedDrag=true;break;case "measure":var b="";if(this.measureStart){b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);b=Mapabc.Util.distVincenty(this.measureStart,b);b=Math.round(b*
100)/100;b+="km";this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart);this.measureBox=Mapabc.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBox.style.width="4px";this.measureBox.style.height="4px";this.measureBox.style.fontSize="1px";this.measureBox.style.backgroundColor="red";this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-
1;this.map.layerContainerDiv.appendChild(this.measureBox);if(b){this.measureBoxDistance=Mapabc.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBoxDistance.innerHTML=b;this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBoxDistance);this.measureDivs.push(this.measureBoxDistance)}this.measureBox.style.zIndex=
this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move";break}document.onselectstart=function(){return false};Mapabc.Event.stop(a)}},switchModeTo:function(a){if(a!=this.mode){this.mode&&this.buttons[this.mode]&&Mapabc.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation);if(this.mode=="measure"&&a!="measure"){for(var b=0,c=this.measureDivs.length;b<
c;b++)this.measureDivs[b]&&this.map.layerContainerDiv.removeChild(this.measureDivs[b]);this.measureDivs=[];this.measureStart=null}this.mode=a;this.buttons[a]&&Mapabc.Util.modifyAlphaImageDiv(this.buttons[a],null,null,null,this.buttons[a].activeImgLocation);switch(this.mode){case "zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor="";break}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(a){if(this.mouseDragStart!=null){switch(this.mode){case "zoombox":var b=
Math.abs(this.mouseDragStart.x-a.xy.x),c=Math.abs(this.mouseDragStart.y-a.xy.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,c)+"px";if(a.xy.x<this.mouseDragStart.x)this.zoomBox.style.left=a.xy.x+"px";if(a.xy.y<this.mouseDragStart.y)this.zoomBox.style.top=a.xy.y+"px";break;default:b=this.mouseDragStart.x-a.xy.x;c=this.mouseDragStart.y-a.xy.y;var d=this.map.getSize();this.map.setCenter(this.map.getLonLatFromViewPortPx(new Mapabc.Pixel(d.w/2+b,d.h/2+c)),null,true);
this.mouseDragStart=a.xy.clone()}this.performedDrag=true}},defaultMouseUp:function(a){if(Mapabc.Event.isLeftClick(a)){switch(this.mode){case "zoombox":this.zoomBoxEnd(a);this.startViaKeyboard&&this.leaveMode();break;case "pan":this.performedDrag&&this.map.setCenter(this.map.center)}this.mouseDragStart=document.onselectstart=null;this.map.div.style.cursor="default"}},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&Mapabc.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();
this.startViaKeyboard&&this.leaveMode()}this.mouseDragStart=null;this.map.div.style.cursor="default"}},defaultClick:function(){if(this.performedDrag)return this.performedDrag=false},CLASS_NAME:"Mapabc.Control.MouseToolbar"});Mapabc.Control.MouseToolbar.X=6;Mapabc.Control.MouseToolbar.Y=300;
Mapabc.Control.NavigationHistory=Mapabc.Class(Mapabc.Control,{type:Mapabc.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,activateOnDraw:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(a){Mapabc.Control.prototype.initialize.apply(this,[a]);this.registry=Mapabc.Util.extend({moveend:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution()}}},this.registry);
this.clear();a={trigger:Mapabc.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};Mapabc.Util.extend(a,this.previousOptions);this.previous=new Mapabc.Control.Button(a);a={trigger:Mapabc.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};Mapabc.Util.extend(a,this.nextOptions);this.next=new Mapabc.Control.Button(a)},onPreviousChange:function(a){if(a&&!this.previous.active)this.previous.activate();else!a&&
this.previous.active&&this.previous.deactivate()},onNextChange:function(a){if(a&&!this.next.active)this.next.activate();else!a&&this.next.active&&this.next.deactivate()},destroy:function(){Mapabc.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();
this.activateOnDraw&&this.activate()},previousTrigger:function(){var a=this.previousStack.shift(),b=this.previousStack.shift();if(b!=undefined){this.nextStack.unshift(a);this.previousStack.unshift(b);this.restoring=true;this.restore(b);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else this.previousStack.unshift(a);return b},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);
this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return a},clear:function(){this.previousStack=[];this.nextStack=[]},restore:function(a){var b=this.map.getZoomForResolution(a.resolution);this.map.setCenter(a.center,b)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=Mapabc.Function.bind(function(){if(!this.restoring){this.previousStack.unshift(this.registry[a].apply(this,
arguments));this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length>this.limit+1&&this.previousStack.pop();if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)},activate:function(){var a=false;if(this.map)if(Mapabc.Control.prototype.activate.apply(this)){this.listeners==null&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,this,this.listeners[b]);a=true;this.previousStack.length==
0&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=false;if(this.map)if(Mapabc.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear();a=true}return a},CLASS_NAME:"Mapabc.Control.NavigationHistory"});
Mapabc.Control.PanPanel=Mapabc.Class(Mapabc.Control.Panel,{initialize:function(a){Mapabc.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new Mapabc.Control.Pan(Mapabc.Control.Pan.NORTH),new Mapabc.Control.Pan(Mapabc.Control.Pan.SOUTH),new Mapabc.Control.Pan(Mapabc.Control.Pan.EAST),new Mapabc.Control.Pan(Mapabc.Control.Pan.WEST)])},CLASS_NAME:"Mapabc.Control.PanPanel"});
Mapabc.Control.PanZoomBar=Mapabc.Class(Mapabc.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:8,slider:null,sliderEvents:null,zoomBarDiv:null,divEvents:null,zoomWorldIcon:false,browserName:0,initialize:function(){this.browserName=window.navigator.userAgent;Mapabc.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});Mapabc.Control.PanZoom.prototype.destroy.apply(this,arguments)},setMap:function(){Mapabc.Control.PanZoom.prototype.setMap.apply(this,
arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(a){Mapabc.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];if(this.flag){var b=new Mapabc.Size(15,15),c=new Mapabc.Size(52,244),d=new Mapabc.Pixel(a.x+b.w/2,a.y),e=new Mapabc.Pixel(d.x-8,d.y+2);this._addButton("panback","backfortencent.png",e,c);c=b.w;d.x+=10;d.y+=4;this._addButton("panup",
"topfortencent.gif",d,b);a.x+=2;a.y=d.y+b.h+1;this._addButton("panleft","leftfortencent.gif",a,b);this._addButton("panright","rightfortencent.gif",a.add(c+15,0),b);this._addButton("pandown","bottomfortencent.gif",d.add(0,b.h*2+1),b);this._addButton("zoomin","zoominfortencent.gif",d.add(-2,b.h*3+13),new Mapabc.Size(18,18));d=this._addZoomBar(d.add(0,0));this._addButton("zoomout","zoomoutfortencent.gif",d.add(1,b.h*5-88),new Mapabc.Size(18,18))}else{b=new Mapabc.Size(12,12);c=new Mapabc.Size(58,220);
d=new Mapabc.Pixel(a.x+b.w/2,a.y);e=new Mapabc.Pixel(d.x-8,d.y+2);this._addButton("panback","back.png",e,c);c=b.w;d.x+=14;d.y+=6;this._addButton("panup","top.gif",d,b);a.x+=2;a.y=d.y+b.h+7;this._addButton("panleft","left.gif",a,b);this._addButton("panright","right.gif",a.add(c+24,0),b);this._addButton("pandown","bottom.gif",d.add(0,b.h*2+13),b);this._addButton("zoomin","zoomin.gif",d.add(0,b.h*3+20),b);d=this._addZoomBar(d.add(0,0));this._addButton("zoomout","zoomout.gif",d.add(-2,b.h*5-77),b)}return this.div},
_addZoomBar:function(a){var b=Mapabc.Util.getImagesLocation(),c=this.id+"_"+this.map.id,d=this.map.getNumZoomLevels()-1;c=this.flag?Mapabc.Util.createAlphaImageDiv(c,a.add(-3,d*this.zoomStopHeight),new Mapabc.Size(20,6),b+"bofortencent.gif","absolute"):Mapabc.Util.createAlphaImageDiv(c,a.add(-1,d*this.zoomStopHeight),new Mapabc.Size(15,15),b+"bo.png","absolute");c.title="\u62d6\u52a8\u7f29\u653e";c.style.cursor="pointer";this.slider=c;this.sliderEvents=new Mapabc.Events(this,c,null,true,{includeXY:true});
this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});d=null;if(this.flag){d=new Mapabc.Size(21,126);a.x-=3;a.y+=82;d=Mapabc.Util.createDiv("Mapabc_Control_PanZoomBar_Zoombar"+this.map.id,a,d,b+"zoombarfortencent.gif")}else{d=new Mapabc.Size(8,126);a.x+=2;a.y+=70;d=Mapabc.Util.createDiv("Mapabc_Control_PanZoomBar_Zoombar"+this.map.id,a,d,b+"zoombar.gif")}d.style.cursor="pointer";this.zoombarDiv=d;this.divEvents=
new Mapabc.Events(this,d,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(d);this.startTop=parseInt(d.style.top);this.div.appendChild(c);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());this.moveZoomBar();return a},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,
mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){if(Mapabc.Event.isLeftClick(a)){var b=
a.xy.y,c=Mapabc.Util.pagePosition(a.object)[1];b=(b-c)/this.zoomStopHeight;this.map.fractionalZoom||(b=Math.floor(b));b=this.map.getNumZoomLevels()-1-b;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);if(b<3)b=3;this.map.zoomTo(b);Mapabc.Event.stop(a)}},zoomBarDown:function(a){if(Mapabc.Event.isLeftClick(a)){this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";
this.zoombarDiv.offsets=null;Mapabc.Event.stop(a)}},zoomBarDrag:function(a){if(this.mouseDragStart!=null){var b=this.mouseDragStart.y-a.xy.y,c=Mapabc.Util.pagePosition(this.zoombarDiv);if(a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-5){this.slider.style.top=parseInt(this.slider.style.top)-b+"px";this.mouseDragStart=a.xy.clone()}Mapabc.Event.stop(a)}},zoomBarUp:function(a){if(Mapabc.Event.isLeftClick(a))if(this.zoomStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,
mousemove:this.passEventToSlider,scope:this});var b=this.zoomStart.y-a.xy.y,c=this.map.zoom;if(this.map.fractionalZoom){c+=b/this.zoomStopHeight;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)}else c+=Math.round(b/this.zoomStopHeight);if(c<3)c=3;if(c>17)c=17;this.map.zoomTo(c);this.moveZoomBar();this.mouseDragStart=null;Mapabc.Event.stop(a)}},moveZoomBar:function(){var a=this;setTimeout(function(){if(a.map){var b=(a.map.getNumZoomLevels()-1-a.map.getZoom())*a.zoomStopHeight+a.startTop+2;a.slider.style.top=
b+"px"}},300)},CLASS_NAME:"Mapabc.Control.PanZoomBar"});Mapabc.Control.ZoomPanel=Mapabc.Class(Mapabc.Control.Panel,{initialize:function(a){Mapabc.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new Mapabc.Control.ZoomIn,new Mapabc.Control.ZoomToMaxExtent,new Mapabc.Control.ZoomOut])},CLASS_NAME:"Mapabc.Control.ZoomPanel"});
Mapabc.Handler=Mapabc.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(a,b,c){Mapabc.Util.extend(this,c);this.control=a;this.callbacks=b;a.map&&this.setMap(a.map);Mapabc.Util.extend(this,c);this.id=Mapabc.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(this.keyMask==null)return true;return((a.shiftKey?Mapabc.Handler.MOD_SHIFT:0)|(a.ctrlKey?Mapabc.Handler.MOD_CTRL:0)|(a.altKey?Mapabc.Handler.MOD_ALT:0))==
this.keyMask},activate:function(){if(this.active)return false;for(var a=Mapabc.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=true},deactivate:function(){if(!this.active)return false;for(var a=Mapabc.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);this.active=false;return true},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,
b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"Mapabc.Handler"});Mapabc.Handler.MOD_NONE=0;Mapabc.Handler.MOD_SHIFT=1;Mapabc.Handler.MOD_CTRL=2;Mapabc.Handler.MOD_ALT=4;
Mapabc.Label=Mapabc.Class({lonlat:null,events:null,map:null,div:null,id:null,labelAlign:1,labelPosition:new MPoint(0,0),initialize:function(a,b){this.lonlat=a;this.id=b.id;if(!this.id)this.id=Mapabc.Util.createUniqueID("Label");if(b.content!=""){this.div=Mapabc.Util.createDiv(this.id);this.div.innerHTML=b.content;this.div.style.fontSize=b.fontSize+"px";this.div.style.color=b.fontColor;this.div.style.fontFamily=b.fontFamily;this.div.style.wordBreak="keep-all";this.div.style.whiteSpace="nowrap";this.div.style.cursor=
"pointer";if(b.fontWeight)this.div.style.fontWeight="bold";if(b.offset){this.div.style.marginLeft=b.offset.x+"px";this.div.style.marginTop=b.offset.y+"px"}this.labelAlign=b.labelAlign;this.labelPosition=b.labelPosition;this.div.style.opacity=b.alpha;this.div.style.filter=" alpha(opacity="+b.alpha*100+")";if(b.hasBackground)this.div.style.backgroundColor=b.backgroundColor;if(b.hasBorder){this.div.style.borderColor=b.borderColor;this.div.style.borderWidth="1px";this.div.style.borderStyle="solid"}this.events=
new Mapabc.Events(this,this.div,null)}},destroy:function(){this.div!=null&&Mapabc.Element.remove(this.div);this.map=null;this.events.destroy();this.events=null},draw:function(a){Mapabc.Util.modifyDOMElement(this.div,null,null,this.size,this.url);this.moveTo(a);return this.div},erase:function(){this.div!=null&&this.div.parentNode!=null&&Mapabc.Element.remove(this.div)},setOpacity:function(a){Mapabc.Util.modifyAlphaImageDiv(this.div,null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null)this.px=
a;if(this.div!=null)if(this.px==null)this.display(false);else{if(this.calculateOffset)this.offset=this.calculateOffset(this.size);a=this.px.offset(this.offset);var b=this.labelPosition,c=Mapabc.Util.getOffXY(this.labelAlign,new Mapabc.Size(this.div.offsetWidth,this.div.offsetHeight));c.x-=b.x;c.y-=b.y;a.x-=c.x;a.y-=c.y;Mapabc.Util.modifyDOMElement(this.div,null,a)}},isDrawn:function(){return navigator.appVersion.indexOf("MSIE 6.0")!=-1||navigator.appVersion.indexOf("MSIE 7.0")!=-1?this.div&&this.div.parentNode&&
this.div.parentNode.nodeType!=11&&this.div.parentNode.nodeType!=9:this.div&&this.div.parentNode&&this.div.parentNode.nodeType!=11},getBounds:function(){return new Mapabc.Bounds(this.lonlat.lon,this.lonlat.lat,this.lonlat.lon,this.lonlat.lat)},onScreen:function(){var a=false;if(this.map)a=this.map.getExtent().containsLonLat(this.lonlat);return a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"Mapabc.Label"});
Mapabc.Map=Mapabc.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1E3},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomstart","zoomchanged","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,
layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,defaultcenter:null,defaultzoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:Mapabc.Easing.Expo.easeOut,
panDuration:50,paddingForPopups:null,zoomEnabled:true,dragEnabled:true,isContinuous:false,ameMap:null,returnCoordType:null,zoomArr:null,zoom_index:0,zoom_center:null,navigation:null,isTraffic:false,isSatellite:false,isUsermap:false,isCustommap:false,traffic:null,satellite:null,usermap:null,custommap:null,minZoomLevel:3,maxZoomLevel:17,logoUrl:null,M_AMEMAP_ARRAY:[],initialize:function(a,b){if(arguments.length===1&&typeof a==="object")a=(b=a)&&b.div;_MAPABC_MAP_=this;this.tileSize=new Mapabc.Size(Mapabc.Map.TILE_WIDTH,
Mapabc.Map.TILE_HEIGHT);this.maxExtent=new Mapabc.Bounds(-180,-90,180,90);this.paddingForPopups=new Mapabc.Bounds(15,15,15,15);this.theme=Mapabc._getScriptLocation()+"css/ameStyle_mapabc.css";Mapabc.Util.extend(this,b);this.navigation=new Mapabc.Control.Navigation;this.id=Mapabc.Util.createUniqueID("Mapabc.Map_");this.div=Mapabc.Util.getElement(a);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}Mapabc.Element.addClass(this.div,"olMap");var c=
this.div.id+"_Mapabc_ViewPort";this.viewPortDiv=Mapabc.Util.createDiv(c,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.viewPortDiv.style.background="url("+(Mapabc.Util.getImagesLocation()+"transparent.png")+")";this.div.appendChild(this.viewPortDiv);c=this.div.id+"_Mapabc_Container";this.layerContainerDiv=Mapabc.Util.createDiv(c);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-
1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new Mapabc.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();this.eventListeners instanceof Object&&this.events.on(this.eventListeners);this.events.register("movestart",this,this.updateSize);if(Mapabc.String.contains(navigator.appName,"Microsoft"))this.events.register("resize",this,this.updateSize);else{this.updateSizeDestroy=Mapabc.Function.bind(this.updateSize,this);Mapabc.Event.observe(window,
"resize",this.updateSizeDestroy)}if(this.theme){c=true;for(var d=document.getElementsByTagName("link"),e=0,f=d.length;e<f;++e)if(Mapabc.Util.isEquivalentUrl(d.item(e).href,this.theme)){c=false;break}if(c){c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(c)}}this.layers=[];if(this.controls==null)this.controls=Mapabc.Control!=null?[new Mapabc.Control.Navigation,
new Mapabc.Control.PanZoom,new Mapabc.Control.Attribution]:[];e=0;for(f=this.controls.length;e<f;e++)this.addControlToMap(this.controls[e]);this.popups=[];this.unloadDestroy=Mapabc.Function.bind(this.destroy,this);Mapabc.Event.observe(window,"unload",this.unloadDestroy)},render:function(a){this.div=Mapabc.Util.getElement(a);Mapabc.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);
this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return false;Mapabc.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy?Mapabc.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize);this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a)this.controls[a].destroy();this.controls=null}if(this.layers!=
null){for(a=this.layers.length-1;a>=0;--a)this.layers[a].destroy(false);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv);this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}},setOptions:function(a){Mapabc.Util.extend(this,a)},getTileSize:function(){return this.tileSize},setDragEnabled:function(a){if(a==true){this.dragEnabled=a;this.controls[0]&&this.controls[0].dragPan.activate()}else if(a==false){this.dragEnabled=a;this.controls[0]&&
this.controls[0].dragPan.deactivate()}},setZoomWheelEnabled:function(a){if(a==true){if(this.controls[0]){this.controls[0].zoomWheelEnabled=a;this.controls[0].handlers.wheel.activate()}}else if(a==false)if(this.controls[0]){this.controls[0].zoomWheelEnabled=a;this.controls[0].handlers.wheel.deactivate()}},getBy:function(a,b,c){var d=typeof c.test=="function";return Mapabc.Array.filter(this[a],function(e){return e[b]==c||d&&c.test(e[b])})},getLayersBy:function(a,b){return this.getBy("layers",a,b)},
getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+b*5)},resetLayersZIndex:function(){for(var a=
0,b=this.layers.length;a<b;a++)this.setLayerZIndex(this.layers[a],a)},addLayer:function(a){for(var b=0,c=this.layers.length;b<c;b++)if(this.layers[b]==a)return false;if(this.allOverlays)a.isBaseLayer=false;this.events.triggerEvent("preaddlayer",{layer:a});a.div.className="olLayerDiv";a.div.style.overflow="";this.setLayerZIndex(a,this.layers.length);a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div);this.layers.push(a);a.setMap(this);if(a.isBaseLayer||this.allOverlays&&
!this.baseLayer)this.baseLayer==null?this.setBaseLayer(a):a.setVisibility(false);else a.redraw();this.events.triggerEvent("addlayer",{layer:a});a.afterAdd()},addLayers:function(a){for(var b=0,c=a.length;b<c;b++)this.addLayer(a[b])},removeLayer:function(a,b){if(b==null)b=true;a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div);Mapabc.Util.removeItem(this.layers,a);a.removeMap(this);a.map=null;if(this.baseLayer==a){this.baseLayer=null;if(b)for(var c=0,d=this.layers.length;c<
d;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:a})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return Mapabc.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(b<0)b=0;else if(b>this.layers.length)b=this.layers.length;if(c!=b){this.layers.splice(c,1);this.layers.splice(b,0,a);c=0;for(var d=this.layers.length;c<d;c++)this.setLayerZIndex(this.layers[c],
c);this.events.triggerEvent("changelayer",{layer:a,property:"order"});if(this.allOverlays)if(b===0)this.setBaseLayer(a);else this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0])}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){var b=null;if(this.baseLayer)b=this.baseLayer.getExtent();if(a!=this.baseLayer)if(Mapabc.Util.indexOf(this.layers,a)!=-1){this.baseLayer!=null&&!this.allOverlays&&this.baseLayer.setVisibility(false);this.baseLayer=
a;this.viewRequestID++;if(!this.allOverlays)this.baseLayer.visibility=true;a=this.getCenter();if(a!=null){a=b?b.getCenterLonLat():a;b=b?this.getZoomForExtent(b,true):this.getZoomForResolution(this.resolution,true);this.setCenter(a,b,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a);this.addControlToMap(a,b)},addControlToMap:function(a,b){a.outsideViewport=a.div!=null;if(this.displayProjection&&!a.displayProjection)a.displayProjection=
this.displayProjection;a.setMap(this);var c=a.draw(b);if(c)if(!a.outsideViewport){c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(c)}},getControl:function(a){for(var b=null,c=0,d=this.controls.length;c<d;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){if(a&&a==this.getControl(a.id)){a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div);Mapabc.Util.removeItem(this.controls,a)}},addPopup:function(a,
b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);a.map=this;this.popups.push(a);if(c=a.draw()){c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(c)}},removePopup:function(a){Mapabc.Util.removeItem(this.popups,a);if(a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(b){}a.map=null},getSize:function(){var a=null;if(this.size!=null)a=this.size.clone();return a},updateSize:function(){this.events.clearMouseCache();var a=
this.getCurrentSize(),b=this.getSize();if(b==null)this.size=b=a;if(!a.equals(b)){this.size=a;b=0;for(var c=this.layers.length;b<c;b++)this.layers[b].onMapResize();if(this.baseLayer!=null){this.getLonLatFromViewPortPx(new Mapabc.Pixel(a.w/2,a.h/2));a=this.getZoom();this.zoom=null;this.setCenter(this.getCenter(),a)}}},getCurrentSize:function(){var a=new Mapabc.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){var b=Mapabc.Element.getDimensions(this.div);a.w=
b.width;a.h=b.height}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height)}return a},calculateBounds:function(a,b){var c=null;if(a==null)a=this.getCenter();if(b==null)b=this.getResolution();if(a!=null&&b!=null){var d=this.getSize();c=d.w*b;d=d.h*b;c=new Mapabc.Bounds(a.lon-c/2,a.lat-d/2,a.lon+c/2,a.lat+d/2)}return c},getCenter:function(){var a=null;if(this.center)a=this.center.clone();return a},getZoom:function(){return this.zoom},pan:function(a,
b,c,d,e){c=Mapabc.Util.applyDefaults(c,{animate:true,dragging:false});var f=this.getViewPortPxFromLonLat(this.getCenter());a=f.add(a,b);if(!c.dragging||!a.equals(f)){f=this.getLonLatFromViewPortPx(a);c.animate?this.panTo(f,d,e):this.setCenter(f,null,c.dragging)}},panTo:function(a,b,c){if(!this.panTween)this.panTween=new Mapabc.Tween(this.panMethod);var d=this.getCenter();if(!(a.lon==d.lon&&a.lat==d.lat)){if(b)this.panDuration=b;if(!c||c=="undefined")c=SLIDING_LINEAR;b={lon:d.lon,lat:d.lat};a={lon:a.lon,
lat:a.lat};this.panTween.easing=Mapabc.Easing[c].easeOut;this.panTween.start(b,a,this.panDuration,{callbacks:{start:Mapabc.Function.bind(function(){this.events.triggerEvent("movestart")},this),eachStep:Mapabc.Function.bind(function(e){e=new Mapabc.LonLat(e.lon,e.lat);this.moveTo(e,this.zoom,{dragging:true,noEvent:true})},this),done:Mapabc.Function.bind(function(e){e=new Mapabc.LonLat(e.lon,e.lat);this.moveTo(e,this.zoom,{noEvent:true});this.events.triggerEvent("moveend")},this)}})}},setCenter:function(a,
b,c,d){this.moveTo(a,b,{dragging:c,forceZoomChange:d,caller:"setCenter"})},moveTo:function(a,b,c){c||(c={});var d=c.dragging,e=c.forceZoomChange,f=c.noEvent;this.panTween&&c.caller=="setCenter"&&this.panTween.stop();if(!this.center&&!this.isValidLonLat(a))a=this.maxExtent.getCenterLonLat();if(!this.zoomEnabled&&this.getZoom())b=this.getZoom();if(this.restrictedExtent!=null){if(a==null)a=this.getCenter();if(b==null)b=this.getZoom();c=this.getResolutionForZoom(b);c=this.calculateBounds(a,c);if(!this.restrictedExtent.containsBounds(c)){var g=
this.restrictedExtent.getCenterLonLat();if(c.getWidth()>this.restrictedExtent.getWidth())a=new Mapabc.LonLat(g.lon,a.lat);else if(c.left<this.restrictedExtent.left)a=a.add(this.restrictedExtent.left-c.left,0);else if(c.right>this.restrictedExtent.right)a=a.add(this.restrictedExtent.right-c.right,0);if(c.getHeight()>this.restrictedExtent.getHeight())a=new Mapabc.LonLat(a.lon,g.lat);else if(c.bottom<this.restrictedExtent.bottom)a=a.add(0,this.restrictedExtent.bottom-c.bottom);else if(c.top>this.restrictedExtent.top)a=
a.add(0,this.restrictedExtent.top-c.top)}}(e=e||this.isValidZoomLevel(b)&&b!=this.getZoom())&&this.events.triggerEvent("zoomstart");c=this.isValidLonLat(a)&&!a.equals(this.center);if(e||c||!d){!this.dragging&&!f&&c&&this.events.triggerEvent("movestart");if(c){!e&&this.center&&this.centerLayerContainer(a);this.center=a.clone()}if(e||this.layerContainerOrigin==null){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}this.zoom_index=
1;if(this.zoom<b)this.zoomArr=[[256],[299],[342],[385],[428],[471],[512]];else if(this.zoom>b)this.zoomArr=[[256],[235],[214],[193],[172],[151],[128]];if(e){this.zoom=b;this.resolution=this.getResolutionForZoom(b);this.viewRequestID++}b=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(b,e,d);d?this.baseLayer.events.triggerEvent("move"):this.baseLayer.events.triggerEvent("moveend")}b=this.baseLayer.getExtent();g=0;for(var h=this.layers.length;g<h;g++){var i=this.layers[g];if(i!==
this.baseLayer&&!i.isBaseLayer){var j=i.calculateInRange();if(i.inRange!=j){(i.inRange=j)||i.display(false);this.events.triggerEvent("changelayer",{layer:i,property:"visibility"})}if(j&&i.visibility){i.moveTo(b,e,d);d?i.events.triggerEvent("move"):i.events.triggerEvent("moveend")}}}if(e){g=0;for(h=this.popups.length;g<h;g++)this.popups[g].updatePosition()}c&&!e&&this.events.triggerEvent("move");if(e){this.events.triggerEvent("zoomchanged");this.events.triggerEvent("zoomend")}}!d&&!f&&this.isValidLonLat(a)&&
this.events.triggerEvent("moveend");this.dragging=!!d},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin);a=this.getViewPortPxFromLonLat(a);if(b!=null&&a!=null){this.layerContainerDiv.style.left=Math.round(b.x-a.x)+"px";this.layerContainerDiv.style.top=Math.round(b.y-a.y)+"px"}},isValidZoomLevel:function(a){var b=this.minZoomLevel>3?this.minZoomLevel:0;return a!=null&&a>=b&&a<=this.maxZoomLevel},isValidLonLat:function(a){var b=false;if(a!=null)b=this.getMaxExtent().containsLonLat(a);
return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;if(this.baseLayer!=null)a=this.baseLayer.projection;return a},getMaxResolution:function(){var a=null;if(this.baseLayer!=null)a=this.baseLayer.maxResolution;return a},getMaxExtent:function(a){var b=null;if(a&&a.restricted&&this.restrictedExtent)b=this.restrictedExtent;else if(this.baseLayer!=null)b=this.baseLayer.maxExtent;return b},getNumZoomLevels:function(){var a=
null;if(this.baseLayer!=null)a=this.baseLayer.numZoomLevels;return a},getExtent:function(){var a=null;if(this.baseLayer!=null)a=this.baseLayer.getExtent();return a},getResolution:function(){var a=null;if(this.baseLayer!=null)a=this.baseLayer.getResolution();return a},getUnits:function(){var a=null;if(this.baseLayer!=null)a=this.baseLayer.units;return a},getScale:function(){var a=null;if(this.baseLayer!=null){a=this.getResolution();a=Mapabc.Util.getScaleFromResolution(a,this.baseLayer.units)}return a},
getZoomForExtent:function(a,b){var c=null;if(this.baseLayer!=null)c=this.baseLayer.getZoomForExtent(a,b);return c},getResolutionForZoom:function(a){var b=null;if(this.baseLayer)b=this.baseLayer.getResolutionForZoom(a);return b},getZoomForResolution:function(a,b){var c=null;if(this.baseLayer!=null)c=this.baseLayer.getZoomForResolution(a,b);return c},zoomTo:function(a){this.isValidZoomLevel(a)&&this.setCenter(null,a)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){var a=this.getZoom()-
1;if(a<3)a=3;this.zoomTo(a)},bw_out:null,bw_in:null,variable:1,getTimeout:function(a,b,c){return window.setTimeout(function(){b.apply(a)},c)},magnifyingglassZoomOut:function(a){if(this.variable==1){var b=Mapabc.Util.getElement("map_magnifyingglass");if(b){b.style.width=111;b.style.height=74;this.evt=a;this.out()}}},magnifyingglassZoomIn:function(a){if(this.variable==1){var b=Mapabc.Util.getElement("map_magnifyingglass");if(b){b.style.width="27px";b.style.height="24px";this.evt=a;this.in_()}}},out:function(){this.Rx1(true)},
in_:function(){this.Rx1(false)},Rx1:function(a){var b=Mapabc.Util.getElement("map_magnifyingglass");if(this.variable<=4){if(b){var c=1,d;if(a){d=parseInt(b.style.width);obj_h=parseInt(b.style.height);c*=15;if(d>=30){if(d&&c)b.style.width=Math.abs(d-(c+6))+"px";if(obj_h>=25)if(obj_h&&c)b.style.height=Math.abs(obj_h-c)+"px";b.style.left=this.evt.xy.x-parseInt(b.style.width)/2+"px";b.style.top=this.evt.xy.y-parseInt(b.style.height)/2+"px";b.childNodes[0].style.borderWidth="0px 2px 2px 0px";b.childNodes[0].style.borderStyle=
"solid";b.childNodes[0].style.borderColor="red";b.childNodes[1].style.borderWidth="0px 0px 2px 2px";b.childNodes[1].style.borderStyle="solid";b.childNodes[1].style.borderColor="red";b.childNodes[2].style.borderWidth="2px 0px 0px 2px";b.childNodes[2].style.borderStyle="solid";b.childNodes[2].style.borderColor="red";b.childNodes[3].style.borderWidth="2px 2px 0px 0px";b.childNodes[3].style.borderStyle="solid";b.childNodes[3].style.borderColor="red";b.childNodes[2].style.top=b.style.height;b.childNodes[3].style.top=
b.style.height;b.style.display="";b.style.zIndex=1010}this.variable++;this.bw_out=this.getTimeout(this,a?this.out:this.in_,60)}else{d=parseInt(b.style.width);obj_h=parseInt(b.style.height);c*=15;if(d<=111){b.style.width=Math.abs(d+c)+"px";if(obj_h<=64)b.style.height=Math.abs(obj_h+c)+"px";b.style.left=this.evt.xy.x-parseInt(b.style.width)/2+"px";b.style.top=this.evt.xy.y-parseInt(b.style.height)/2+"px";b.childNodes[0].style.borderWidth="2px 0px 0px 2px";b.childNodes[0].style.borderStyle="solid";b.childNodes[0].style.borderColor=
"red";b.childNodes[1].style.borderWidth="2px 2px 0px 0px";b.childNodes[1].style.borderStyle="solid";b.childNodes[1].style.borderColor="red";b.childNodes[2].style.borderWidth="0px 2px 2px 0px";b.childNodes[2].style.borderStyle="solid";b.childNodes[2].style.borderColor="red";b.childNodes[3].style.borderWidth="0px 0px 2px 2px";b.childNodes[3].style.borderStyle="solid";b.childNodes[3].style.borderColor="red";b.childNodes[2].style.top=b.style.height;b.childNodes[3].style.top=b.style.height;b.style.display=
"";b.style.zIndex=1010}this.variable++;this.bw_in=this.getTimeout(this,a?this.out:this.in_,100)}}}else{if(a){window.clearTimeout(this.bw_out);this.bw_out=null}else{window.clearTimeout(this.bw_in);this.bw_in=null}this.variable=1;b.style.display="none";b.style.zIndex=0;b.style.width="111px";b.style.height="74px"}},zoomToExtent:function(a,b,c){var d=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){d=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=d.getWidth();d=a.getCenterLonLat().wrapDateLine(d)}c||
(c=0);this.setCenter(d,this.getZoomForExtent(a,b)+c)},zoomToMaxExtent:function(a){this.zoomToExtent(this.getMaxExtent({restricted:a?a.restricted:true}))},zoomToScale:function(a,b){var c=Mapabc.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.getSize(),e=d.w*c;c=d.h*c;d=this.getCenter();this.zoomToExtent(new Mapabc.Bounds(d.lon-e/2,d.lat-c/2,d.lon+e/2,d.lat+c/2),b)},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null)b=this.baseLayer.getLonLatFromViewPortPx(a);return b},
getViewPortPxFromLonLat:function(a){var b=null;if(this.baseLayer!=null)b=this.baseLayer.getViewPortPxFromLonLat(a);return b},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){a=this.getViewPortPxFromLonLat(a);a.x=Math.round(a.x);a.y=Math.round(a.y);return a},getViewPortPxFromLayerPx:function(a){var b=null;if(a!=null){b=parseInt(this.layerContainerDiv.style.left);var c=parseInt(this.layerContainerDiv.style.top);b=a.add(b,c)}return b},getLayerPxFromViewPortPx:function(a){var b=
null;if(a!=null){b=-parseInt(this.layerContainerDiv.style.left);var c=-parseInt(this.layerContainerDiv.style.top);b=a.add(b,c);if(isNaN(b.x)||isNaN(b.y))b=null}return b},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){return this.getLayerPxFromViewPortPx(this.getPixelFromLonLat(a))},onmousedown:function(a){Mapabc.Event.stop(a,true)},onmousemove:function(a){Mapabc.Event.stop(a,true)},onmouseup:function(a){Mapabc.Event.stop(a,
true)},onmouseout:function(a){Mapabc.Event.stop(a,true)},oncontextmenu:function(a){Mapabc.Event.stop(a,true)},onclick:function(a){Mapabc.Event.stop(a,true)},ondblclick:function(a){Mapabc.Event.stop(a,true)},getAmeMapObj:function(a){var b=_MAPABC_MAP_.M_AMEMAP_ARRAY.length;if(b!=null||b!=undefined)for(var c=0;c<b;c++)if(a==_MAPABC_MAP_.M_AMEMAP_ARRAY[c].key)return _MAPABC_MAP_.M_AMEMAP_ARRAY[c].value},_MMAPABC_EVENT_MOUSEMOVE_:function(a){var b=_MAPABC_MAP_.getAmeMapObj(a.object.id);a=LonLatToMLngLat(b.map.getLonLatFromPixel(new Mapabc.Pixel(a.xy.x,
a.xy.y)));b.saveOverlay.lnglat=a;b.updateOverlay(b.saveOverlay);a=b.map.getPixelFromLonLat(MLngLatToLonLat(a));var c=new MPoint(a.x+b.saveOverlay.size.width,a.y+b.saveOverlay.size.height),d=b.getSize();c.x>d.width-20&&b.panBy(new MSize(100,0));a.x<20&&b.panBy(new MSize(-100,0));a.y<60&&b.panBy(new MSize(0,-100));c.y>d.height-30&&b.panBy(new MSize(0,100))},_MMAPABC_EVENT_MOUSEUP_:null,CLASS_NAME:"Mapabc.Map"});Mapabc.Map.TILE_WIDTH=256;Mapabc.Map.TILE_HEIGHT=256;
Mapabc.Marker=Mapabc.Class({icon:null,lonlat:null,offset:null,events:null,map:null,label:null,id:null,zIndex:0,overlay:null,markerImg:null,initialize:function(a,b,c){this.lonlat=a;b=b?b:Mapabc.Marker.defaultIcon();if(this.icon==null)this.icon=b;else{this.icon.url=b.url;this.icon.size=b.size;this.icon.offset=b.offset;this.icon.calculateOffset=b.calculateOffset}if(c&&c.labelOption)this.label=new Mapabc.Label(a,c.labelOption);if(c){this.offset=c.offset;this.id=c.id;this.zIndex=c.zIndex;this.overlay=
c.overlay}if(this.id)this.icon.imageDiv.id=this.id;this.id=this.icon.imageDiv.id;this.events=new Mapabc.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(a){return this.icon.draw(a)},erase:function(){this.icon!=null&&this.icon.erase();this.label!=null&&Mapabc.Element.remove(this.label.div)},moveTo:function(a,b){a!=null&&this.icon!=null&&this.icon.moveTo(a);
if(this.label){this.label.lonlat=this.map.getLonLatFromPixel(a);this.label.moveTo(a)}if(!b)this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},getBounds:function(){return new Mapabc.Bounds(this.lonlat.lon,this.lonlat.lat,this.lonlat.lon,this.lonlat.lat)},onScreen:function(){var a=false;if(this.map)a=this.map.getExtent().containsLonLat(this.lonlat);return a},inflate:function(a){this.icon&&this.icon.setSize(new Mapabc.Size(this.icon.size.w*a,this.icon.size.h*
a))},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},rotate:function(a,b){var c=Mapabc.Util.getElement(this.id+"_innerImage");c.angle=0;c.angle=b?a:((c.angle==undefined?0:c.angle)+a)%360;var d=c.angle>=0?Math.PI*c.angle/180:Math.PI*(360+c.angle)/180,e=Math.cos(d),f=Math.sin(d);if(document.all&&!window.opera){var g=document.createElement("img");g.src=c.src;g.height=c.height;g.width=c.width;g.galleryImg=c.galleryImg;g.style.position=
"relative";g.style.alt=c.style.alt;g.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+e+",M12="+-f+",M21="+f+",M22="+e+",SizingMethod='auto expand')"}else{g=document.createElement("canvas");if(c.oImage)g.oImage=c.oImage;else{g.oImage=new Image;g.oImage.src=c.src}g.galleryImg=c.galleryImg;g.style.position="relative";g.style.alt=c.style.alt;g.style.width=g.width=Math.abs(e*g.oImage.width)+Math.abs(f*g.oImage.height);g.style.height=g.height=Math.abs(e*g.oImage.height)+Math.abs(f*g.oImage.width);
var h=g.getContext("2d");h.save();if(d<=Math.PI/2)h.translate(f*g.oImage.height,0);else if(d<=Math.PI)h.translate(g.width,-e*g.oImage.height);else d<=1.5*Math.PI?h.translate(-e*g.oImage.width,g.height):h.translate(0,-f*g.oImage.width);h.rotate(d);h.drawImage(g.oImage,0,0,g.oImage.width,g.oImage.height);h.restore()}g.id=c.id;g.angle=c.angle;if(navigator.appVersion.indexOf("MSIE 6.0")!=-1)c.parentNode.style.filter="";c.parentNode.replaceChild(g,c)},CLASS_NAME:"Mapabc.Marker"});
Mapabc.Marker.defaultIcon=function(){var a=Mapabc.Util.getImagesLocation()+"marker.png",b=new Mapabc.Size(21,25);return new Mapabc.Icon(a,b,null,function(c){return new Mapabc.Pixel(-(c.w/2),-c.h)})};
Mapabc.Popup.AnchoredBubble=Mapabc.Class(Mapabc.Popup.Anchored,{rounded:false,initialize:function(){this.padding=new Mapabc.Bounds(0,Mapabc.Popup.AnchoredBubble.CORNER_SIZE,0,Mapabc.Popup.AnchoredBubble.CORNER_SIZE);Mapabc.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(){Mapabc.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(){Mapabc.Popup.Anchored.prototype.setSize.apply(this,
arguments);this.setRicoCorners()},setBackgroundColor:function(a){if(a!=undefined)this.backgroundColor=a;if(this.div!=null)if(this.contentDiv!=null){this.div.style.background="transparent";Mapabc.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)}},setOpacity:function(a){Mapabc.Popup.Anchored.prototype.setOpacity.call(this,a);this.div!=null&&this.groupDiv!=null&&Mapabc.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var a=
{corners:this.getCornersToRound(this.relativePosition),color:this.backgroundColor,bgColor:"transparent",blend:false};if(this.rounded){Mapabc.Rico.Corner.reRound(this.groupDiv,a);this.setBackgroundColor();this.setOpacity()}else{Mapabc.Rico.Corner.round(this.div,a);this.rounded=true}},getCornersToRound:function(){var a=["tl","tr","bl","br"],b=Mapabc.Bounds.oppositeQuadrant(this.relativePosition);Mapabc.Util.removeItem(a,b);return a.join(" ")},CLASS_NAME:"Mapabc.Popup.AnchoredBubble"});
Mapabc.Popup.AnchoredBubble.CORNER_SIZE=5;
Mapabc.Popup.Framed=Mapabc.Class(Mapabc.Popup.Anchored,{_THBorder:null,_BHBorder:null,_Bar:null,imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(a,b,c,d,e,f){Mapabc.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(){return this.relativePosition}}if(f&&this.closeDiv)this.closeDiv.style.zIndex=2},destroy:function(){this.isAlphaImage=
this.imageSize=this.imageSrc=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image);b.image=null;b.div&&this.groupDiv.removeChild(b.div);b.div=null}this.blocks=null;Mapabc.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){Mapabc.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},
updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv)if(this.tipOption.tipType==1){var a=this.getContentDivPadding();if(a!=null){this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+2+"px"}}this.updateBlocks()},calculateNewPx:function(){var a=Mapabc.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return a=a.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=
[];for(var a in this.positionBlocks)break;if(this.tipOption.tipType==1){a=0;a=Mapabc.String.contains(navigator.appName,"Microsoft")?"filter:alpha(opacity="+parseFloat(this.tipOption.alpha)*100+");":"opacity:"+this.tipOption.alpha;this._THBorder=Mapabc.Util.createDiv("_THBorder");this._THBorder.style.zIndex="100";this._THBorder.style.position="relative";this._THBorder.innerHTML='<b class="MAME_b1" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+
Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+';"></b><b class="MAME_b2" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+';"></b><b class="MAME_b3" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+";background:"+Mapabc.Util.MChangeColor(this.tipOption.titleFillStyle.color)+';"></b><b class="MAME_b4" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+
";"+a+";background:"+Mapabc.Util.MChangeColor(this.tipOption.titleFillStyle.color)+';"></b>';this._BHBorder=Mapabc.Util.createDiv("_BHBorder");this._BHBorder.innerHTML='<b class="MAME_b4 MAME_back" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+";background:"+Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color)+';"></b><b class="MAME_b3 MAME_back" style="border-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+";background:"+Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color)+
';"></b><b class="MAME_b2" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+';"></b><b class="MAME_b1" style="background-color:'+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+';"></b>';this._Bar=Mapabc.Util.createDiv(null,null,null,null,"absolute",null,null,null);this._Bar.className="MAME_Bar";
this._Bar.style.width="30px";for(var b=26;b>=1;b-=1)this._Bar.innerHTML+="<div class='MAME_w' style=\"width:"+b+"px;*width:"+b+"px;background:"+Mapabc.Util.MChangeColor(this.tipOption.fillStyle.color)+";border-color:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+';"></div>';this._Bar.innerHTML+="<div class='MAME_w'  style=\"width:2px;height:2px;border:none;background:"+Mapabc.Util.MChangeColor(this.tipOption.borderStyle.color)+";"+a+';"></div>';this.groupDiv.appendChild(this._THBorder);
this.groupDiv.appendChild(this._BHBorder);this.groupDiv.appendChild(this._Bar)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition)if(this.tipOption.tipType==1)if(this._Bar)this._Bar.style.left="30px"},CLASS_NAME:"Mapabc.Popup.Framed"});
Mapabc.Renderer.SVG=Mapabc.Class(Mapabc.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15E3,translationParameters:null,symbolSize:{},isGecko:null,initialize:function(){if(this.supported()){Mapabc.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.isGecko=navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1}},destroy:function(){Mapabc.Renderer.Elements.prototype.destroy.apply(this,arguments)},
supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(a,b,c){a=a+(c?0:this.translationParameters.x);b=b+(c?0:this.translationParameters.y);return a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL&&b>=-this.MAX_PIXEL&&b<=this.MAX_PIXEL},setExtent:function(a,
b){Mapabc.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution(),d=-a.left/c;c=a.top/c;if(b){this.left=d;this.top=c;this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h);this.translate(0,0);return true}else{(d=this.translate(d-this.left,c-this.top))||this.setExtent(a,true);return d}},translate:function(a,b){if(this.inValidRange(a,b,true)){var c="";if(a||b)c="translate("+a+","+b+")";this.root.setAttributeNS(null,"transform",c);this.translationParameters=
{x:a,y:b};return true}else return false},setSize:function(){Mapabc.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case "Mapabc.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"use":"circle";break;case "Mapabc.Geometry.Circle":c="circle";break;case "Mapabc.Geometry.Rectangle":c="rect";break;
case "Mapabc.Geometry.LineString":c="polyline";break;case "Mapabc.Geometry.LinearRing":c="polygon";break;case "Mapabc.Geometry.Polygon":case "Mapabc.Geometry.Curve":case "Mapabc.Geometry.Surface":c="path";break;default:break}return c},setStyle:function(a,b,c){b=b||a._style;c=c||a._options;var d=parseFloat(a.getAttributeNS(null,"r")),e=1,f;if(a._geometryClass=="Mapabc.Geometry.Point"&&d){a.style.visibility="";if(b.graphic===false)a.style.visibility="hidden";else if(b.externalGraphic){f=this.getPosition(a);
b.graphicTitle&&a.setAttributeNS(null,"title",b.graphicTitle);b.graphicWidth&&b.graphicHeight&&a.setAttributeNS(null,"preserveAspectRatio","none");d=b.graphicWidth||b.graphicHeight;var g=b.graphicHeight||b.graphicWidth;d=d?d:b.pointRadius*2;g=g?g:b.pointRadius*2;var h=b.graphicYOffset!=undefined?b.graphicYOffset:-(0.5*g),i=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(f.x+(b.graphicXOffset!=undefined?b.graphicXOffset:-(0.5*d))).toFixed());a.setAttributeNS(null,"y",(f.y+h).toFixed());
a.setAttributeNS(null,"width",d);a.setAttributeNS(null,"height",g);a.setAttributeNS(this.xlinkns,"href",b.externalGraphic);a.setAttributeNS(null,"style","opacity: "+i);a.style.zIndex=1E3;a.style.cursor="Pointer"}else if(this.isComplexSymbol(b.graphicName)){d=b.pointRadius*3;g=d*2;e=this.importSymbol(b.graphicName);h="#"+e;f=this.getPosition(a);e=this.symbolSize[e]/g;i=a.parentNode;var j=a.nextSibling;i&&i.removeChild(a);a.setAttributeNS(this.xlinkns,"href",h);a.setAttributeNS(null,"width",g);a.setAttributeNS(null,
"height",g);a.setAttributeNS(null,"x",f.x-d);a.setAttributeNS(null,"y",f.y-d);if(j)i.insertBefore(a,j);else i&&i.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);if(typeof b.rotation!="undefined"&&f){f=Mapabc.String.format("rotate(${0} ${1} ${2})",[b.rotation,f.x,f.y]);a.setAttributeNS(null,"transform",f)}}if(c.isFilled){a.setAttributeNS(null,"fill",b.fillColor);a.setAttributeNS(null,"fill-opacity",b.fillOpacity)}else a.setAttributeNS(null,"fill","none");if(c.isStroked){a.setAttributeNS(null,
"stroke",b.strokeColor);a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity);a.setAttributeNS(null,"stroke-width",b.strokeWidth*e);a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap);a.setAttributeNS(null,"stroke-linejoin","round");a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,e))}else a.setAttributeNS(null,"stroke","none");b.pointerEvents&&a.setAttributeNS(null,"pointer-events",b.pointerEvents);b.cursor!=null&&a.setAttributeNS(null,"cursor",b.cursor);return a},dashStyle:function(a,
b){var c=a.strokeWidth*b;switch(a.strokeDashstyle){case "solid":return"none";case "dot":return[1,4*c].join();case "dash":return[4*c,4*c].join();case "dashdot":return[4*c,4*c,1,4*c].join();case "longdash":return[8*c,4*c].join();case "longdashdot":return[8*c,4*c,1,4*c].join();default:return a.strokeDashstyle.replace(/ /g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);b&&c.setAttributeNS(null,"id",b);return c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+
"_svgRoot","svg")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=b.x/d+this.left;b=this.top-b.y/d;if(this.inValidRange(e,b)){a.setAttributeNS(null,"cx",e);a.setAttributeNS(null,"cy",b);a.setAttributeNS(null,"r",c/d);a.style.cursor="pointer";
if(this.feature!=null)if(this.feature.style)if(this.feature.style.zIndex)a.style.zIndex=this.feature.style.zIndex;return a}else return false},drawLineString:function(a,b){var c=this.getComponentsString(b.components);if(c.path){a.setAttributeNS(null,"points",c.path);a.style.cursor="pointer";if(this.feature!=null)if(this.feature.style)if(this.feature.style.zIndex)a.style.zIndex=this.feature.style.zIndex;return c.complete?a:null}else return false},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);
if(c.path){a.setAttributeNS(null,"points",c.path);return c.complete?a:null}else return false},drawPolygon:function(a,b){for(var c="",d=true,e=true,f,g,h=0,i=b.components.length;h<i;h++){c+=" M";f=this.getComponentsString(b.components[h].components," ");if(g=f.path){c+=" "+g;e=f.complete&&e}else d=false}c+=" z";if(d){a.setAttributeNS(null,"d",c);a.setAttributeNS(null,"fill-rule","evenodd");a.style.zIndex=103;a.style.cursor="pointer";if(this.feature!=null)if(this.feature.style)if(this.feature.style.zIndex)a.style.zIndex=
this.feature.style.zIndex;return e?a:null}else return false},drawRectangle:function(a,b){var c=this.getResolution(),d=b.x/c+this.left,e=this.top-b.y/c;if(this.inValidRange(d,e)){a.setAttributeNS(null,"x",d);a.setAttributeNS(null,"y",e);a.setAttributeNS(null,"width",b.width/c);a.setAttributeNS(null,"height",b.height/c);return a}else return false},drawSurface:function(a,b){for(var c=null,d=true,e=0,f=b.components.length;e<f;e++)if(e%3==0&&e/3==0){var g=this.getShortString(b.components[e]);g||(d=false);
c="M "+g}else if(e%3==1){(g=this.getShortString(b.components[e]))||(d=false);c+=" C "+g}else{(g=this.getShortString(b.components[e]))||(d=false);c+=" "+g}c+=" Z";if(d){a.setAttributeNS(null,"d",c);return a}else return false},drawText:function(a,b,c){var d=this.getResolution(),e=c.x/d+this.left;d=c.y/d-this.top;c=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"text");a=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_tspan","tspan");if(!b.labelPosition)b.labelPosition=new MPoint(0,0);c.setAttributeNS(null,"x",e+
b.labelPosition.x);c.setAttributeNS(null,"y",-d+b.labelPosition.y);c.setAttributeNS(null,"pointer-events","none");b.fontColor&&c.setAttributeNS(null,"fill",b.fontColor);b.fontFamily&&c.setAttributeNS(null,"font-family",b.fontFamily);b.fontSize&&c.setAttributeNS(null,"font-size",b.fontSize);b.fontWeight&&c.setAttributeNS(null,"font-weight",b.fontWeight);e=b.labelAlign||"cm";c.setAttributeNS(null,"text-anchor",Mapabc.Renderer.SVG.LABEL_ALIGN[e[0]]||"middle");this.isGecko?c.setAttributeNS(null,"dominant-baseline",
Mapabc.Renderer.SVG.LABEL_ALIGN[e[1]]||"central"):a.setAttributeNS(null,"baseline-shift",Mapabc.Renderer.SVG.LABEL_VSHIFT[e[1]]||"-35%");a.textContent=b.label;if(!c.parentNode){c.appendChild(a);this.textRoot.appendChild(c)}},getComponentsString:function(a,b){for(var c=[],d=true,e=a.length,f=[],g,h=0;h<e;h++){g=a[h];c.push(g);if(g=this.getShortString(g))f.push(g);else{h>0&&this.getShortString(a[h-1])&&f.push(this.clipLine(a[h],a[h-1]));h<e-1&&this.getShortString(a[h+1])&&f.push(this.clipLine(a[h],
a[h+1]));d=false}}return{path:f.join(b||","),complete:d}},clipLine:function(a,b){if(b.equals(a))return"";var c=this.getResolution(),d=this.MAX_PIXEL-this.translationParameters.x,e=this.MAX_PIXEL-this.translationParameters.y,f=b.x/c+this.left,g=this.top-b.y/c,h=a.x/c+this.left;c=this.top-a.y/c;var i;if(h<-d||h>d){i=(c-g)/(h-f);h=h<0?-d:d;c=g+(h-f)*i}if(c<-e||c>e){i=(h-f)/(c-g);c=c<0?-e:e;h=f+(c-g)*i}return h+","+c},getShortString:function(a){var b=this.getResolution(),c=a.x/b+this.left;a=this.top-
a.y/b;return this.inValidRange(c,a)?c+","+a:false},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){if(!this.defs)this.defs=this.createDefs();var b=this.container.id+"-"+a;if(document.getElementById(b)!=null)return b;var c=Mapabc.Renderer.symbol[a];if(c){a=this.nodeFactory(b,"symbol");var d=this.nodeFactory(null,"polygon");a.appendChild(d);for(var e=new Mapabc.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),
f="",g,h,i=0;i<c.length;i+=2){g=c[i];h=c[i+1];e.left=Math.min(e.left,g);e.bottom=Math.min(e.bottom,h);e.right=Math.max(e.right,g);e.top=Math.max(e.top,h);f+=" "+g+","+h}d.setAttributeNS(null,"points",f);c=e.getWidth();d=e.getHeight();a.setAttributeNS(null,"viewBox",[e.left-c,e.bottom-d,c*3,d*3].join(" "));this.symbolSize[b]=Math.max(c,d)*3;this.defs.appendChild(a);return a.id}},CLASS_NAME:"Mapabc.Renderer.SVG"});Mapabc.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};
Mapabc.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};
Mapabc.Renderer.VML=Mapabc.Class(Mapabc.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var a=document.createStyleSheet(),b=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],c=0,d=b.length;c<d;c++)a.addRule("olv\\:"+b[c],"behavior: url(#default#VML); position: absolute; display: inline-block;")}Mapabc.Renderer.Elements.prototype.initialize.apply(this,arguments);
this.offset={x:0,y:0}}},destroy:function(){Mapabc.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){return!!document.namespaces},setExtent:function(a,b){Mapabc.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution(),d=a.left/c;c=a.top/c-this.size.h;if(b){this.offset={x:d,y:c};c=d=0}else{d-=this.offset.x;c-=this.offset.y}this.root.coordorigin=d+" "+c;d=[this.root,this.vectorRoot,this.textRoot];for(var e=0,f=d.length;e<f;++e){c=d[e];c.coordsize=
this.size.w+" "+this.size.h}this.root.style.flip="y";return true},setSize:function(){Mapabc.Renderer.prototype.setSize.apply(this,arguments);for(var a=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],b=this.size.w+"px",c=this.size.h+"px",d,e=0,f=a.length;e<f;++e){d=a[e];d.style.width=b;d.style.height=c}},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case "Mapabc.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case "Mapabc.Geometry.Circle":c=
"olv:oval";break;case "Mapabc.Geometry.Rectangle":c="olv:rect";break;case "Mapabc.Geometry.LineString":case "Mapabc.Geometry.LinearRing":case "Mapabc.Geometry.Polygon":case "Mapabc.Geometry.Curve":case "Mapabc.Geometry.Surface":c="olv:shape";break;default:break}return c},setStyle:function(a,b,c,d){b=b||a._style;c=c||a._options;if(a._geometryClass=="Mapabc.Geometry.Point")if(b.externalGraphic){if(b.graphicTitle)a.title=b.graphicTitle;var e=b.graphicWidth||b.graphicHeight,f=b.graphicHeight||b.graphicWidth;
e=e?e:b.pointRadius*2;f=f?f:b.pointRadius*2;var g=this.getResolution(),h=b.graphicXOffset!=undefined?b.graphicXOffset:-(0.5*e),i=b.graphicYOffset!=undefined?b.graphicYOffset:-(0.5*f);a.style.left=(d.x/g-this.offset.x+h).toFixed();a.style.top=(d.y/g-this.offset.y-(i+f)).toFixed();a.style.width=e+"px";a.style.height=f+"px";a.style.flip="y";b.fillColor="none";c.isStroked=false}else if(this.isComplexSymbol(b.graphicName)){e=this.importSymbol(b.graphicName);a.path=e.path;a.coordorigin=e.left+","+e.bottom;
e=e.size;a.coordsize=e+","+e;this.drawCircle(a,d,b.pointRadius);a.style.flip="y"}else this.drawCircle(a,d,this.getResolution()*b.pointRadius);if(c.isFilled)a.fillcolor=b.fillColor;else a.filled="false";d=a.getElementsByTagName("fill");d=d.length==0?null:d[0];if(c.isFilled){d||(d=this.createNode("olv:fill",a.id+"_fill"));d.opacity=b.fillOpacity;if(a._geometryClass=="Mapabc.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity)d.opacity=b.graphicOpacity;d.src=b.externalGraphic;d.type="frame";if(!(b.graphicWidth&&
b.graphicHeight))d.aspect="atmost"}d.parentNode!=a&&a.appendChild(d)}else d&&a.removeChild(d);if(typeof b.rotation!="undefined")if(b.externalGraphic){this.graphicRotate(a,h,i);d.opacity=0}else a.style.rotation=b.rotation;if(c.isStroked){a.strokecolor=b.strokeColor;a.strokeweight=b.strokeWidth+"px"}else a.stroked=false;h=a.getElementsByTagName("stroke");h=h.length==0?null:h[0];if(c.isStroked){if(!h){h=this.createNode("olv:stroke",a.id+"_stroke");a.appendChild(h)}h.opacity=b.strokeOpacity;h.endcap=
!b.strokeLinecap||b.strokeLinecap=="butt"?"flat":b.strokeLinecap;h.dashstyle=this.dashStyle(b)}else h&&a.removeChild(h);if(b.cursor!="inherit"&&b.cursor!=null)a.style.cursor=b.cursor;return a},graphicRotate:function(a,b,c){var d=d||a._style,e,f;if(d.graphicWidth&&d.graphicHeight){f=Math.max(d.graphicWidth,d.graphicHeight);e=d.graphicWidth/d.graphicHeight;var g=Math.round(d.graphicWidth||f*e),h=Math.round(d.graphicHeight||f);a.style.width=g+"px";a.style.height=h+"px";var i=document.getElementById(a.id+
"_image");if(!i){i=this.createNode("olv:imagedata",a.id+"_image");a.appendChild(i)}i.style.width=g+"px";i.style.height=h+"px";i.src=d.externalGraphic;i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var j=d.rotation*Math.PI/180;i=Math.sin(j);j=Math.cos(j);i="progid:DXImageTransform.Microsoft.Matrix(M11="+j+",M12="+-i+",M21="+i+",M22="+j+",SizingMethod='auto expand')\n";if((j=d.graphicOpacity||d.fillOpacity)&&j!=1)i+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+
j+")\n";a.style.filter=i;i=new Mapabc.Geometry.Point(-b,-c);g=(new Mapabc.Bounds(0,0,g,h)).toGeometry();g.rotate(d.rotation,i);g=g.getBounds();a.style.left=Math.round(parseInt(a.style.left)+g.left)+"px";a.style.top=Math.round(parseInt(a.style.top)-g.bottom)+"px"}else{var k=new Image;k.onreadystatechange=Mapabc.Function.bind(function(){if(k.readyState=="complete"||k.readyState=="interactive"){e=k.width/k.height;f=Math.max(d.pointRadius*2,d.graphicWidth||0,d.graphicHeight||0);b*=e;d.graphicWidth=f*
e;d.graphicHeight=f;this.graphicRotate(a,b,c)}},this);k.src=d.externalGraphic}},postDraw:function(a){var b=a._style.fillColor,c=a._style.strokeColor;if(b=="none"&&a.fillcolor!=b)a.fillcolor=b;if(c=="none"&&a.strokecolor!=c)a.strokecolor=c},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution();c=new Mapabc.Bounds((c.left/d-this.offset.x).toFixed(),(c.bottom/d-this.offset.y).toFixed(),(c.right/d-this.offset.x).toFixed(),(c.top/d-this.offset.y).toFixed());a.style.left=c.left+
"px";a.style.top=c.top+"px";a.style.width=c.getWidth()+"px";a.style.height=c.getHeight()+"px";a.coordorigin=c.left+" "+c.top;a.coordsize=c.getWidth()+" "+c.getHeight()}},dashStyle:function(a){a=a.strokeDashstyle;switch(a){case "solid":case "dot":case "dash":case "dashdot":case "longdash":case "longdashdot":return a;default:a=a.split(/[ ,]/);if(a.length==2){if(1*a[0]>=2*a[1])return"longdash";return a[0]==1||a[1]==1?"dot":"dash"}else if(a.length==4)return 1*a[0]>=2*a[1]?"longdashdot":"dashdot";return"solid"}},
createNode:function(a,b){var c=document.createElement(a);if(b)c.id=b;c.unselectable="on";c.style.cursor="pointer";if(this.feature)if(this.feature.style)if(this.feature.style.zIndex)c.style.zIndex=this.feature.style.zIndex;c.onselectstart=function(){return false};return c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");if(d!=-1)c=c.substr(d+1);var e=a.nodeName;d=e.indexOf(":");if(d!=-1)e=e.substr(d+1);return c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot",
"div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=(b.x/d-this.offset.x).toFixed()-c/d+"px";a.style.top=(b.y/d-this.offset.y).toFixed()-c/d+"px";b=c*2/d;a.style.width=b+"px";a.style.height=b+"px";return a}return false},drawLineString:function(a,b){return this.drawLine(a,b,false)},drawLinearRing:function(a,b){return this.drawLine(a,
b,true)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d=this.getResolution(),e=b.components.length,f=new Array(e),g,h,i=0;i<e;i++){g=b.components[i];h=g.x/d-this.offset.x;g=g.y/d-this.offset.y;f[i]=" "+h.toFixed()+","+g.toFixed()+" l "}a.path="m"+f.join("")+(c?" x e":" e");return a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c=this.getResolution(),d=[],e,f,g,h,i,j,k;g=0;for(h=b.components.length;g<h;g++){e=b.components[g];d.push("m");f=0;for(i=e.components.length;f<i;f++){j=
e.components[f];k=j.x/c-this.offset.x;j=j.y/c-this.offset.y;d.push(" "+k.toFixed()+","+j.toFixed());f==0&&d.push(" l")}d.push(" x ")}d.push("e");a.path=d.join("");return a},drawRectangle:function(a,b){var c=this.getResolution();a.style.left=b.x/c-this.offset.x+"px";a.style.top=b.y/c-this.offset.y+"px";a.style.width=b.width/c+"px";a.style.height=b.height/c+"px";return a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect");a=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox",
"olv:textbox");var e=this.getResolution();d.style.left=(c.x/e-this.offset.x).toFixed()+"px";d.style.top=(c.y/e-this.offset.y).toFixed()+"px";d.style.flip="y";a.innerText=b.label;if(b.fillColor)a.style.color=b.fontColor;if(b.fontFamily)a.style.fontFamily=b.fontFamily;if(b.fontSize)a.style.fontSize=b.fontSize;if(b.fontWeight)a.style.fontWeight=b.fontWeight;a.style.whiteSpace="nowrap";a.inset="1px,0px,0px,0px";if(!d.parentNode){d.appendChild(a);this.textRoot.appendChild(d)}e=b.labelAlign||"cm";c=a.clientWidth*
Mapabc.Renderer.VML.LABEL_SHIFT[e.substr(0,1)];a=a.clientHeight*Mapabc.Renderer.VML.LABEL_SHIFT[e.substr(1,1)];if(!b.labelPosition)b.labelPosition=new MPoint(0,0);d.style.left=parseInt(d.style.left)-c-1+b.labelPosition.x+"px";d.style.top=parseInt(d.style.top)+a-b.labelPosition.y+"px"},drawSurface:function(a,b){this.setNodeDimension(a,b);for(var c=this.getResolution(),d=[],e,f,g=0,h=b.components.length;g<h;g++){e=b.components[g];f=e.x/c-this.offset.x;e=e.y/c-this.offset.y;if(g%3==0&&g/3==0)d.push("m");
else g%3==1&&d.push(" c");d.push(" "+f+","+e)}d.push(" x e");a.path=d.join("");return a},moveRoot:function(a){var b=this.map.getLayer(a.container.id);if(b instanceof Mapabc.Layer.Vector.RootContainer)b=this.map.getLayer(this.container.id);b&&b.renderer.clear();Mapabc.Renderer.Elements.prototype.moveRoot.apply(this,arguments);b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;if(c=Mapabc.Renderer.symbol[a]){a=new Mapabc.Bounds(Number.MAX_VALUE,
Number.MAX_VALUE,0,0);for(var d=["m"],e=0;e<c.length;e+=2){x=c[e];y=c[e+1];a.left=Math.min(a.left,x);a.bottom=Math.min(a.bottom,y);a.right=Math.max(a.right,x);a.top=Math.max(a.top,y);d.push(x);d.push(y);e==0&&d.push("l")}d.push("x e");c=d.join(" ");d=(a.getWidth()-a.getHeight())/2;if(d>0){a.bottom-=d;a.top+=d}else{a.left-=d;a.right+=d}c={path:c,size:a.getWidth(),left:a.left,bottom:a.bottom};return this.symbolCache[b]=c}},CLASS_NAME:"Mapabc.Renderer.VML"});
Mapabc.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};
Mapabc.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:Mapabc.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new Mapabc.Events(this,null,["complete","success","failure"]),issue:function(a){var b=Mapabc.Util.extend(this.DEFAULT_CONFIG,{proxy:Mapabc.ProxyHost});a=Mapabc.Util.applyDefaults(a,b);var c=new Mapabc.Request.XMLHttpRequest,d=a.url;if(a.params){b=Mapabc.Util.getParameterString(a.params);
if(b.length>0){var e=d.indexOf("?")>-1?"&":"?";d+=e+b}}if(a.proxy&&d.indexOf("http")==0)d=a.proxy+encodeURIComponent(d);c.open(a.method,d,a.async,a.user,a.password);for(var f in a.headers)c.setRequestHeader(f,a.headers[f]);var g=a.scope?Mapabc.Function.bind(a.callback,a.scope):a.callback,h;if(a.success)h=a.scope?Mapabc.Function.bind(a.success,a.scope):a.success;var i;if(a.failure)i=a.scope?Mapabc.Function.bind(a.failure,a.scope):a.failure;var j=this.events;c.onreadystatechange=function(){if(c.readyState==
Mapabc.Request.XMLHttpRequest.DONE)if(j.triggerEvent("complete",{request:c,config:a,requestUrl:d})!==false){g(c);if(!c.status||c.status>=200&&c.status<300){j.triggerEvent("success",{request:c,config:a,requestUrl:d});h&&h(c)}if(c.status&&(c.status<200||c.status>=300)){j.triggerEvent("failure",{request:c,config:a,requestUrl:d});i&&i(c)}}};a.async===false?c.send(a.data):window.setTimeout(function(){c.send(a.data)},0);return c},GET:function(a){a=Mapabc.Util.extend(a,{method:"GET"});return Mapabc.Request.issue(a)},
POST:function(a){a=Mapabc.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};"CONTENT-TYPE"in Mapabc.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml");return Mapabc.Request.issue(a)},PUT:function(a){a=Mapabc.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};"CONTENT-TYPE"in Mapabc.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml");return Mapabc.Request.issue(a)},DELETE:function(a){a=Mapabc.Util.extend(a,{method:"DELETE"});
return Mapabc.Request.issue(a)},HEAD:function(a){a=Mapabc.Util.extend(a,{method:"HEAD"});return Mapabc.Request.issue(a)},OPTIONS:function(a){a=Mapabc.Util.extend(a,{method:"OPTIONS"});return Mapabc.Request.issue(a)}};
Mapabc.Tile.Image=Mapabc.Class(Mapabc.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(a,b,c,d){Mapabc.Tile.prototype.initialize.apply(this,arguments);this.url=d;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&Mapabc.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){this.layerAlphaHack&&Mapabc.Event.stopObservingElement(this.imgDiv.childNodes[0].id);
Mapabc.Event.stopObservingElement(this.imgDiv.id);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null}this.imgDiv=null;this.frame!=null&&this.frame.parentNode==this.layer.div&&this.layer.div.removeChild(this.frame);this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);Mapabc.Tile.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==
null)a=new Mapabc.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size);a=Mapabc.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a},draw:function(){if(this.layer){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject)this.bounds=this.getBoundsFromBaseLayer(this.position);var a=Mapabc.Tile.prototype.draw.apply(this,arguments);if(Mapabc.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();
this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else this.backBufferTile&&this.backBufferTile.clear();else if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}if(!a)return false;if(this.isLoading)this.events.triggerEvent("reload");else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()}},
resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;if(a&&this.bounds.intersectsBounds(a,false)){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.imageSize||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();
this.backBufferTile.renderTile()}this.backBufferTile.hide()}},renderTile:function(){this.imgDiv==null&&this.initImgDiv();this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async)this.layer.getURLasync(this.bounds,this,"url",this.positionImage);else{if(this.layer.url instanceof Array)this.imgDiv.urls=this.layer.url.slice();if(this.url=this.layer.getURL(this.bounds)){if(this.layer.div)this.layer.div.style.overflow="";this.positionImage();return true}else if(this.layer.div){this.layer.div.style.overflow=
"hidden";return false}}},positionImage:function(){if(this.layer!=null){Mapabc.Util.modifyDOMElement(this.frame,null,this.position,this.size);var a=this.layer.getImageSize();if(this.layerAlphaHack)Mapabc.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url);else{Mapabc.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url}}},clear:function(){this.imgDiv&&this.hide()},initImgDiv:function(){var a=this.layer.imageOffset,b=this.layer.getImageSize();this.imgDiv=this.layerAlphaHack?
Mapabc.Util.createAlphaImageDiv(null,a,b,null,"relative",null,null,null,true):Mapabc.Util.createImage(null,a,b,null,"relative",null,null,true);this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);this.layer.opacity!=null&&Mapabc.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity);this.imgDiv.map=this.layer.map;var c=function(){if(this.isLoading){this.isLoading=false;
this.events.triggerEvent("loadend")}};this.layerAlphaHack?Mapabc.Event.observe(this.imgDiv.childNodes[0],"load",Mapabc.Function.bind(c,this)):Mapabc.Event.observe(this.imgDiv,"load",Mapabc.Function.bind(c,this));Mapabc.Event.observe(this.imgDiv,"error",Mapabc.Function.bind(function(){this.imgDiv.src=Mapabc.Util.getImagesLocation()+"error.png";this.imgDiv._attempts>Mapabc.IMAGE_RELOAD_ATTEMPTS&&c.call(this)},this))},checkImgURL:function(){if(this.layer)Mapabc.Util.isEquivalentUrl(this.layerAlphaHack?
this.imgDiv.firstChild.src:this.imgDiv.src,this.url)||this.hide()},startTransition:function(){if(this.backBufferTile&&this.backBufferTile.imgDiv){var a=1;if(this.backBufferTile.resolution)a=this.backBufferTile.resolution/this.layer.getResolution();if(a!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var b=new Mapabc.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top),c=new Mapabc.Size(this.backBufferTile.size.w*a,this.backBufferTile.size.h*a);b=this.layer.map.getLayerPxFromLonLat(b);
Mapabc.Util.modifyDOMElement(this.backBufferTile.frame,null,b,c);c=this.backBufferTile.imageSize;c=new Mapabc.Size(c.w*a,c.h*a);if(b=this.backBufferTile.imageOffset)b=new Mapabc.Pixel(b.x*a,b.y*a);Mapabc.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,b,c);this.backBufferTile.show()}}else this.layer.singleTile?this.backBufferTile.show():this.backBufferTile.hide();this.lastRatio=a}},show:function(){this.frame.style.display="";if(Mapabc.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=
-1)if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1)this.frame.scrollLeft=this.frame.scrollLeft},hide:function(){this.frame.style.display="none"},CLASS_NAME:"Mapabc.Tile.Image"});Mapabc.Tile.Image.useBlankTile=Mapabc.Util.getBrowserName()=="safari"||Mapabc.Util.getBrowserName()=="opera";
Mapabc.Control.OverviewMap=Mapabc.Class(Mapabc.Control,{element:null,ovmap:null,size:new Mapabc.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,initialize:function(a){this.layers=[];this.handlers={};Mapabc.Control.prototype.initialize.apply(this,[a])},destroy:function(){if(this.mapDiv){this.handlers.click.destroy();this.mapDiv.removeChild(this.extentRectangle);this.extentRectangle=null;
this.rectEvents.destroy();this.rectEvents=null;this.ovmap.destroy();this.ovmap=null;this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){Mapabc.Event.stopObservingElement(this.maximizeDiv);this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){Mapabc.Event.stopObservingElement(this.minimizeDiv);this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,
scope:this});Mapabc.Control.prototype.destroy.apply(this,arguments)}},onmousedown:function(a){Mapabc.Event.stop(a,true)},draw:function(){Mapabc.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0))if(this.map.baseLayer)this.layers=[this.map.baseLayer.clone()];else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";var a=
document.getElementById(Mapabc.Util.createUniqueID("overviewMap"));document.getElementById("Attribution").style.right="180px";if(a==null){this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w-14+"px";this.mapDiv.style.height=this.size.h+76+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=Mapabc.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=
1E3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.cursor="pointer";this.mapDiv.appendChild(this.extentRectangle);(new Mapabc.Events(this,this.mapDiv,null,true)).on({mousedown:this.map.onmousedown,mousemove:this.map.onmousemove,mouseout:this.map.onmouseout,contextmenu:this.map.oncontextmenu,click:this.map.onclick,scope:this});this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);(new Mapabc.Events(this,this.div,null,true)).on({mousedown:this.onmousedown,
scope:this});if(this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";a=Mapabc.Util.getImagesLocation();this.maximizeDiv=Mapabc.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new Mapabc.Size(15,15),a+"overviewmap_in.png","absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.style.cursor="pointer";this.maximizeDiv.className=this.displayClass+"MaximizeButton";Mapabc.Event.observe(this.maximizeDiv,"click",Mapabc.Function.bindAsEventListener(this.maximizeControl,
this));this.div.appendChild(this.maximizeDiv);(new Mapabc.Events(this,this.maximizeDiv,null,true)).on({mousedown:this.map.onmousedown,mousemove:this.map.onmousemove,mouseup:this.map.onmouseup,mouseover:function(){this.map.events.unregister(MOUSE_MOVING,this.map,this.map._MMAPABC_EVENT_MOUSEMOVE_)},mouseout:this.map.onmouseout,contextmenu:this.map.oncontextmenu,click:this.map.onclick,scope:this});this.minimizeDiv=Mapabc.Util.createAlphaImageDiv("Mapabc_Control_minimizeDiv",null,new Mapabc.Size(15,
15),a+"overviewmap_out.png","absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.style.cursor="pointer";this.minimizeDiv.className=this.displayClass+"MinimizeButton";Mapabc.Event.observe(this.minimizeDiv,"click",Mapabc.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);(new Mapabc.Events(this,this.minimizeDiv,null,true)).on({mousedown:this.map.onmousedown,mousemove:this.map.onmousemove,mouseup:this.map.onmouseup,mouseover:function(){this.map.events.unregister(MOUSE_MOVING,
this.map,this.map._MMAPABC_EVENT_MOUSEMOVE_)},mouseout:this.map.onmouseout,contextmenu:this.map.oncontextmenu,click:this.map.onclick,scope:this});a=["dblclick","mousedown"];for(var b=0,c=a.length;b<c;b++){Mapabc.Event.observe(this.maximizeDiv,a[b],Mapabc.Event.stop);Mapabc.Event.observe(this.minimizeDiv,a[b],Mapabc.Event.stop)}this.maximizeControl()}this.map.getExtent()&&this.update();this.map.events.register("moveend",this,this.update);this.map.events.register("zoomchanged",this,this.update)}return this.div},
baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(b!=0||c!=0){var d=this.rectPxBounds.top,e=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());var f=this.rectPxBounds.getWidth();c=Math.max(0,d-c);c=Math.min(c,this.ovmap.size.h-this.hComp-a);b=Math.max(0,e-b);b=Math.min(b,this.ovmap.size.w-this.wComp-f);this.setRectPxBounds(new Mapabc.Bounds(b,
c+a,b+f,c))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left;a=Math.abs(this.rectPxBounds.getHeight());b=this.rectPxBounds.getWidth();d=Math.max(0,e+d);d=Math.min(d,this.ovmap.size.h-a);c=Math.max(0,f+c);c=Math.min(c,this.ovmap.size.w-b);this.setRectPxBounds(new Mapabc.Bounds(c,d+a,c+b,d));this.updateMapToRect()},maximizeControl:function(a){this.element.style.display="";document.getElementById("Attribution").style.right=
"180px";this.showToggle(false);a!=null&&Mapabc.Event.stop(a)},minimizeControl:function(a){this.element.style.display="none";this.showToggle(true);document.getElementById("Attribution").style.right="40px";a!=null&&Mapabc.Event.stop(a)},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":""},update:function(){this.ovmap==null&&this.createMap();if(this.autoPan||!this.isSuitableOverview())this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var a=
this.map.getExtent(),b=this.map.maxExtent;a=new Mapabc.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));if(this.ovmap.getProjection()!=this.map.getProjection())a=a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject());b=this.ovmap.getResolution()/this.map.getResolution();return b>this.minRatio&&b<=this.maxRatio&&this.ovmap.getExtent().containsBounds(a)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),
c=b/a;if(c>this.maxRatio)b=this.minRatio*a;else if(c<=this.minRatio)b=this.maxRatio*a;if(this.ovmap.getProjection()!=this.map.getProjection()){a=this.map.center.clone();a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else a=this.map.center;this.ovmap.setCenter(a,this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},mapabc_getTileURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w));a=Math.round((this.maxExtent.top-
a.top)/(b*this.tileSize.h));c="w2.61&zoom="+(17-this.map.getZoom())+"&x="+c+"&y="+a;a=this.url;if(a instanceof Array)a=this.selectUrl(c,a);return a+c},createMap:function(){this.ovmap=new Mapabc.Map(this.mapDiv,{units:"m",maxResolution:156543.0339,numZoomLevels:18,zoom:this.map.zoom-2,displayProjection:new Mapabc.Projection("EPSG:4326"),controls:[]});Mapabc.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);layer=new Mapabc.Layer.TMS("mapabc",["http://emap0.mapabc.com/mapabc/maptile?v=",
"http://emap1.mapabc.com/mapabc/maptile?v=","http://emap2.mapabc.com/mapabc/maptile?v=","http://emap3.mapabc.com/mapabc/maptile?v="],{getURL:this.mapabc_getTileURL,displayOutsideMaxExtent:true,attribution:"Data by <a href='http://www.mapabc.com/'>MapABC.com</a>"});this.ovmap.addLayer(layer);this.wComp=(this.wComp=parseInt(Mapabc.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(Mapabc.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2;this.hComp=(this.hComp=
parseInt(Mapabc.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(Mapabc.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2;this.handlers.drag=new Mapabc.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new Mapabc.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new Mapabc.Events(this,
this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(){!this.handlers.drag.active&&!this.map.dragging&&this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var a=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,b=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;
this.resolutionFactor=a&&b?Mapabc.INCHES_PER_UNIT[a]/Mapabc.INCHES_PER_UNIT[b]:1}},updateRectToMap:function(){var a=this.getRectBoundsFromMapBounds(this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent());a&&this.setRectPxBounds(a)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection())a=a.transform(this.ovmap.getProjectionObject(),
this.map.getProjectionObject());this.map.panTo(a.getCenterLonLat(),null,SLIDING_EXPO)},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp);a=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp);var e=Math.max(a-c,0),f=Math.max(d-b,0);if(e<this.minRectSize||f<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;e=c+e/2-this.minRectSize/2;this.extentRectangle.style.top=
Math.round(b+f/2-this.minRectSize/2)+"px";this.extentRectangle.style.left=Math.round(e)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px";this.extentRectangle.style.backgroundImage="url("+Mapabc.Util.getImagesLocation()+"overview_replacement.gif)"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(b)+"px";this.extentRectangle.style.left=Math.round(c)+"px";this.extentRectangle.style.height=
Math.round(f)+"px";this.extentRectangle.style.width=Math.round(e)+"px";this.extentRectangle.style.backgroundImage=""}this.rectPxBounds=new Mapabc.Bounds(Math.round(c),Math.round(d),Math.round(a),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=new Mapabc.LonLat(a.left,a.bottom);a=new Mapabc.LonLat(a.right,a.top);b=this.getOverviewPxFromLonLat(b);a=this.getOverviewPxFromLonLat(a);var c=null;if(b&&a)c=new Mapabc.Bounds(b.x,b.y,a.x,a.y);return c},getMapBoundsFromRectBounds:function(a){var b=
new Mapabc.Pixel(a.left,a.bottom);a=new Mapabc.Pixel(a.right,a.top);b=this.getLonLatFromOverviewPx(b);a=this.getLonLatFromOverviewPx(a);return new Mapabc.Bounds(b.lon,b.lat,a.lon,a.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat();return new Mapabc.LonLat(d.lon+(a.x-b.w/2)*c,d.lat-(a.y-b.h/2)*c)},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent(),d=null;if(c)d=new Mapabc.Pixel(Math.round(1/
b*(a.lon-c.left)),Math.round(1/b*(c.top-a.lat)));return d},CLASS_NAME:"Mapabc.Control.OverviewMap"});
Mapabc.Feature=Mapabc.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:Mapabc.Popup.AnchoredBubble,popup:null,initialize:function(a,b,c){this.layer=a;this.lonlat=b;this.data=c!=null?c:{};this.id=Mapabc.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.layer!=null&&this.layer.map!=null&&this.popup!=null&&this.layer.map.removePopup(this.popup);this.data=this.lonlat=this.id=this.layer=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=
null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var a=false;if(this.layer!=null&&this.layer.map!=null)a=this.layer.map.getExtent().containsLonLat(this.lonlat);return a},createMarker:function(){if(this.lonlat!=null)this.marker=new Mapabc.Marker(this.lonlat,this.data.icon);return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){if(this.lonlat!=null){var b=this.id+"_popup",c=this.marker?this.marker.icon:null;if(!this.popup)this.popup=new this.popupClass(b,
this.lonlat,this.data.popupSize,this.data.popupContentHTML,c,a);if(this.data.overflow!=null)this.popup.contentDiv.style.overflow=this.data.overflow;this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"Mapabc.Feature"});
Mapabc.Handler.Click=Mapabc.Class(Mapabc.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(){Mapabc.Handler.prototype.initialize.apply(this,arguments);if(this.pixelTolerance!=null)this.mousedown=function(a){a=window.event||a;this.down=a.xy;return true}},mousedown:null,mouseup:function(a){a=window.event||a;var b=true;if(this.checkModifiers(a)&&this.control.handleRightClicks&&Mapabc.Event.isRightClick(a))b=
this.rightclick(a);return b},rightclick:function(a){if(this.passesTolerance(a))if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[a]);return!this.stopDouble}else{a=this["double"]?Mapabc.Util.extend({},a):this.callback("rightclick",[a]);a=Mapabc.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(a,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;a&&this.callback("rightclick",[a]);return!this.stopSingle},
dblclick:function(a){if(this.passesTolerance(a))if(this.map.getZoom()!=this.map.maxZoomLevel){this["double"]&&this.callback("dblclick",[a]);this.clearTimer()}return!this.stopDouble},click:function(a){if(this.passesTolerance(a))if(this.timerId!=null)this.clearTimer();else{a=this.single?Mapabc.Util.extend({},a):null;this.timerId=window.setTimeout(Mapabc.Function.bind(this.delayedCall,this,a),this.delay)}return!this.stopSingle},passesTolerance:function(a){var b=true;if(this.pixelTolerance!=null&&this.down)if(Math.sqrt(Math.pow(this.down.x-
a.xy.x,2)+Math.pow(this.down.y-a.xy.y,2))>this.pixelTolerance)b=false;return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(a){this.timerId=null;a&&this.callback("click",[a])},deactivate:function(){var a=false;if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true}return a},
CLASS_NAME:"Mapabc.Handler.Click"});
Mapabc.Handler.Drag=Mapabc.Class(Mapabc.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,initialize:function(){Mapabc.Handler.prototype.initialize.apply(this,arguments)},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(a){this.dragging=false;if(this.checkModifiers(a)&&Mapabc.Event.isLeftClick(a)){this.started=true;this.last=this.start=a.xy;Mapabc.Element.addClass(this.map.viewPortDiv,"olDragDown");
this.down(a);this.callback("down",[a.xy]);Mapabc.Event.stop(a);Mapabc.Util.getElement(this.map.viewPortDiv).style.cursor="url('"+Mapabc._getScriptLocation()+"img/closedhand.cur'), default";if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:function(){return true};document.onselectstart=function(){return false}}}else{this.started=false;this.last=this.start=null}return true},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=
this.last.y)){var b=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.xy.x,a.xy.y)).transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));b=new MLngLat(b.lon,b.lat,1);if(this.map.returnCoordType==COORD_TYPE_ENCODE)if(!isNaN(b.lngX)||!isNaN(b.latY)){b.lngX=Mapabc.Util.encodeNumber(b.lngX,0);b.latY=Mapabc.Util.encodeNumber(b.latY,0)}if(this.interval>0)this.timeoutId=setTimeout(Mapabc.Function.bind(this.removeTimeout,this),this.interval);this.dragging=true;this.move(a);this.callback("move",
[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=function(){return false}}this.last=this.evt.xy;this.time++}return true},removeTimeout:function(){this.timeoutId=null},mouseup:function(a){if(this.started){var b=this.start!=this.last;this.dragging=this.started=false;this.time=1;this.up(a);Mapabc.Util.getElement(this.map.viewPortDiv).style.cursor="url('"+Mapabc._getScriptLocation()+"img/openhand.cur'), default";this.callback("up",[a.xy]);b&&this.callback("done",
[a.xy]);document.onselectstart=this.oldOnselectstart}return true},mouseout:function(a){if(this.started&&Mapabc.Util.mouseLeft(a,this.map.div)){var b=this.start!=this.last;this.dragging=this.started=false;Mapabc.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(a);this.callback("out",[]);b&&this.callback("done",[a.xy]);if(document.onselectstart)document.onselectstart=this.oldOnselectstart}return true},click:function(){return this.start==this.last},activate:function(){var a=false;if(Mapabc.Handler.prototype.activate.apply(this,
arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){this.dragging=this.started=false;this.last=this.start=null;a=true}return a},CLASS_NAME:"Mapabc.Handler.Drag"});
Mapabc.Handler.Feature=Mapabc.Class(Mapabc.Handler,{EVENTMAP:{contextmenu:{"in":"click",out:"clickout"},click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(a,b,c,d){Mapabc.Handler.prototype.initialize.apply(this,[a,c,d]);this.layer=b},mousedown:function(a){this.down=
a.xy;return this.handle(a)?!this.stopDown:true},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true},click:function(a){return this.handle(a)?!this.stopClick:true},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out)return true;this.handle(a);return true},contextmenu:function(a){return this.handle(a)?!this.stopClick:true},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return this.geometryTypes==null||Mapabc.Util.indexOf(this.geometryTypes,
a.geometry.CLASS_NAME)>-1},handle:function(a){if(this.feature&&!this.feature.layer)this.feature=null;var b=a.type,c=false,d=!!this.feature,e=b=="click"||b=="dblclick"||b=="contextmenu";if((this.feature=this.layer.getFeatureFromEvent(a))&&!this.feature.layer)this.feature=null;if(this.lastFeature&&!this.lastFeature.layer)this.lastFeature=null;if(this.feature){a=this.feature!=this.lastFeature;if(this.geometryTypeMatches(this.feature)){if(d&&a){this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]);
this.triggerCallback(b,"in",[this.feature,b])}else if(!d||e)this.triggerCallback(b,"in",[this.feature,b]);this.lastFeature=this.feature;c=true}else{if(this.lastFeature&&(d&&a||e))this.triggerCallback(b,"out",[this.lastFeature]);this.feature=null}}else if(this.lastFeature&&(d||e))this.triggerCallback(b,"out",[this.lastFeature]);return c},triggerCallback:function(a,b,c){if(b=this.EVENTMAP[a][b])if(a=="click"&&this.up&&this.down)Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,
2))<=this.clickTolerance&&this.callback(b,c);else this.callback(b,c)},activate:function(){var a=false;if(Mapabc.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},deactivate:function(){var a=false;if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.up=this.down=this.lastFeature=this.feature=null;this.map.events.un({removelayer:this.handleMapEvents,
changelayer:this.handleMapEvents,scope:this});a=true}return a},handleMapEvents:function(a){if(!a.property||a.property=="order")this.moveLayerToTop()},moveLayerToTop:function(){this.layer.setZIndex(Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"Mapabc.Handler.Feature"});
Mapabc.Handler.Hover=Mapabc.Class(Mapabc.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(){Mapabc.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=Mapabc.Util.extend({},a);this.timerId=window.setTimeout(Mapabc.Function.bind(this.delayedCall,this,a),this.delay)}return!this.stopMove},mouseout:function(a){if(Mapabc.Util.mouseLeft(a,this.map.div)){this.clearTimer();
this.callback("move",[a])}return true},passesTolerance:function(a){var b=true;if(this.pixelTolerance&&this.px)if(Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2))<this.pixelTolerance)b=false;return b},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=false;if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true}return a},CLASS_NAME:"Mapabc.Handler.Hover"});
Mapabc.Handler.Keyboard=Mapabc.Class(Mapabc.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(){Mapabc.Handler.prototype.initialize.apply(this,arguments);this.eventListener=Mapabc.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;Mapabc.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(Mapabc.Handler.prototype.activate.apply(this,arguments)){for(var a=0,b=this.KEY_EVENTS.length;a<
b;a++)Mapabc.Event.observe(document,this.KEY_EVENTS[a],this.eventListener);return true}else return false},deactivate:function(){var a=false;if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){a=0;for(var b=this.KEY_EVENTS.length;a<b;a++)Mapabc.Event.stopObserving(document,this.KEY_EVENTS[a],this.eventListener);a=true}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&this.callback(a.type,[a])},CLASS_NAME:"Mapabc.Handler.Keyboard"});
Mapabc.Handler.MouseWheel=Mapabc.Class(Mapabc.Handler,{wheelListener:null,mousePosition:null,initialize:function(){Mapabc.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=Mapabc.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){Mapabc.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=false,c=false,d=false,e=Mapabc.Event.element(a);e!=null&&!d&&!b;){if(!b)try{var f=
e.currentStyle?e.currentStyle.overflow:document.defaultView.getComputedStyle(e,null).getPropertyValue("overflow");b=f&&f=="auto"||f=="scroll"}catch(g){}if(!c){d=0;for(var h=this.map.layers.length;d<h;d++)if(e==this.map.layers[d].div||e==this.map.layers[d].pane){c=true;break}}d=e==this.map.div;e=e.parentNode}if(!b&&d){c&&this.wheelZoom(a);Mapabc.Event.stop(a)}}},wheelZoom:function(a){var b=0;if(!a)a=window.event;if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2)b=-b}else if(a.detail)b=
-a.detail/3;if(b){if(this.mousePosition)a.xy=this.mousePosition;if(!a.xy)a.xy=this.map.getPixelFromLonLat(this.map.getCenter());this.map.zoom_center=a.xy;if(b<0){if(this.map.zoom>this.map.minZoomLevel){this.map.magnifyingglassZoomOut(a);this.callback("down",[a,b])}}else if(this.map.zoom<this.map.maxZoomLevel){this.map.magnifyingglassZoomIn(a);this.callback("up",[a,b])}}},mousemove:function(a){this.mousePosition=a.xy},activate:function(){if(Mapabc.Handler.prototype.activate.apply(this,arguments)){var a=
this.wheelListener;Mapabc.Event.observe(window,"DOMMouseScroll",a);Mapabc.Event.observe(window,"mousewheel",a);Mapabc.Event.observe(document,"mousewheel",a);return true}else return false},deactivate:function(){if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){var a=this.wheelListener;Mapabc.Event.stopObserving(window,"DOMMouseScroll",a);Mapabc.Event.stopObserving(window,"mousewheel",a);Mapabc.Event.stopObserving(document,"mousewheel",a);return true}else return false},CLASS_NAME:"Mapabc.Handler.MouseWheel"});
Mapabc.Layer=Mapabc.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,
minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],zIndex:null,initialize:function(a,b){this.addOptions(b);this.name=a;if(this.id==null){this.id=a=="usermap_layer"||a=="custommap_layer"?b.opt.layerId?b.opt.layerId:Mapabc.Util.createUniqueID(this.CLASS_NAME+"_"):Mapabc.Util.createUniqueID(this.CLASS_NAME+"_");this.div=Mapabc.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir=
"ltr";this.events=new Mapabc.Events(this,this.div,this.EVENT_TYPES);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)}if(this.wrapDateLine)this.displayOutsideMaxExtent=true},destroy:function(a){if(a==null)a=true;this.map!=null&&this.map.removeLayer(this,a);this.options=this.div=this.name=this.map=this.projection=null;if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy()}this.events=this.eventListeners=null},clone:function(a){if(a==
null)a=new Mapabc.Layer(this.name,this.options);Mapabc.Util.applyDefaults(a,this);a.map=null;return a},setName:function(a){if(a!=this.name){this.name=a;this.map!=null&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}},addOptions:function(a){if(this.options==null)this.options={};Mapabc.Util.extend(this.options,a);Mapabc.Util.extend(this,a)},onMapResize:function(){},redraw:function(){var a=false;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();if(b&&
this.inRange&&this.visibility){this.moveTo(b,true,false);this.events.triggerEvent("moveend",{zoomChanged:true});a=true}}return a},moveTo:function(){var a=this.visibility;this.isBaseLayer||(a=a&&this.inRange);this.display(a)},setMap:function(a){if(this.map==null){this.map=a;this.maxExtent=this.maxExtent||this.map.maxExtent;if((this.projection=this.projection||this.map.projection)&&typeof this.projection=="string")this.projection=new Mapabc.Projection(this.projection);this.units=this.projection.getUnits()||
this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();this.div.style.display=this.visibility&&this.inRange?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(a){this.tileSize=a=a?a:this.tileSize?this.tileSize:this.map.getTileSize();if(this.gutter){this.imageOffset=new Mapabc.Pixel(-this.gutter,-this.gutter);this.imageSize=new Mapabc.Size(a.w+
2*this.gutter,a.h+2*this.gutter)}},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();this.map!=null&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});this.events.triggerEvent("visibilitychanged")}},display:function(a){var b=this.calculateInRange();if(a!=(this.div.style.display!="none"))this.div.style.display=a&&b?"block":"none"},calculateInRange:function(){var a=false;if(this.alwaysInRange)a=
true;else if(this.map){a=this.map.getResolution();a=a>=this.minResolution&&a<=this.maxResolution}return a},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;this.map!=null&&this.map.events.triggerEvent("changebaselayer",{layer:this})}},initResolutions:function(){for(var a=new Array("projection","units","scales","resolutions","maxScale","minScale","maxResolution","minResolution","minExtent","maxExtent","numZoomLevels","maxZoomLevel"),b=["projection","units"],c=false,d={},e=0,f=
a.length;e<f;e++){var g=a[e];if(this.options[g]&&Mapabc.Util.indexOf(b,g)==-1)c=true;d[g]=this.options[g]||this.map[g]}if(this.alwaysInRange==null)this.alwaysInRange=!c;if((this.options.minScale!=null||this.options.maxScale!=null)&&this.options.scales==null)d.scales=null;if((this.options.minResolution!=null||this.options.maxResolution!=null)&&this.options.resolutions==null)d.resolutions=null;if(!d.numZoomLevels&&d.maxZoomLevel)d.numZoomLevels=d.maxZoomLevel+1;if(d.scales!=null||d.resolutions!=null){if(d.scales!=
null){d.resolutions=[];e=0;for(f=d.scales.length;e<f;e++)d.resolutions[e]=Mapabc.Util.getResolutionFromScale(d.scales[e],d.units)}d.numZoomLevels=d.resolutions.length}else{if(d.minScale)d.maxResolution=Mapabc.Util.getResolutionFromScale(d.minScale,d.units);else if(d.maxResolution=="auto"){a=this.map.getSize();e=d.maxExtent.getWidth()/a.w;a=d.maxExtent.getHeight()/a.h;d.maxResolution=Math.max(e,a)}if(d.maxScale!=null)d.minResolution=Mapabc.Util.getResolutionFromScale(d.maxScale,d.units);else if(d.minResolution==
"auto"&&d.minExtent!=null){a=this.map.getSize();e=d.minExtent.getWidth()/a.w;a=d.minExtent.getHeight()/a.h;d.minResolution=Math.max(e,a)}if(d.minResolution!=null&&this.options.numZoomLevels==undefined)d.numZoomLevels=Math.floor(Math.log(d.maxResolution/d.minResolution)/Math.log(2))+1;d.resolutions=new Array(d.numZoomLevels);a=2;if(typeof d.minResolution=="number"&&d.numZoomLevels>1)a=Math.pow(d.maxResolution/d.minResolution,1/(d.numZoomLevels-1));for(e=0;e<d.numZoomLevels;e++)d.resolutions[e]=d.maxResolution/
Math.pow(a,e)}d.resolutions.sort(function(h,i){return i-h});this.resolutions=d.resolutions;this.maxResolution=d.resolutions[0];this.minResolution=d.resolutions[d.resolutions.length-1];this.scales=[];e=0;for(f=d.resolutions.length;e<f;e++)this.scales[e]=Mapabc.Util.getScaleFromResolution(d.resolutions[e],d.units);this.minScale=this.scales[0];this.maxScale=this.scales[this.scales.length-1];this.numZoomLevels=d.numZoomLevels},getResolution:function(){return this.getResolutionForZoom(this.map.getZoom())},
getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize();return this.getZoomForResolution(Math.max(a.getWidth()/c.w,a.getHeight()/c.h),b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));if(this.map.fractionalZoom){var b=Math.floor(a);a=this.resolutions[b]-(a-b)*(this.resolutions[b]-this.resolutions[Math.ceil(a)])}else a=this.resolutions[Math.round(a)];return a},getZoomForResolution:function(a,
b){var c;if(this.map.fractionalZoom){var d=0,e=this.resolutions[d],f=this.resolutions[this.resolutions.length-1],g;c=0;for(var h=this.resolutions.length;c<h;++c){g=this.resolutions[c];if(g>=a){e=g;d=c}if(g<=a){f=g;break}}c=e-f;c=c>0?d+(e-a)/c:d}else{e=Number.POSITIVE_INFINITY;c=0;for(h=this.resolutions.length;c<h;c++)if(b){d=Math.abs(this.resolutions[c]-a);if(d>e)break;e=d}else if(this.resolutions[c]<a)break;c=Math.max(0,c-1)}return c},getLonLatFromViewPortPx:function(a){var b=null;if(a!=null){var c=
this.map.getSize(),d=this.map.getCenter();if(d){b=this.map.getResolution();b=new Mapabc.LonLat(d.lon+(a.x-c.w/2)*b,d.lat-(a.y-c.h/2)*b);if(this.wrapDateLine)b=b.wrapDateLine(this.maxExtent)}}return b},getViewPortPxFromLonLat:function(a){var b=null;if(a!=null){b=this.map.getResolution();var c=this.map.getExtent();b=new Mapabc.Pixel(1/b*(a.lon-c.left),1/b*(c.top-a.lat))}return b},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=0,c=this.div.childNodes.length;b<c;++b)Mapabc.Util.modifyDOMElement(this.div.childNodes[b].firstChild,
null,null,null,null,null,null,a)}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=this.zIndex?this.zIndex:a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new Mapabc.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){b={rightTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,b)}return a},CLASS_NAME:"Mapabc.Layer"});
Mapabc.Marker.Box=Mapabc.Class(Mapabc.Marker,{bounds:null,lonlat:null,div:null,content:null,boxAlign:8,id:null,events:null,zIndex:0,initialize:function(a,b){this.bounds=b;this.lonlat=a;this.div=Mapabc.Util.createDiv();this.div.style.overflow="hidden";this.events=new Mapabc.Events(this,this.div,null)},destroy:function(){this.div=this.bounds=null;Mapabc.Marker.prototype.destroy.apply(this,arguments)},getBounds:function(){return new Mapabc.Bounds(this.lonlat.lon,this.lonlat.lat,this.lonlat.lon,this.lonlat.lat)},
setBorder:function(a,b){a||(a="red");b||(b=2);this.div.style.border=b+"px solid "+a},draw:function(a,b){Mapabc.Util.modifyDOMElement(this.div,null,a,b);return this.div},onScreen:function(){var a=false;if(this.map)a=this.map.getExtent().containsBounds(this.bounds,true,true);return a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"Mapabc.Marker.Box"});
Mapabc.Popup.FramedCloud=Mapabc.Class(Mapabc.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new Mapabc.Size(676,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new Mapabc.Pixel(44,0),padding:new Mapabc.Bounds(8,40,8,9),blocks:[{size:new Mapabc.Size("auto","auto"),anchor:new Mapabc.Bounds(0,51,22,0),position:new Mapabc.Pixel(0,0)},{size:new Mapabc.Size(22,"auto"),anchor:new Mapabc.Bounds(null,50,0,0),position:new Mapabc.Pixel(-638,
0)},{size:new Mapabc.Size("auto",19),anchor:new Mapabc.Bounds(0,32,22,null),position:new Mapabc.Pixel(0,-631)},{size:new Mapabc.Size(22,18),anchor:new Mapabc.Bounds(null,32,0,null),position:new Mapabc.Pixel(-638,-632)},{size:new Mapabc.Size(81,35),anchor:new Mapabc.Bounds(null,0,0,null),position:new Mapabc.Pixel(0,-688)}]},tr:{offset:new Mapabc.Pixel(-45,0),padding:new Mapabc.Bounds(8,40,8,9),blocks:[{size:new Mapabc.Size("auto","auto"),anchor:new Mapabc.Bounds(0,51,22,0),position:new Mapabc.Pixel(0,
0)},{size:new Mapabc.Size(22,"auto"),anchor:new Mapabc.Bounds(null,50,0,0),position:new Mapabc.Pixel(-638,0)},{size:new Mapabc.Size("auto",19),anchor:new Mapabc.Bounds(0,32,22,null),position:new Mapabc.Pixel(0,-631)},{size:new Mapabc.Size(22,19),anchor:new Mapabc.Bounds(null,32,0,null),position:new Mapabc.Pixel(-638,-631)},{size:new Mapabc.Size(81,35),anchor:new Mapabc.Bounds(0,0,null,null),position:new Mapabc.Pixel(-215,-687)}]},bl:{offset:new Mapabc.Pixel(45,0),padding:new Mapabc.Bounds(8,9,8,40),
blocks:[{size:new Mapabc.Size("auto","auto"),anchor:new Mapabc.Bounds(0,21,22,32),position:new Mapabc.Pixel(0,0)},{size:new Mapabc.Size(22,"auto"),anchor:new Mapabc.Bounds(null,21,0,32),position:new Mapabc.Pixel(-638,0)},{size:new Mapabc.Size("auto",21),anchor:new Mapabc.Bounds(0,0,22,null),position:new Mapabc.Pixel(0,-629)},{size:new Mapabc.Size(22,21),anchor:new Mapabc.Bounds(null,0,0,null),position:new Mapabc.Pixel(-638,-629)},{size:new Mapabc.Size(81,33),anchor:new Mapabc.Bounds(null,null,0,0),
position:new Mapabc.Pixel(-101,-674)}]},br:{offset:new Mapabc.Pixel(-44,0),padding:new Mapabc.Bounds(8,9,8,40),blocks:[{size:new Mapabc.Size("auto","auto"),anchor:new Mapabc.Bounds(0,21,22,32),position:new Mapabc.Pixel(0,0)},{size:new Mapabc.Size(22,"auto"),anchor:new Mapabc.Bounds(null,21,0,32),position:new Mapabc.Pixel(-638,0)},{size:new Mapabc.Size("auto",21),anchor:new Mapabc.Bounds(0,0,22,null),position:new Mapabc.Pixel(0,-629)},{size:new Mapabc.Size(22,21),anchor:new Mapabc.Bounds(null,0,0,
null),position:new Mapabc.Pixel(-638,-629)},{size:new Mapabc.Size(81,33),anchor:new Mapabc.Bounds(0,null,null,0),position:new Mapabc.Pixel(-311,-674)}]}},minSize:new Mapabc.Size(105,10),maxSize:new Mapabc.Size(600,660),initialize:function(){this.imageSrc=Mapabc.Util.getImagesLocation()+"cloud-popup-relative.png";Mapabc.Popup.Framed.prototype.initialize.apply(this,arguments)},destroy:function(){Mapabc.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"Mapabc.Popup.FramedCloud"});
(function(){function a(){this._object=e?new e:new window.ActiveXObject("Microsoft.XMLHTTP")}function b(h){h.onreadystatechange&&h.onreadystatechange.apply(h);a.onreadystatechange&&a.onreadystatechange.apply(h)}function c(h){try{h.responseText=h._object.responseText}catch(i){}try{var j;a:{var k=h._object,l=k.responseXML;if(g&&l&&!l.documentElement&&k.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){l=new ActiveXObject("Microsoft.XMLDOM");l.loadXML(k.responseText)}if(l)if(g&&l.parseError!=
0||l.documentElement&&l.documentElement.tagName=="parsererror"){j=null;break a}j=l}h.responseXML=j}catch(m){}try{h.status=h._object.status}catch(n){}try{h.statusText=h._object.statusText}catch(o){}}function d(h){h._object.onreadystatechange=new window.Function;delete h._headers}var e=window.XMLHttpRequest,f=!!window.controllers,g=window.document.all&&!window.opera;if(f&&e.wrapped)a.wrapped=e.wrapped;a.UNSENT=0;a.OPENED=1;a.HEADERS_RECEIVED=2;a.LOADING=3;a.DONE=4;a.prototype.readyState=a.UNSENT;a.prototype.responseText=
"";a.prototype.responseXML=null;a.prototype.status=0;a.prototype.statusText="";a.prototype.onreadystatechange=null;a.onreadystatechange=null;a.onopen=null;a.onsend=null;a.onabort=null;a.prototype.open=function(h,i,j,k,l){this._async=j;var m=this,n=this.readyState;if(g){var o=function(){m._object.readyState!=a.DONE&&d(m)};j&&window.attachEvent("onunload",o)}this._object.onreadystatechange=function(){if(!(f&&!j)){m.readyState=m._object.readyState;c(m);if(m._aborted)m.readyState=a.UNSENT;else{if(m.readyState==
a.DONE){d(m);g&&j&&window.detachEvent("onunload",o)}n!=m.readyState&&b(m);n=m.readyState}}};a.onopen&&a.onopen.apply(this,arguments);this._object.open(h,i,j,k,l);if(!j&&f){this.readyState=a.OPENED;b(this)}};a.prototype.send=function(h){a.onsend&&a.onsend.apply(this,arguments);if(h&&h.nodeType){h=window.XMLSerializer?(new window.XMLSerializer).serializeToString(h):h.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._object.send(h);if(f&&!this._async){this.readyState=
a.OPENED;for(c(this);this.readyState<a.DONE;){this.readyState++;b(this);if(this._aborted)return}}};a.prototype.abort=function(){a.onabort&&a.onabort.apply(this,arguments);if(this.readyState>a.UNSENT)this._aborted=true;this._object.abort();d(this)};a.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};a.prototype.getResponseHeader=function(h){return this._object.getResponseHeader(h)};a.prototype.setRequestHeader=function(h,i){if(!this._headers)this._headers={};this._headers[h]=
i;return this._object.setRequestHeader(h,i)};a.prototype.toString=function(){return"[object XMLHttpRequest]"};a.toString=function(){return"[XMLHttpRequest]"};if(!window.Function.prototype.apply)window.Function.prototype.apply=function(h,i){i||(i=[]);h.__func=this;h.__func(i[0],i[1],i[2],i[3],i[4]);delete h.__func};Mapabc.Request.XMLHttpRequest=a})();
Mapabc.Control.DragFeature=Mapabc.Class(Mapabc.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){Mapabc.Control.prototype.initialize.apply(this,[b]);this.layer=a;this.handlers={drag:new Mapabc.Handler.Drag(this,Mapabc.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks)),feature:new Mapabc.Handler.Feature(this,
this.layer,Mapabc.Util.extend({over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},destroy:function(){this.layer=null;Mapabc.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&Mapabc.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;Mapabc.Element.removeClass(this.map.viewPortDiv,
this.displayClass+"Over");return Mapabc.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){if(this.handlers.drag.dragging)this.over=this.feature.id==a.id?true:false;else{this.feature=a;this.handlers.drag.activate();this.over=true;Mapabc.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over")}},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a);Mapabc.Util.getElement(this.feature.geometry.id).style.cursor="url('"+Mapabc._getScriptLocation()+"theme/default/img/closedhand.cur'), pointer"},
moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){if(this.handlers.drag.dragging){if(this.feature.id==a.id)this.over=false}else{this.over=false;this.handlers.drag.deactivate();Mapabc.Element.removeClass(this.map.viewPortDiv,
this.displayClass+"Over");this.feature=null}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);Mapabc.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"Mapabc.Control.DragFeature"});
Mapabc.Control.DragPan=Mapabc.Class(Mapabc.Control,{type:Mapabc.Control.TYPE_TOOL,panned:false,interval:25,draw:function(){this.handler=new Mapabc.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval})},time:1,panMap:function(a){this.panned=true;var b=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.x,a.y)).transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));b=new MLngLat(b.lon,b.lat,1);if(this.time==1){var c={};c.mapId=this.map.container;c.type=
"dragstart"}else{c={};c.mapId=this.map.container;c.type="drag"}c.eventX=b.lngX;c.eventY=b.latY;triggerEvent(c);this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false});this.time++},panMapDone:function(a){var b=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.x,a.y)).transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));b=new MLngLat(b.lon,b.lat,1);if(this.panned){this.panMap(a);this.panned=false}a={};a.mapId=this.map.container;
a.type="dragend";a.eventX=b.lngX;a.eventY=b.latY;triggerEvent(a);this.time=1},CLASS_NAME:"Mapabc.Control.DragPan"});
Mapabc.Control.KeyboardDefaults=Mapabc.Class(Mapabc.Control,{slideFactor:75,initialize:function(){Mapabc.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.handler&&this.handler.destroy();this.handler=null;Mapabc.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.handler=new Mapabc.Handler.Keyboard(this,{keydown:this.defaultKeyPress});this.activate()},defaultKeyPress:function(a){switch(a.keyCode){case Mapabc.Event.KEY_LEFT:this.map.pan(-this.slideFactor,
0,null,null,SLIDING_EXPO);break;case Mapabc.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0,null,null,SLIDING_EXPO);break;case Mapabc.Event.KEY_UP:this.map.pan(0,-this.slideFactor,null,null,SLIDING_EXPO);break;case Mapabc.Event.KEY_DOWN:this.map.pan(0,this.slideFactor,null,null,SLIDING_EXPO);break;case 33:a=this.map.getSize();this.map.pan(0,-0.75*a.h,null,null,SLIDING_EXPO);break;case 34:a=this.map.getSize();this.map.pan(0,0.75*a.h,null,null,SLIDING_EXPO);break;case 35:a=this.map.getSize();this.map.pan(0.75*
a.w,0,null,null,SLIDING_EXPO);break;case 36:a=this.map.getSize();this.map.pan(-0.75*a.w,0,null,null,SLIDING_EXPO);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break}},CLASS_NAME:"Mapabc.Control.KeyboardDefaults"});Mapabc.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};
Mapabc.Feature.Vector=Mapabc.Class(Mapabc.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,renderIntent:"default",initialize:function(a,b,c){Mapabc.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=a?a:null;this.state=null;this.attributes={};if(b)this.attributes=Mapabc.Util.extend(this.attributes,b);this.style=c?c:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;Mapabc.Feature.prototype.destroy.apply(this,
arguments)},clone:function(){return new Mapabc.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=false;if(this.layer&&this.layer.map){b=this.layer.map.getExtent();if(a){a=this.geometry.getBounds();b=b.intersectsBounds(a)}else b=b.toGeometry().intersects(this.geometry)}return b},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=false;if(this.geometry)d=this.geometry.atPoint(a,
b,c);return d},destroyPopup:function(){},move:function(a){if(this.layer&&this.geometry.move){a=a.CLASS_NAME=="Mapabc.LonLat"?this.layer.getViewPortPxFromLonLat(a):a;var b=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),c=this.layer.map.getResolution();this.geometry.move(c*(a.x-b.x),c*(b.y-a.y));this.layer.drawFeature(this);return b}},toState:function(a){if(a==Mapabc.State.UPDATE)switch(this.state){case Mapabc.State.UNKNOWN:case Mapabc.State.DELETE:this.state=a;break;
case Mapabc.State.UPDATE:case Mapabc.State.INSERT:break}else if(a==Mapabc.State.INSERT)switch(this.state){case Mapabc.State.UNKNOWN:break;default:this.state=a;break}else if(a==Mapabc.State.DELETE)switch(this.state){case Mapabc.State.INSERT:break;case Mapabc.State.DELETE:break;case Mapabc.State.UNKNOWN:case Mapabc.State.UPDATE:this.state=a;break}else if(a==Mapabc.State.UNKNOWN)this.state=a},CLASS_NAME:"Mapabc.Feature.Vector"});
Mapabc.Feature.Vector.style={"default":{fillColor:"#33CCFF",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#33CCFF",strokeOpacity:1,strokeWidth:3,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,
strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,
hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};
Mapabc.Handler.Box=Mapabc.Class(Mapabc.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(a,b){Mapabc.Handler.prototype.initialize.apply(this,arguments);b={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new Mapabc.Handler.Drag(this,b,{keyMask:this.keyMask})},setMap:function(a){Mapabc.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(){this.zoomBox=
Mapabc.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);Mapabc.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y);this.zoomBox.style.width=Math.max(1,d)+"px";this.zoomBox.style.height=Math.max(1,e)+"px";this.zoomBox.style.left=a.x<b?a.x+"px":
b+"px";this.zoomBox.style.top=a.y<c?a.y+"px":c+"px";var f=this.getBoxCharacteristics();if(f.newBoxModel){if(a.x>b)this.zoomBox.style.width=Math.max(1,d-f.xOffset)+"px";if(a.y>c)this.zoomBox.style.height=Math.max(1,e-f.yOffset)+"px"}},endBox:function(a){if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var b=this.dragHandler.start,c=Math.min(b.y,a.y),d=Math.max(b.y,a.y);a=new Mapabc.Bounds(Math.min(b.x,a.x),d,Math.max(b.x,a.x),c)}else a=this.dragHandler.start.clone();
this.removeBox();this.callback("done",[a])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.boxCharacteristics=this.zoomBox=null;Mapabc.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(Mapabc.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else return false},deactivate:function(){if(Mapabc.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true}else return false},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var a=
parseInt(Mapabc.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(Mapabc.Element.getStyle(this.zoomBox,"border-right-width"))+1,b=parseInt(Mapabc.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(Mapabc.Element.getStyle(this.zoomBox,"border-bottom-width"))+1,c=Mapabc.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:a,yOffset:b,newBoxModel:c}}return this.boxCharacteristics},CLASS_NAME:"Mapabc.Handler.Box"});
Mapabc.Handler.Circle=Mapabc.Class(Mapabc.Handler.Drag,{feature:null,layer:null,origin:null,termination:null,radius:null,initialize:function(a,b,c){this.style=Mapabc.Util.extend(Mapabc.Feature.Vector.style["default"],{});Mapabc.Handler.prototype.initialize.apply(this,[a,b,c]);this.options=c?c:{}},setOptions:function(a){Mapabc.Util.extend(this.options,a);Mapabc.Util.extend(this,a)},activate:function(){var a=false;if(Mapabc.Handler.prototype.activate.apply(this,arguments)){this.layer=new Mapabc.Layer.Vector(this.CLASS_NAME,
{displayInLayerSwitcher:false,calculateInRange:function(){return true}});this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(Mapabc.Handler.Drag.prototype.deactivate.apply(this,arguments)){this.dragging&&this.cancel();if(this.layer.map!=null){this.layer.destroy(false);this.feature&&this.feature.destroy()}this.feature=this.layer=null;a=true}return a},down:function(a){a=this.map.getLonLatFromPixel(a.xy);this.termination=this.origin=new Mapabc.Geometry.Point(a.lon,a.lat);
if(this.radius==null)this.radius=this.map.getResolution();this.feature=new Mapabc.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(a){a=this.map.getLonLatFromPixel(a.xy);a=new Mapabc.Geometry.Point(a.lon,a.lat);this.radius=Math.max(this.map.getResolution()/2,a.distanceTo(this.origin));this.modifyGeometry();this.layer.drawFeature(this.feature,this.style)},
up:function(a){this.finalize();this.start==this.last&&this.callback("done",[a.xy])},out:function(){this.finalize()},createGeometry:function(){this.feature.geometry=new Mapabc.Geometry.Circle(this.origin.x,this.origin.y,this.radius)},modifyGeometry:function(){this.feature.geometry.radius=this.radius},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer.renderer.clear();this.layer.destroyFeatures()},
callback:function(a){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]);if(!this.persist&&(a=="done"||a=="cancel"))this.clear()},CLASS_NAME:"Mapabc.Handler.Circle"});
Mapabc.Handler.RegularPolygon=Mapabc.Class(Mapabc.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(a,b,c){this.style=Mapabc.Util.extend(Mapabc.Feature.Vector.style["default"],{});Mapabc.Handler.prototype.initialize.apply(this,[a,b,c]);this.options=c?c:{}},setOptions:function(a){Mapabc.Util.extend(this.options,a);Mapabc.Util.extend(this,a)},activate:function(){var a=
false;if(Mapabc.Handler.prototype.activate.apply(this,arguments)){this.layer=new Mapabc.Layer.Vector(this.CLASS_NAME,{displayInLayerSwitcher:false,calculateInRange:function(){return true}});this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(Mapabc.Handler.Drag.prototype.deactivate.apply(this,arguments)){this.dragging&&this.cancel();if(this.layer.map!=null){this.layer.destroy(false);this.feature&&this.feature.destroy()}this.feature=this.layer=null;a=true}return a},
down:function(a){this.fixedRadius=!!this.radius;a=this.map.getLonLatFromPixel(a.xy);this.origin=new Mapabc.Geometry.Point(a.lon,a.lat);if(!this.fixedRadius||this.irregular)this.radius=this.map.getResolution();this.persist&&this.clear();this.feature=new Mapabc.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.map.getLonLatFromPixel(a.xy);
b=new Mapabc.Geometry.Point(b.lon,b.lat);if(this.irregular){a=Math.sqrt(2)*Math.abs(b.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,a)}else if(this.fixedRadius)this.origin=b;else{this.calculateAngle(b,a);this.radius=Math.max(this.map.getResolution()/2,b.distanceTo(this.origin))}this.modifyGeometry();if(this.irregular){a=b.x-this.origin.x;b=b.y-this.origin.y;this.feature.geometry.resize(1,this.origin,b==0?a/(this.radius*Math.sqrt(2)):a/b);this.feature.geometry.move(a/2,b/2)}this.layer.drawFeature(this.feature,
this.style)},up:function(a){this.finalize();this.start==this.last&&this.callback("done",[a.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-0.5);if(this.snapAngle)this.angle+=this.snapAngle*(Math.PI/180);this.feature.geometry=Mapabc.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle);if(this.sides==4&&this.irregular)this.feature.geometry.isRectangle=true},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];
if(c.components.length!=this.sides+1){this.createGeometry();c=this.feature.geometry.components[0]}for(var d=0;d<this.sides;++d){b=c.components[d];a=this.angle+d*2*Math.PI/this.sides;b.x=this.origin.x+this.radius*Math.cos(a);b.y=this.origin.y+this.radius*Math.sin(a);b.clearBounds()}},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=
c},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures()}},callback:function(a){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]);if(!this.persist&&(a=="done"||a=="cancel"))this.clear()},CLASS_NAME:"Mapabc.Handler.RegularPolygon"});
Mapabc.Layer.HTTPRequest=Mapabc.Class(Mapabc.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(a,b,c,d){var e=arguments;e=[a,d];Mapabc.Layer.prototype.initialize.apply(this,e);this.url=b;this.params=Mapabc.Util.extend({},c)},destroy:function(){this.params=this.url=null;Mapabc.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null)a=new Mapabc.Layer.HTTPRequest(this.name,this.url,this.params,this.options);return a=Mapabc.Layer.prototype.clone.apply(this,
[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=Mapabc.Util.extend(this.params,a);return this.redraw()},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):Mapabc.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;d<e;d++){c*=a.charCodeAt(d)*this.URL_HASH_FACTOR;c-=Math.floor(c)}return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=Mapabc.Util.extend({},this.params);d=Mapabc.Util.extend(d,
a);var e=Mapabc.Util.getParameterString(d);if(c instanceof Array)c=this.selectUrl(e,c);e=Mapabc.Util.upperCaseObject(Mapabc.Util.getParameters(c));for(var f in d)f.toUpperCase()in e&&delete d[f];e=Mapabc.Util.getParameterString(d);d=c;if(e!=""){f=c.charAt(c.length-1);d+=f=="&"||f=="?"?e:c.indexOf("?")==-1?"?"+e:"&"+e}return d},CLASS_NAME:"Mapabc.Layer.HTTPRequest"});
Mapabc.Layer.Image=Mapabc.Class(Mapabc.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b;this.maxExtent=this.extent=c;this.size=d;Mapabc.Layer.prototype.initialize.apply(this,[a,e]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}Mapabc.Layer.prototype.destroy.apply(this,arguments)},
clone:function(a){if(a==null)a=new Mapabc.Layer.Image(this.name,this.url,this.extent,this.size,this.options);return a=Mapabc.Layer.prototype.clone.apply(this,[a])},setMap:function(){if(this.options.maxResolution==null)this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w;Mapabc.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b){Mapabc.Layer.prototype.moveTo.apply(this,arguments);var c=this.tile==null;if(b||c){this.setTileSize();var d=this.map.getLayerPxFromLonLat(new Mapabc.LonLat(this.extent.left,
this.extent.top));if(c){this.tile=new Mapabc.Tile.Image(this,d,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=d.clone()}this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new Mapabc.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")};a.events.register("loadstart",
this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"Mapabc.Layer.Image"});
Mapabc.Layer.Markers=Mapabc.Class(Mapabc.Layer,{isBaseLayer:false,markers:null,groundImages:null,labels:null,drawn:false,EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","mousefeatureadded"],initialize:function(){this.EVENT_TYPES=
Mapabc.Layer.Markers.prototype.EVENT_TYPES.concat(Mapabc.Layer.prototype.EVENT_TYPES);Mapabc.Layer.prototype.initialize.apply(this,arguments);this.markers=[];this.labels=[];this.groundImages=[]},destroy:function(){this.clearMarkers();this.clearLabels();this.groundImages=this.labels=this.markers=null;Mapabc.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;a=0;for(var b=this.markers.length;a<b;a++){this.markers[a].setOpacity(this.opacity);this.markers[a].label&&
this.markers[a].label.setOpacity(this.opacity)}}},moveTo:function(a,b){Mapabc.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var c=0,d=this.markers.length;c<d;c++)this.drawMarker(this.markers[c]);c=0;for(d=this.groundImages.length;c<d;c++)this.drawMarker(this.groundImages[c]);c=0;for(d=this.labels.length;c<d;c++)this.drawLabel(this.labels[c]);this.drawn=true}},addMarker:function(a,b){a.overlay instanceof MGroundImage?this.groundImages.push(a):this.markers.push(a);this.opacity!=
null&&a.setOpacity(this.opacity);if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a);a.label&&this.drawLabel(a.label)}b&&this.events.triggerEvent("mousefeatureadded",{feature:a,type:"marker"});if(a.isTriggerEvent!=true&&a.isTriggerEvent!=false)a.isTriggerEvent=true;!b&&a.isTriggerEvent&&this.events.triggerEvent("featureadded",{feature:a,type:"featureadded"})},addLabel:function(a){this.opacity!=null&&a.setOpacity(this.opacity);if(this.map&&this.map.getExtent()){a.map=this.map;this.drawLabel(a)}a.update||
this.events.triggerEvent("featureadded",{feature:a,type:"featureadded"})},removeMarker:function(a,b){if(this.markers&&this.markers.length){Mapabc.Util.removeItem(this.markers,a);a.erase();b&&b.whetherAll&&this.events.triggerEvent("featureremoved",{feature:a});this.removeLabel(a.label)}},removeGroundImage:function(a,b){if(this.groundImages&&this.groundImages.length){Mapabc.Util.removeItem(this.groundImages,a);a.erase();b&&b.whetherAll&&this.events.triggerEvent("featureremoved",{feature:a});this.removeLabel(a.label)}},
removeLabel:function(a,b){if(this.labels&&this.labels.length){Mapabc.Util.removeItem(this.labels,a);a&&a.erase();b&&b.whetherAll&&this.events.triggerEvent("featureremoved",{feature:a})}},clearMarkers:function(a,b){var c=null;c=a?a:{whetherAll:true};b||(b="ALL");if(b=="ALL"){if(this.markers!=null)for(;this.markers.length>0;)this.removeMarker(this.markers[0]);if(this.groundImages!=null)for(var d=0;d<this.groundImages.length;d++){this.removeGroundImage(this.groundImages[d]);d-=1}}else if(b==MOverlay.TYPE_MARKER){if(this.markers!=
null)for(d=0;d<this.markers.length;d++){this.removeMarker(this.markers[d],c);d-=1}}else if(b==MOverlay.TYPE_GROUNDIMAGE)if(this.groundImages!=null)for(d=0;d<this.groundImages.length;d++){this.removeGroundImage(this.groundImages[d],c);d-=1}},clearLabels:function(a){if(this.labels!=null){a||(a="ALL");if(a=="ALL")for(;this.labels.length>0;)this.removeLabel(this.labels[0]);else for(;this.labels.length>0;)this.removeLabel(this.labels[0],{whetherAll:true})}},lnglatObj:{},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);
if(b==null)a.display(false);else if(a.isDrawn()){if(a.icon){if(a.update)if(a.offset)if(a.offset.x!=0||a.offset.y!=0)a.overlay.option.imageAlign=8;if(a.overlay)if(a.overlay.TYPE==MOverlay.TYPE_GROUNDIMAGE){h=Mapabc.Util.getElement(a.markerImg.id);h.style.display=a.overlay.option.zoomLevels.length!=0?a.overlay.option.zoomLevels[0]<=this.map.getZoom()&&this.map.getZoom()<=a.overlay.option.zoomLevels[1]?"":"none":"";this.reduceImg(a.icon.imageDiv.id,this.lnglatObj,b,a)}else{if(!a.icon.size){c=a.markerImg.id+
"_innerImage";h=Mapabc.Util.getElement(c).width;d=Mapabc.Util.getElement(c).height;if(!h||h==0){d=h=36;Mapabc.Util.getElement(c).width=h;Mapabc.Util.getElement(c).height=d}a.icon.size=new Mapabc.Size(h,d)}h=Mapabc.Util.getOffXY(a.overlay.option.imageAlign,a.icon.size);b.x-=h.x;b.y-=h.y;a.icon.moveTo(b)}else{h=new Mapabc.Pixel(a.icon.size.w/2-6,a.icon.size.h);b.x-=h.x;b.y-=h.y;a.icon.moveTo(b)}}}else{a.markerImg=a.draw(b);this.div.appendChild(a.markerImg);a.markerImg.style.zIndex=a.zIndex;if(a.offset){if(a.offset.x!=
0||a.offset.y!=0)a.overlay.option.imageAlign=8;b.x+=a.offset.x;b.y+=a.offset.y}if(!a.icon.size){var c=a.markerImg.id+"_innerImage";h=Mapabc.Util.getElement(c).width;var d=Mapabc.Util.getElement(c).height;if(!h||h==0){d=h=36;Mapabc.Util.getElement(c).width=h;Mapabc.Util.getElement(c).height=d}a.icon.size=new Mapabc.Size(h,d)}a.markerImg.style.cursor="pointer";h=a.overlay?Mapabc.Util.getOffXY(a.overlay.option.imageAlign,a.icon.size):new Mapabc.Pixel(a.icon.size.w/2-6,a.icon.size.h);a.markerImg.style.left=
b.x-h.x+"px";a.markerImg.style.top=b.y-h.y+"px";if(a.overlay)if(a.overlay.TYPE==MOverlay.TYPE_GROUNDIMAGE){c=new Mapabc.Pixel(b.x,b.y);var e=parseInt(a.overlay.option.originalLevel),f=parseInt(this.map.getZoom()),g=Math.abs(e-f);h=a.markerImg.offsetWidth;d=a.markerImg.offsetHeight;if(e>f)for(e=0;e<g;e++){h/=2;d/=2}else if(e<f)for(e=0;e<g;e++){h*=2;d*=2}h=new Mapabc.Pixel(c.x+h,c.y+d);this.lnglatObj[a.icon.imageDiv.id]=[LonLatToMLngLat(this.map.getLonLatFromPixel(c)),LonLatToMLngLat(this.map.getLonLatFromPixel(h)),
a.icon.imageDiv.id];this.reduceImg(a.icon.imageDiv.id,this.lnglatObj,b,a);var h=Mapabc.Util.getElement(a.markerImg.id);h.style.display=a.overlay.option.zoomLevels.length!=0?a.overlay.option.zoomLevels[0]<=this.map.getZoom()&&this.map.getZoom()<=a.overlay.option.zoomLevels[1]?"":"none":"";if(this.lnglatObj[a.icon.imageDiv.id][2]==a.icon.imageDiv.id){var i=new MLngLatBounds(new MLngLat(this.lnglatObj[a.icon.imageDiv.id][0].lngX,this.lnglatObj[a.icon.imageDiv.id][1].latY),new MLngLat(this.lnglatObj[a.icon.imageDiv.id][1].lngX,
this.lnglatObj[a.icon.imageDiv.id][0].latY));if(this.map.returnCoordType==COORD_TYPE_ENCODE)if(!isNaN(i.southWest.lngX)||!isNaN(i.northEast.lngX)||!isNaN(i.southWest.lngY)||!isNaN(i.northEast.latY)){i.southWest.lngX=Mapabc.Util.encodeNumber(i.southWest.lngX,0);i.southWest.latY=Mapabc.Util.encodeNumber(i.southWest.latY,0);i.northEast.lngX=Mapabc.Util.encodeNumber(i.northEast.lngX,0);i.northEast.latY=Mapabc.Util.encodeNumber(i.northEast.latY,0)}}a.overlay.bounds=i}}},reduceImg:function(a,b,c,d){if(b[a][2]==
a)if(b[a][0]||b[a][1]){var e=this.map.getPixelFromLonLat(MLngLatToLonLat(b[a][0]));b=this.map.getPixelFromLonLat(MLngLatToLonLat(b[a][1]));a=Mapabc.Util.getElement(a);a.firstChild.style.width=b.x-e.x+"px";a.firstChild.style.height=b.y-e.y+"px";d.overlay.size=new MSize(parseInt(a.firstChild.style.width),parseInt(a.firstChild.style.height));d.icon.size=new Mapabc.Size(d.overlay.size.width,d.overlay.size.height);var f=Mapabc.Util.getOffXY(d.overlay.option.imageAlign,d.icon.size);a.style.left=c.x-f.x+
"px";a.style.top=c.y-f.y+"px";a.style.display=d.overlay.option.zoomLevels.length!=0?d.overlay.option.zoomLevels[0]<=this.map.getZoom()&&this.map.getZoom()<=d.overlay.option.zoomLevels[1]?"":"none":"";c=LonLatToMLngLat(this.map.getLonLatFromPixel(e));e=LonLatToMLngLat(this.map.getLonLatFromPixel(b));c=new MLngLatBounds(new MLngLat(c.lngX,e.latY),new MLngLat(e.lngX,c.latY));if(this.map.returnCoordType==COORD_TYPE_ENCODE)if(!isNaN(c.southWest.lngX)||!isNaN(c.northEast.lngX)||!isNaN(c.southWest.lngY)||
!isNaN(c.northEast.latY)){c.southWest.lngX=Mapabc.Util.encodeNumber(c.southWest.lngX,0);c.southWest.latY=Mapabc.Util.encodeNumber(c.southWest.latY,0);c.northEast.lngX=Mapabc.Util.encodeNumber(c.northEast.lngX,0);c.northEast.latY=Mapabc.Util.encodeNumber(c.northEast.latY,0)}d.overlay.bounds=c}},drawLabel:function(a){Mapabc.Util.indexOf(this.labels,a)==-1&&this.labels.push(a);var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null)a.display(false);else if(a.isDrawn())a.div&&a.moveTo(b);else{var c=
a.draw(b);if(c){this.div.appendChild(c);var d=a.labelPosition;a=Mapabc.Util.getOffXY(a.labelAlign,new Mapabc.Size(c.offsetWidth,c.offsetHeight));a.x-=d.x;a.y-=d.y;c.style.left=b.x-a.x+"px";c.style.top=b.y-a.y+"px"}}},getDataExtent:function(){var a=null;if(this.markers&&this.markers.length>0){a=new Mapabc.Bounds;for(var b=0,c=this.markers.length;b<c;b++)a.extend(this.markers[b].lonlat);b=0;for(c=this.labels.length;b<c;b++)a.extend(this.labels[b].lonlat)}return a},CLASS_NAME:"Mapabc.Layer.Markers"});
Mapabc.Layer.SphericalMercator={getExtent:function(){var a=null;return a=this.sphericalMercator?this.map.calculateBounds():Mapabc.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=0;a<=this.MAX_ZOOM_LEVEL;++a)this.RESOLUTIONS[a]=156543.0339/Math.pow(2,a);this.units="m";this.projection="EPSG:900913"},forwardMercator:function(a,b){var c=Math.log(Math.tan((90+b)*Math.PI/360))/(Math.PI/180);return new Mapabc.LonLat(a*2.003750834E7/180,
c*2.003750834E7/180)},inverseMercator:function(a,b){var c=b/2.003750834E7*180;c=180/Math.PI*(2*Math.atan(Math.exp(c*Math.PI/180))-Math.PI/2);return new Mapabc.LonLat(a/2.003750834E7*180,c)},projectForward:function(a){var b=Mapabc.Layer.SphericalMercator.forwardMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a},projectInverse:function(a){var b=Mapabc.Layer.SphericalMercator.inverseMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a}};Mapabc.Projection.addTransform("EPSG:4326","EPSG:900913",Mapabc.Layer.SphericalMercator.projectForward);
Mapabc.Projection.addTransform("EPSG:900913","EPSG:4326",Mapabc.Layer.SphericalMercator.projectInverse);
Mapabc.Control.DrawFeature=Mapabc.Class(Mapabc.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],featureAdded:function(){},handlerOptions:null,style:null,initialize:function(a,b,c){this.EVENT_TYPES=Mapabc.Control.DrawFeature.prototype.EVENT_TYPES.concat(Mapabc.Control.prototype.EVENT_TYPES);Mapabc.Control.prototype.initialize.apply(this,[c]);this.callbacks=Mapabc.Util.extend({done:this.drawFeature,modify:function(d,e){this.layer.events.triggerEvent("sketchmodified",{vertex:d,feature:e})},
create:function(d,e){this.layer.events.triggerEvent("sketchstarted",{vertex:d,feature:e})}},this.callbacks);this.layer=a;if(a=this.layer.styleMap&&this.layer.styleMap.styles.temporary){this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=Mapabc.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new Mapabc.StyleMap({"default":a})})}if(c&&c.type=="marker"){this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=Mapabc.Util.applyDefaults(this.handlerOptions.layerOptions,
{styleMap:new Mapabc.StyleMap({"default":a})});this.handlerOptions.pointStyle={pointerEvents:"visiblePainted",pointRadius:0}}this.handler=new b(this,this.callbacks,this.handlerOptions)},mousedown:function(a){var b=a.element.id;a=Mapabc.Util.getElement(b);b=this.map.ameMap.getOverlayById(b,"overlay");var c={};c.width=parseInt(a.offsetWidth);c.height=parseInt(a.offsetHeight);c.map=this.map;if(isNaN(b.lnglat.lngX)||isNaN(b.lnglat.latY))b.lnglat=Mapabc.Util.getCoord(b.lnglat);MLngLatToLonLat(b.lnglat)},
drawFeature:function(a){var b;if(a.CLASS_NAME=="Mapabc.Geometry.Point"){b=new Mapabc.Icon(this.style.imageUrl,this.style.imageSize,this.style.offset);b=new Mapabc.Marker(new Mapabc.LonLat(a.x,a.y),b)}else b=new Mapabc.Feature.Vector(a,null,this.style);b.id=a.id;if(this.layer.events.triggerEvent("sketchcomplete",{feature:b})!==false){b.state=Mapabc.State.INSERT;a.CLASS_NAME=="Mapabc.Geometry.Point"?this.layer.addMarker(b,{mousenotify:true}):this.layer.addFeatures([b],{mousenotify:true});this.featureAdded(b);
this.layer.events.triggerEvent("featureadded",{feature:b})}},CLASS_NAME:"Mapabc.Control.DrawFeature"});
Mapabc.Control.Measure=Mapabc.Class(Mapabc.Control,{layer:null,EVENT_TYPES:["movepoint","measure","measurepartial","featureadded"],featureAdded:function(){},handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,feature:null,initialize:function(a,b,c){this.EVENT_TYPES=Mapabc.Control.Measure.prototype.EVENT_TYPES.concat(Mapabc.Control.prototype.EVENT_TYPES);
Mapabc.Control.prototype.initialize.apply(this,[c]);this.callbacks=Mapabc.Util.extend({done:this.measureComplete,point:this.measurePartial,move:this.movepoint,modify:function(d){this.layer.events.triggerEvent("sketchmodified",{vertex:d,feature:this.feature})},create:function(d){this.layer.events.triggerEvent("sketchstarted",{vertex:d,feature:this.feature})}},this.callbacks);this.layer=a;if(a=this.layer.styleMap&&this.layer.styleMap.styles.temporary){this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=
Mapabc.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new Mapabc.StyleMap({"default":a})})}this.handler=new b(this,this.callbacks,this.handlerOptions)},cancel:function(){this.handler.cancel()},updateHandler:function(a,b){var c=this.active;c&&this.deactivate();this.handler=new a(this,this.callbacks,b);c&&this.activate()},measureComplete:function(a){this.delayedTrigger&&window.clearTimeout(this.delayedTrigger);this.drawFeature(a);this.measure(a,"measure")},drawFeature:function(a){this.feature=
new Mapabc.Feature.Vector(a);if(this.layer.events.triggerEvent("sketchcomplete",{feature:this.feature})!==false){this.feature.state=Mapabc.State.INSERT;this.layer.addFeatures([this.feature]);this.featureAdded(this.feature);this.events.triggerEvent("featureadded",{feature:this.feature})}},measurePartial:function(a,b){this.delayedTrigger=window.setTimeout(Mapabc.Function.bind(function(){this.measure(b,"measurepartial",a)},this),this.partialDelay);var c=this.getBestLength(b)[1];if(c==="m")c="\u7c73";
else if(c==="km")c="\u516c\u91cc";var d=LonLatToMLngLat(new Mapabc.LonLat(a.x,a.y)),e={};e.mapId=this.map.id;e.type="MeasureStep";e.eventType="MeasureStep";e.overlayId="";e.eventX=d.lngX;e.eventY=d.latY;e.measureResult=this.getBestLength(b)[0]+c;triggerEvent(e)},movepoint:function(a,b,c){this.measure(a,"movepoint",c)},measure:function(a,b,c){var d,e;if(a.CLASS_NAME.indexOf("LineString")>-1){d=this.getBestLength(a);e=1}else{d=this.getBestArea(a);e=2}a={measure:d[0],units:d[1],order:e,feature:this.feature,
geometry:a};if(c)a.point=c;this.events.triggerEvent(b,a)},getBestArea:function(a){for(var b=this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e<f;++e){c=b[e];d=this.getArea(a,c).toFixed(2);if(d>1)break}return[d,c]},getArea:function(a,b){var c,d;if(this.geodesic){c=a.getGeodesicArea(this.map.getProjectionObject());d="m"}else{c=a.getArea();d=this.map.getUnits()}var e=Mapabc.INCHES_PER_UNIT[b];if(e)c*=Math.pow(Mapabc.INCHES_PER_UNIT[d]/e,2);return c},getBestLength:function(a){for(var b=
this.displaySystemUnits[this.displaySystem],c,d,e=0,f=b.length;e<f;++e){c=b[e];d=this.getLength(a,c).toFixed(2);if(d>1)break}return[d,c]},getLength:function(a,b){var c,d;if(this.geodesic){c=a.getGeodesicLength(this.map.getProjectionObject());d="m"}else{c=a.getLength();d=this.map.getUnits()}var e=Mapabc.INCHES_PER_UNIT[b];if(e)c*=Mapabc.INCHES_PER_UNIT[d]/e;return c},CLASS_NAME:"Mapabc.Control.Measure"});
Mapabc.Control.ZoomBox=Mapabc.Class(Mapabc.Control,{type:Mapabc.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new Mapabc.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof Mapabc.Bounds){if(this.out){var b=Math.abs(a.right-a.left);b=Math.min(this.map.size.h/Math.abs(a.top-a.bottom),this.map.size.w/b);var c=this.map.getExtent(),d=this.map.getLonLatFromPixel(a.getCenterPixel());a=d.lon-c.getWidth()/2*b;var e=d.lon+c.getWidth()/
2*b,f=d.lat-c.getHeight()/2*b;b=d.lat+c.getHeight()/2*b;b=new Mapabc.Bounds(a,f,e,b)}else{b=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.left,a.bottom));c=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.right,a.top));b=new Mapabc.Bounds(b.lon,b.lat,c.lon,c.lat)}c=this.map.getZoom();this.map.zoomToExtent(b);if(c==this.map.getZoom()&&this.alwaysZoom==true)this.map.zoomTo(c+(this.out?-1:1))}else this.out?this.map.setCenter(this.map.getLonLatFromPixel(a),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(a),
this.map.getZoom()+1)},CLASS_NAME:"Mapabc.Control.ZoomBox"});
Mapabc.Format.WKT=Mapabc.Class(Mapabc.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};Mapabc.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c;if(c=this.regExes.typeStr.exec(a)){a=c[1].toLowerCase();c=c[2];if(this.parse[a])b=this.parse[a].apply(this,[c]);if(this.internalProjection&&this.externalProjection)if(b&&b.CLASS_NAME=="Mapabc.Feature.Vector")b.geometry.transform(this.externalProjection,
this.internalProjection);else if(b&&a!="geometrycollection"&&typeof b=="object"){a=0;for(c=b.length;a<c;a++)b[a].geometry.transform(this.externalProjection,this.internalProjection)}}return b},write:function(a){var b,c,d;if(a.constructor==Array){a=a;d=true}else{a=[a];d=false}var e=[];d&&e.push("GEOMETRYCOLLECTION(");for(var f=0,g=a.length;f<g;++f){d&&f>0&&e.push(",");b=a[f].geometry;c=b.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[c])return null;if(this.internalProjection&&this.externalProjection){b=
b.clone();b.transform(this.internalProjection,this.externalProjection)}b=this.extract[c].apply(this,[b]);e.push(c.toUpperCase()+"("+b+")")}d&&e.push(")");return e.join("")},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},
multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")}},parse:{point:function(a){a=
Mapabc.String.trim(a).split(this.regExes.spaces);return new Mapabc.Feature.Vector(new Mapabc.Geometry.Point(a[0],a[1]))},multipoint:function(a){a=Mapabc.String.trim(a).split(",");for(var b=[],c=0,d=a.length;c<d;++c)b.push(this.parse.point.apply(this,[a[c]]).geometry);return new Mapabc.Feature.Vector(new Mapabc.Geometry.MultiPoint(b))},linestring:function(a){a=Mapabc.String.trim(a).split(",");for(var b=[],c=0,d=a.length;c<d;++c)b.push(this.parse.point.apply(this,[a[c]]).geometry);return new Mapabc.Feature.Vector(new Mapabc.Geometry.LineString(b))},
multilinestring:function(a){for(var b=Mapabc.String.trim(a).split(this.regExes.parenComma),c=[],d=0,e=b.length;d<e;++d){a=b[d].replace(this.regExes.trimParens,"$1");c.push(this.parse.linestring.apply(this,[a]).geometry)}return new Mapabc.Feature.Vector(new Mapabc.Geometry.MultiLineString(c))},polygon:function(a){var b;a=Mapabc.String.trim(a).split(this.regExes.parenComma);for(var c=[],d=0,e=a.length;d<e;++d){b=a[d].replace(this.regExes.trimParens,"$1");b=this.parse.linestring.apply(this,[b]).geometry;
b=new Mapabc.Geometry.LinearRing(b.components);c.push(b)}return new Mapabc.Feature.Vector(new Mapabc.Geometry.Polygon(c))},multipolygon:function(a){for(var b=Mapabc.String.trim(a).split(this.regExes.doubleParenComma),c=[],d=0,e=b.length;d<e;++d){a=b[d].replace(this.regExes.trimParens,"$1");c.push(this.parse.polygon.apply(this,[a]).geometry)}return new Mapabc.Feature.Vector(new Mapabc.Geometry.MultiPolygon(c))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");a=Mapabc.String.trim(a).split("|");
for(var b=[],c=0,d=a.length;c<d;++c)b.push(Mapabc.Format.WKT.prototype.read.apply(this,[a[c]]));return b}},CLASS_NAME:"Mapabc.Format.WKT"});
Mapabc.Layer.Boxes=Mapabc.Class(Mapabc.Layer.Markers,{box:null,initialize:function(){Mapabc.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(a){var b=a.bounds,c=this.map.getLayerPxFromLonLat(a.lonlat);b=this.map.getPixelFromLonLat((new Mapabc.LonLat(b.right,b.bottom)).transform(new Mapabc.Projection("EPSG:4326"),this.map.getProjectionObject()));if(b==null||c==null)a.display(false);else{var d=new Mapabc.Size(Math.max(1,b.x-c.x),Math.max(1,b.y-c.y));if(d=a.draw(c,d)){if(a.content)d.innerHTML=
a.content;d.style.zIndex=a.zIndex;d.oncontextmenu=function(){return false};(new Mapabc.Events(this,d,null,true)).on({mousedown:a.map.onmousedown,mousemove:a.map.onmousemove,mouseup:a.map.onmouseup,mouseout:a.map.onmouseout,contextmenu:a.map.oncontextmenu,click:a.map.onclick,scope:this})}if(!a.drawn){this.div.appendChild(d);a.drawn=true}}if(a.id)if(d)d.id=a.id;else return;d.style.width="auto";d.style.height="auto";d.style.cursor="pointer";c=parseInt(d.style.left);b=parseInt(d.style.top);a=Mapabc.Util.getOffXY(a.boxAlign,
new Mapabc.Size(d.offsetWidth,d.offsetHeight));c-=a.x;b-=a.y;d.style.left=c+"px";d.style.top=b+"px"},removeMarker:function(a,b){b&&b.whetherAll&&this.map.events.triggerEvent("featureremoved",{feature:a});Mapabc.Util.removeItem(this.markers,a);a.div!=null&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},CLASS_NAME:"Mapabc.Layer.Boxes"});
Mapabc.Layer.Grid=Mapabc.Class(Mapabc.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(){Mapabc.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[]},destroy:function(){this.clearGrid();this.tileSize=this.grid=null;Mapabc.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;a<b;a++)for(var c=this.grid[a],
d=0,e=c.length;d<e;d++){var f=c[d];this.removeTileMonitoringHooks(f);f.destroy()}this.grid=[]}},clone:function(a){if(a==null)a=new Mapabc.Layer.Grid(this.name,this.url,this.params,this.options);a=Mapabc.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null)a.tileSize=this.tileSize.clone();a.grid=[];return a},moveTo:function(a,b,c){Mapabc.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);a=a||this.map.getExtent();if(a!=null){var d=!this.grid.length||b,e=this.getTilesBounds();
if(this.singleTile){if(d||!c&&!e.containsBounds(a))this.initSingleTile(a)}else d||!e.containsBounds(a,true)?this.initGriddedTiles(a):this.moveGriddedTiles(a)}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize().clone();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}Mapabc.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){return this.getTilesBounds()},getTilesBounds:function(){var a=null;if(this.grid.length){a=this.grid[this.grid.length-1][0];
var b=this.grid[0][this.grid[0].length-1];a=new Mapabc.Bounds(a.bounds.left,a.bounds.bottom,b.bounds.right,b.bounds.top)}return a},getTitledByXY:function(a){for(var b=0,c=this.grid.length;b<c;b++)for(var d=this.grid[b],e=0,f=d.length;e<f;e++){var g=d[e];if(g.bounds.containsLonLat(a))return g}return null},getTilesByBounds:function(a){for(var b=[],c=0,d=this.grid.length;c<d;c++)for(var e=this.grid[c],f=0,g=e.length;f<g;f++){var h=e[f];h.bounds.intersectsBounds(a)&&b.push(h.url)}return b},initSingleTile:function(a){var b=
a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;b=new Mapabc.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2);c=this.map.getLayerPxFromLonLat(new Mapabc.LonLat(b.left,b.top));this.grid.length||(this.grid[0]=[]);if(a=this.grid[0][0])a.moveTo(b,c);else{a=this.addTile(b,c);this.addTileMonitoringHooks(a);a.draw();this.grid[0][0]=a}this.removeExcessTiles(1,1)},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w;c=c*this.tileSize.h;var e=a.left-b.left,f=Math.floor(e/d)-this.buffer;
e=-(e/d-f)*this.tileSize.w;f=b.left+f*d;a=a.top-(b.bottom+c);var g=Math.ceil(a/c)+this.buffer;return{tilelon:d,tilelat:c,tileoffsetlon:f,tileoffsetlat:b.bottom+g*c,tileoffsetx:e,tileoffsety:-(g-a/c)*this.tileSize.h}},initGriddedTiles:function(a){var b=this.map.getSize(),c=Math.ceil(b.h/this.tileSize.h)+Math.max(1,2*this.buffer);b=Math.ceil(b.w/this.tileSize.w)+Math.max(1,2*this.buffer);var d=this.maxExtent,e=this.map.getResolution(),f=this.calculateGridLayout(a,d,e);d=Math.round(f.tileoffsetx);e=
Math.round(f.tileoffsety);var g=f.tileoffsetlon,h=f.tileoffsetlat,i=f.tilelon;f=f.tilelat;this.origin=new Mapabc.Pixel(d,e);var j=d,k=g,l=0,m=parseInt(this.map.layerContainerDiv.style.left),n=parseInt(this.map.layerContainerDiv.style.top);do{var o=this.grid[l++];if(!o){o=[];this.grid.push(o)}g=k;d=j;var q=0;do{var r=new Mapabc.Bounds(g,h,g+i,h+f),p=d;p-=m;var t=e;t-=n;p=new Mapabc.Pixel(p,t);if(t=o[q++])t.moveTo(r,p,false);else{t=this.addTile(r,p);this.addTileMonitoringHooks(t);o.push(t)}g+=i;d+=
this.tileSize.w}while(g<=a.right+i*this.buffer||q<b);h-=f;e+=this.tileSize.h}while(h>=a.bottom-f*this.buffer||l<c);this.removeExcessTiles(l,q);if(this.map.traffic)this.map.traffic.div.style.display="none";if(this.map.satellite)this.map.satellite.div.style.display="none";if(this.map.usermap)this.map.usermap.div.style.display="none";if(this.map.custommap)this.map.custommap.div.style.display="none";if(this.map.layerContainerDiv.childNodes[0].childNodes.length!=0&&this.map.isContinuous)if(this.map.layerContainerDiv.childNodes[0].childNodes[0].childNodes[0].style.width==
"256px")if(!this.map.isTraffic&&!this.map.isSatellite&&!this.map.isUsermap&&!this.map.isCustommap){this.map.setDragEnabled(false);this.gradualZoom_new()}else this.spiralTileLoad(true);else{this.map.setDragEnabled(true);this.spiralTileLoad(true)}if(this.map.layerContainerDiv.childNodes[0].childNodes.length==0)this.spiralTileLoad(false);else this.map.isContinuous||this.spiralTileLoad(false);if(this.map.traffic){var u=this.map.traffic;u.div.style.display=="none"&&setTimeout(function(){u.div.style.display=
""},600)}if(this.map.satellite){var v=this.map.satellite;v.div.style.display=="none"&&setTimeout(function(){v.div.style.display=""},600)}if(this.map.usermap){var w=this.map.usermap;w.div.style.display=="none"&&setTimeout(function(){w.div.style.display=""},600)}if(this.map.custommap){var z=this.map.custommap;z.div.style.display=="none"&&setTimeout(function(){z.div.style.display=""},600)}},gradualZoom_new:function(){var a=this.map.zoomArr.length,b=this.map.layerContainerDiv.childNodes[0].childNodes[0],
c=parseInt(b.style.left);b=parseInt(b.style.top);var d=this.map.zoom_center;if(d==null){d=this.map.getSize();d=new Mapabc.Pixel(d.w/2,d.h/2)}for(;c+256<d.x;)c+=256;for(;c>d.x;)c-=256;for(;b+256<d.y;)b+=256;for(;b>d.y;)b-=256;for(var e=0;e<a;e++){var f=this.map.zoomArr[e][0],g=0*e;this.map.zoomArr[e].push(Math.round(d.x)-Math.round((-c+d.x)*f/256)+Math.round(0*e));this.map.zoomArr[e].push(Math.round(d.y)-Math.round((-b+d.y)*f/256)+Math.round(g))}this.gradualZoom_random()},gradualZoom_random:function(){if(this.map){if(this.map.zoom_index<
3){for(var a=this.map.layerContainerDiv.childNodes[0].childNodes,b=a.length,c=this.map.zoomArr[this.map.zoom_index][0],d=this.map.zoomArr[this.map.zoom_index-1][0],e=this.map.zoomArr[this.map.zoom_index][1],f=this.map.zoomArr[this.map.zoom_index-1][1],g=this.map.zoomArr[this.map.zoom_index][2],h=this.map.zoomArr[this.map.zoom_index-1][2],i=0;i<b;i++){var j=a[i],k=parseInt(j.style.left),l=parseInt(j.style.top);k=(k-f)/d;l=(l-h)/d;if(isNaN(k)&&isNaN(k))return;j.style.left=e+k*c+"px";j.style.top=g+l*
c+"px";j.childNodes[0].style.width=c+"px";j.childNodes[0].style.height=c+"px";j.childNodes[0].parentNode.style.width=c+"px";j.childNodes[0].parentNode.style.height=c+"px"}var m=this;setTimeout(function(){m.gradualZoom_random()},70)}else{this.spiralTileLoad(false);this.map.setDragEnabled(true)}this.map.zoom_index+=1}},spiralTileLoad:function(a){for(var b=[],c=["right","down","left","up"],d=0,e=-1,f=Mapabc.Util.indexOf(c,"right"),g=0;g<c.length;){var h=d,i=e;switch(c[f]){case "right":i++;break;case "down":h++;
break;case "left":i--;break;case "up":h--;break}var j=null;if(h<this.grid.length&&h>=0&&i<this.grid[0].length&&i>=0)j=this.grid[h][i];if(j!=null&&!j.queued){b.unshift(j);j.queued=true;g=0;d=h;e=i}else{f=(f+1)%4;g++}}if(a)setTimeout(function(){for(var k=0,l=b.length;k<l;k++){var m=b[k];m.draw();m.queued=false}},100);else{a=0;for(c=b.length;a<c;a++){j=b[a];j.draw();j.queued=false}}},addTile:function(){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.numLoadingTiles==0&&this.events.triggerEvent("loadstart");
this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");this.numLoadingTiles==0&&this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer||
1;;){var b=this.map.getViewPortPxFromLayerPx(this.grid[0][0].position);if(b.x>-this.tileSize.w*(a-1))this.shiftColumn(true);else if(b.x<-this.tileSize.w*a)this.shiftColumn(false);else if(b.y>-this.tileSize.h*(a-1))this.shiftRow(true);else if(b.y<-this.tileSize.h*a)this.shiftRow(false);else break}},shiftRow:function(a){var b=this.grid,c=b[a?0:this.grid.length-1],d=this.map.getResolution(),e=a?-this.tileSize.h:this.tileSize.h;d=d*-e;for(var f=a?b.pop():b.shift(),g=0,h=c.length;g<h;g++){var i=c[g],j=
i.bounds.clone();i=i.position.clone();j.bottom+=d;j.top+=d;i.y+=e;f[g].moveTo(j,i)}a?b.unshift(f):b.push(f)},shiftColumn:function(a){for(var b=a?-this.tileSize.w:this.tileSize.w,c=this.map.getResolution()*b,d=0,e=this.grid.length;d<e;d++){var f=this.grid[d],g=f[a?0:f.length-1],h=g.bounds.clone();g=g.position.clone();h.left+=c;h.right+=c;g.x+=b;var i=a?this.grid[d].pop():this.grid[d].shift();i.moveTo(h,g);a?f.unshift(i):f.push(i)}},removeExcessTiles:function(a,b){for(;this.grid.length>a;)for(var c=
this.grid.pop(),d=0,e=c.length;d<e;d++){var f=c[d];this.removeTileMonitoringHooks(f);f.destroy()}for(;this.grid[0].length>b;){d=0;for(e=this.grid.length;d<e;d++){c=this.grid[d];f=c.pop();this.removeTileMonitoringHooks(f);f.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w;c=c*this.tileSize.h;var e=this.getLonLatFromViewPortPx(a);a=b.left+d*Math.floor((e.lon-b.left)/
d);b=b.bottom+c*Math.floor((e.lat-b.bottom)/c);return new Mapabc.Bounds(a,b,a+d,b+c)},CLASS_NAME:"Mapabc.Layer.Grid"});
Mapabc.Style=Mapabc.Class({name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(a,b){Mapabc.Util.extend(this,b);this.rules=[];b&&b.rules&&this.addRules(b.rules);this.setDefaultStyle(a||Mapabc.Feature.Vector.style["default"])},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++){this.rules[a].destroy();this.rules[a]=null}this.defaultStyle=this.rules=null},createSymbolizer:function(a){for(var b=
this.defaultsPerSymbolizer?{}:this.createLiterals(Mapabc.Util.extend({},this.defaultStyle),a),c=this.rules,d,e=[],f=false,g=0,h=c.length;g<h;g++){d=c[g];if(d.evaluate(a))if(d instanceof Mapabc.Rule&&d.elseFilter)e.push(d);else{f=true;this.applySymbolizer(d,b,a)}}if(f==false&&e.length>0){f=true;g=0;for(h=e.length;g<h;g++)this.applySymbolizer(e[g],b,a)}if(c.length>0&&f==false)b.display="none";return b},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):Mapabc.Style.SYMBOLIZER_PREFIXES[0];
a=a.symbolizer[d]||a.symbolizer;if(this.defaultsPerSymbolizer===true){d=this.defaultStyle;Mapabc.Util.applyDefaults(a,{pointRadius:d.pointRadius});if(a.stroke===true||a.graphic===true)Mapabc.Util.applyDefaults(a,{strokeWidth:d.strokeWidth,strokeColor:d.strokeColor,strokeOpacity:d.strokeOpacity,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap});if(a.fill===true||a.graphic===true)Mapabc.Util.applyDefaults(a,{fillColor:d.fillColor,fillOpacity:d.fillOpacity});a.graphic===true&&Mapabc.Util.applyDefaults(a,
{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(Mapabc.Util.extend(b,a),c)},createLiterals:function(a,b){var c=this.context||b.attributes||b.data;for(var d in this.propertyStyles)a[d]=
Mapabc.Style.createLiteral(a[d],c,b);return a},findPropertyStyles:function(){var a={};this.addPropertyStyles(a,this.defaultStyle);for(var b=this.rules,c,d,e=0,f=b.length;e<f;e++){c=b[e].symbolizer;for(var g in c){d=c[g];if(typeof d=="object")this.addPropertyStyles(a,d);else{this.addPropertyStyles(a,c);break}}}return a},addPropertyStyles:function(a,b){var c;for(var d in b){c=b[d];if(typeof c=="string"&&c.match(/\$\{\w+\}/))a[d]=true}return a},addRules:function(a){this.rules=this.rules.concat(a);this.propertyStyles=
this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=Mapabc.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;c<d;c++)if(a.CLASS_NAME.indexOf(b[c])!=-1)return b[c]},CLASS_NAME:"Mapabc.Style"});Mapabc.Style.createLiteral=function(a,b,c){if(typeof a=="string"&&a.indexOf("${")!=-1){a=Mapabc.String.format(a,b,[c]);a=isNaN(a)||!a?a:parseFloat(a)}return a};
Mapabc.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text"];
Mapabc.Control.Navigation=Mapabc.Class(Mapabc.Control,{dragPan:null,dragPanOptions:null,zoomBox:null,zoomWheelEnabled:true,handleRightClicks:false,zoomBoxKeyMask:Mapabc.Handler.MOD_SHIFT,initialize:function(){this.handlers={};Mapabc.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;Mapabc.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();
this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBox.activate();return Mapabc.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return Mapabc.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks)this.map.viewPortDiv.oncontextmenu=function(){return false};this.handlers.click=
new Mapabc.Handler.Click(this,{dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{"double":true,stopDouble:true});this.dragPan=new Mapabc.Control.DragPan(Mapabc.Util.extend({map:this.map},this.dragPanOptions));this.zoomBox=new Mapabc.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new Mapabc.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown});this.activate()},defaultDblClick:function(a){this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),
this.map.zoom+1);this.map.getZoom()<=this.map.maxZoomLevel&&this.map.magnifyingglassZoomIn(a)},defaultDblRightClick:function(a){this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),this.map.zoom-1)},wheelChange:function(a,b){var c=this.map.getZoom()+b;if(this.map.isValidZoomLevel(c)){var d=this.map.getSize(),e=d.w/2-a.xy.x;d=a.xy.y-d.h/2;var f=this.map.baseLayer.getResolutionForZoom(c),g=this.map.getLonLatFromPixel(a.xy);this.map.setCenter(new Mapabc.LonLat(g.lon+e*f,g.lat+d*f),c)}},wheelUp:function(a){this.wheelChange(a,
1)},wheelDown:function(a){this.wheelChange(a,-1)},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"Mapabc.Control.Navigation"});
Mapabc.Geometry=Mapabc.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=Mapabc.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new Mapabc.Geometry},setBounds:function(a){if(a)this.bounds=a.clone()},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(a){this.getBounds()?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){this.bounds==null&&this.calculateBounds();
return this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(a,b,c){var d=false;if(this.getBounds()!=null&&a!=null){b=b!=null?b:0;c=c!=null?c:0;d=(new Mapabc.Bounds(this.bounds.left-b,this.bounds.bottom-c,this.bounds.right+b,this.bounds.top+c)).containsLonLat(a)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return Mapabc.Format.WKT.prototype.write(new Mapabc.Feature.Vector(this))},
CLASS_NAME:"Mapabc.Geometry"});Mapabc.Geometry.fromWKT=function(a){var b=arguments.callee.format;if(!b){b=new Mapabc.Format.WKT;arguments.callee.format=b}var c;b=b.read(a);if(b instanceof Mapabc.Feature.Vector)c=b.geometry;else if(b instanceof Array){c=b.length;for(var d=new Array(c),e=0;e<c;++e)d[e]=b[e].geometry;c=new Mapabc.Geometry.Collection(d)}return c};
Mapabc.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point;c=c&&c.tolerance;var e=false,f=a.x1-b.x1,g=a.y1-b.y1,h=a.x2-a.x1,i=a.y2-a.y1,j=b.y2-b.y1,k=b.x2-b.x1,l=j*h-k*i;j=k*g-j*f;g=h*g-i*f;if(l==0){if(j==0&&g==0)e=true}else{f=j/l;l=g/l;if(f>=0&&f<=1&&l>=0&&l<=1)if(d){h=a.x1+f*h;l=a.y1+f*i;e=new Mapabc.Geometry.Point(h,l)}else e=true}if(c)if(e){if(d){a=[a,b];b=0;a:for(;b<2;++b){f=a[b];for(i=1;i<3;++i){h=f["x"+i];l=f["y"+i];d=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(l-e.y,2));if(d<c){e.x=h;e.y=
l;break a}}}}}else{a=[a,b];b=0;a:for(;b<2;++b){h=a[b];l=a[(b+1)%2];for(i=1;i<3;++i){f={x:h["x"+i],y:h["y"+i]};g=Mapabc.Geometry.distanceToSegment(f,l);if(g.distance<c){e=d?new Mapabc.Geometry.Point(f.x,f.y):true;break a}}}}return e};
Mapabc.Geometry.distanceToSegment=function(a,b){var c=a.x,d=a.y,e=b.x1,f=b.y1,g=b.x2,h=b.y2,i=g-e,j=h-f,k=(i*(c-e)+j*(d-f))/(Math.pow(i,2)+Math.pow(j,2));if(k<=0){e=e;f=f}else if(k>=1){e=g;f=h}else{e=e+k*i;f=f+k*j}return{distance:Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)),x:e,y:f}};
Mapabc.Layer.MapServer=Mapabc.Class(Mapabc.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(a,b,c,d){var e=[];e.push(a,b,c,d);Mapabc.Layer.Grid.prototype.initialize.apply(this,e);this.params=Mapabc.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(d==null||d.isBaseLayer==null)this.isBaseLayer=this.params.transparent!="true"&&this.params.transparent!=true},clone:function(a){if(a==null)a=new Mapabc.Layer.MapServer(this.name,this.url,this.params,this.options);return a=
Mapabc.Layer.Grid.prototype.clone.apply(this,[a])},addTile:function(a,b){return new Mapabc.Tile.Image(this,b,a,null,this.tileSize)},getURL:function(a){a=this.adjustBounds(a);a=[a.left,a.bottom,a.right,a.top];var b=this.getImageSize();return this.getFullRequestString({mapext:a,imgext:a,map_size:[b.w,b.h],imgx:b.w/2,imgy:b.h/2,imgxy:[b.w,b.h]})},getFullRequestString:function(a,b){var c=b==null?this.url:b,d=Mapabc.Util.extend({},this.params);d=Mapabc.Util.extend(d,a);var e=Mapabc.Util.getParameterString(d);
if(c instanceof Array)c=this.selectUrl(e,c);e=Mapabc.Util.upperCaseObject(Mapabc.Util.getParameters(c));for(var f in d)f.toUpperCase()in e&&delete d[f];e=Mapabc.Util.getParameterString(d);d=c;e=e.replace(/,/g,"+");if(e!=""){f=c.charAt(c.length-1);d+=f=="&"||f=="?"?e:c.indexOf("?")==-1?"?"+e:"&"+e}return d},CLASS_NAME:"Mapabc.Layer.MapServer"});
Mapabc.Layer.TMS=Mapabc.Class(Mapabc.Layer.Grid,{serviceVersion:"1.0.0",isBaseLayer:true,tileOrigin:null,serverResolutions:null,initialize:function(a,b,c){var d=[];d.push(a,b,{},c);Mapabc.Layer.Grid.prototype.initialize.apply(this,d)},destroy:function(){Mapabc.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null)a=new Mapabc.Layer.TMS(this.name,this.url,this.options);return a=Mapabc.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=
this.map.getResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w));a=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h));b=this.serviceVersion+"/"+this.layername+"/"+(this.serverResolutions!=null?Mapabc.Util.indexOf(this.serverResolutions,b):this.map.getZoom())+"/"+c+"/"+a+"."+this.type;c=this.url;if(c instanceof Array)c=this.selectUrl(b,c);return c+b},addTile:function(a,b){return new Mapabc.Tile.Image(this,b,a,null,this.tileSize)},setMap:function(){Mapabc.Layer.Grid.prototype.setMap.apply(this,
arguments);if(!this.tileOrigin)this.tileOrigin=new Mapabc.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)},CLASS_NAME:"Mapabc.Layer.TMS"});
Mapabc.Rule=Mapabc.Class({id:null,name:"default",title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};Mapabc.Util.extend(this,a);this.id=Mapabc.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null},evaluate:function(a){var b=this.getContext(a),c=true;if(this.minScaleDenominator||this.maxScaleDenominator)var d=
a.layer.map.getScale();if(this.minScaleDenominator)c=d>=Mapabc.Style.createLiteral(this.minScaleDenominator,b);if(c&&this.maxScaleDenominator)c=d<Mapabc.Style.createLiteral(this.maxScaleDenominator,b);if(c&&this.filter)c=this.filter.CLASS_NAME=="Mapabc.Filter.FeatureId"?this.filter.evaluate(a):this.filter.evaluate(b);return c},getContext:function(a){var b=this.context;b||(b=a.attributes||a.data);if(typeof this.context=="function")b=this.context(a);return b},clone:function(){var a=Mapabc.Util.extend({},
this);a.symbolizer={};for(var b in this.symbolizer){value=this.symbolizer[b];type=typeof value;if(type==="object")a.symbolizer[b]=Mapabc.Util.extend({},value);else if(type==="string")a.symbolizer[b]=value}a.filter=this.filter&&this.filter.clone();a.context=this.context&&Mapabc.Util.extend({},this.context);return new Mapabc.Rule(a)},CLASS_NAME:"Mapabc.Rule"});
Mapabc.StyleMap=Mapabc.Class({styles:null,extendDefault:true,initialize:function(a,b){this.styles={"default":new Mapabc.Style(Mapabc.Feature.Vector.style["default"]),select:new Mapabc.Style(Mapabc.Feature.Vector.style.select),temporary:new Mapabc.Style(Mapabc.Feature.Vector.style.temporary),"delete":new Mapabc.Style(Mapabc.Feature.Vector.style["delete"])};if(a instanceof Mapabc.Style){this.styles["default"]=a;this.styles.select=a;this.styles.temporary=a;this.styles["delete"]=a}else if(typeof a=="object")for(var c in a)if(a[c]instanceof
Mapabc.Style)this.styles[c]=a[c];else if(typeof a[c]=="object")this.styles[c]=new Mapabc.Style(a[c]);else{this.styles["default"]=new Mapabc.Style(a);this.styles.select=new Mapabc.Style(a);this.styles.temporary=new Mapabc.Style(a);this.styles["delete"]=new Mapabc.Style(a);break}Mapabc.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,b){a||(a=new Mapabc.Feature.Vector);this.styles[b]||(b="default");a.renderIntent=
b;var c={};if(this.extendDefault&&b!="default")c=this.styles["default"].createSymbolizer(a);return Mapabc.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[];for(var f in c)e.push(new Mapabc.Rule({symbolizer:c[f],context:d,filter:new Mapabc.Filter.Comparison({type:Mapabc.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:"Mapabc.StyleMap"});
Mapabc.Control.NavToolbar=Mapabc.Class(Mapabc.Control.Panel,{initialize:function(a){Mapabc.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new Mapabc.Control.Navigation,new Mapabc.Control.ZoomBox])},draw:function(){var a=Mapabc.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"Mapabc.Control.NavToolbar"});
Mapabc.Geometry.Circle=Mapabc.Class(Mapabc.Geometry,{x:null,radius:0,y:null,initialize:function(a,b,c){Mapabc.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b);this.radius=parseFloat(c)},clone:function(a){if(a==null)a=new Mapabc.Geometry.Circle(this.x,this.y,this.radius);Mapabc.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new Mapabc.Bounds(this.x-this.radius,this.y-this.radius,this.x+this.radius,this.y+this.radius)},distanceTo:function(a,
b){var c=!(b&&b.edge===false)&&b&&b.details,d,e,f,g,h;e=this.x;f=this.y;g=a.x;h=a.y;d=Math.sqrt(Math.pow(e-g,2)+Math.pow(f-h,2));return!c?d:{x0:e,y0:f,x1:g,y1:h,distance:d}},equals:function(a){var b=false;if(a!=null)b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y);return b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x+=a;this.y+=b;this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-
b.y,this.x-b.x);this.x=b.x+c*Math.cos(d);this.y=b.y+c*Math.sin(d);this.clearBounds()},getCentroid:function(){return new Mapabc.Geometry.Point(this.x,this.y)},resize:function(a,b,c){this.x=b.x+a*(c==undefined?1:c)*(this.x-b.x);this.y=b.y+a*(this.y-b.y);this.clearBounds();return this},intersects:function(a){var b=false;return b=a.CLASS_NAME=="Mapabc.Geometry.Point"?this.equals(a):a.intersects(this)},transform:function(a,b){if(a&&b){Mapabc.Projection.transform(this,a,b);this.bounds=null}return this},
getVertices:function(){return[this]},CLASS_NAME:"Mapabc.Geometry.Circle"});
Mapabc.Geometry.Collection=Mapabc.Class(Mapabc.Geometry,{components:null,componentTypes:null,initialize:function(a){Mapabc.Geometry.prototype.initialize.apply(this,arguments);this.components=[];a!=null&&this.addComponents(a)},destroy:function(){this.components.length=0;this.components=null},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b<c;b++)a.addComponent(this.components[b].clone());Mapabc.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var a=
[],b=0,c=this.components.length;b<c;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var a=1,b=this.components.length;a<b;a++)this.extendBounds(this.components[a].getBounds())}},addComponents:function(a){a instanceof Array||(a=[a]);for(var b=0,c=a.length;b<c;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=false;if(a)if(this.componentTypes==
null||Mapabc.Util.indexOf(this.componentTypes,a.CLASS_NAME)>-1){if(b!=null&&b<this.components.length){c=this.components.slice(0,b);var d=this.components.slice(b,this.components.length);c.push(a);this.components=c.concat(d)}else this.components.push(a);a.parent=this;this.clearBounds();c=true}return c},removeComponents:function(a){a instanceof Array||(a=[a]);for(var b=a.length-1;b>=0;--b)this.removeComponent(a[b])},removeComponent:function(a){Mapabc.Util.removeItem(this.components,a);this.clearBounds()},
getLength:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(){return this.components.length&&this.components[0].getCentroid()},getGeodesicLength:function(a){for(var b=0,c=0,d=this.components.length;c<
d;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c=!(b&&b.edge===false)&&b&&b.details,d,e,f=Number.POSITIVE_INFINITY,g=0,h=this.components.length;g<h;++g){d=
this.components[g].distanceTo(a,b);distance=c?d.distance:d;if(distance<f){f=distance;e=d;if(f==0)break}}return e},equals:function(a){var b=true;if(!a||!a.CLASS_NAME||this.CLASS_NAME!=a.CLASS_NAME)b=false;else if(!(a.components instanceof Array)||a.components.length!=this.components.length)b=false;else for(var c=0,d=this.components.length;c<d;++c)if(!this.components[c].equals(a.components[c])){b=false;break}return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].transform(a,
b);this.bounds=null}return this},intersects:function(a){for(var b=false,c=0,d=this.components.length;c<d;++c)if(b=a.intersects(this.components[c]))break;return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;c<d;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"Mapabc.Geometry.Collection"});
Mapabc.Geometry.Point=Mapabc.Class(Mapabc.Geometry,{x:null,y:null,initialize:function(a,b){Mapabc.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){if(a==null)a=new Mapabc.Geometry.Point(this.x,this.y);Mapabc.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new Mapabc.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a){var b,c,d;b=this.x;c=this.y;d=a.x;a=a.y;b=new Mapabc.LonLat(b,c);c=new Mapabc.LonLat(d,
a);d=b.transform(new Mapabc.Projection("EPSG:900913"),new Mapabc.Projection("EPSG:4326"));d=new MLngLat(d.lon,d.lat,1);b=c.transform(new Mapabc.Projection("EPSG:900913"),new Mapabc.Projection("EPSG:4326"));a=new MLngLat(b.lon,b.lat,1);b=d.latY*(Math.PI/180);c=a.latY*(Math.PI/180);d=d.lngX*(Math.PI/180)-a.lngX*(Math.PI/180);return 2*Math.asin(Math.sqrt(Math.pow(Math.sin((b-c)/2),2)+Math.cos(b)*Math.cos(c)*Math.pow(Math.sin(d/2),2)))*6378137},equals:function(a){var b=false;if(a!=null)b=this.x==a.x&&
this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y);return b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x+=a;this.y+=b;this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d);this.y=b.y+c*Math.sin(d);this.clearBounds()},getCentroid:function(){return new Mapabc.Geometry.Point(this.x,this.y)},resize:function(a,b,c){this.x=b.x+a*(c==undefined?1:c)*(this.x-b.x);this.y=
b.y+a*(this.y-b.y);this.clearBounds();return this},intersects:function(a){var b=false;return b=a.CLASS_NAME=="Mapabc.Geometry.Point"?this.equals(a):a.intersects(this)},transform:function(a,b){if(a&&b){Mapabc.Projection.transform(this,a,b);this.bounds=null}return this},getVertices:function(){return[this]},CLASS_NAME:"Mapabc.Geometry.Point"});
Mapabc.Geometry.Rectangle=Mapabc.Class(Mapabc.Geometry,{x:null,y:null,width:null,height:null,initialize:function(a,b,c,d){Mapabc.Geometry.prototype.initialize.apply(this,arguments);this.x=a;this.y=b;this.width=c;this.height=d},calculateBounds:function(){this.bounds=new Mapabc.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){return 2*this.width+2*this.height},getArea:function(){return this.width*this.height},CLASS_NAME:"Mapabc.Geometry.Rectangle"});
Mapabc.Layer.MapServer.Untiled=Mapabc.Class(Mapabc.Layer.MapServer,{singleTile:true,initialize:function(){Mapabc.Layer.MapServer.prototype.initialize.apply(this,arguments);Mapabc.Console.warn("The Mapabc.Layer.MapServer.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal Mapabc.Layer.MapServer class, passing it the option 'singleTile' as true.")},clone:function(a){if(a==null)a=new Mapabc.Layer.MapServer.Untiled(this.name,this.url,this.params,this.options);return a=
Mapabc.Layer.MapServer.prototype.clone.apply(this,[a])},CLASS_NAME:"Mapabc.Layer.MapServer.Untiled"});
Mapabc.Layer.Vector=Mapabc.Class(Mapabc.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh","mousefeatureadded","contextmenu","menuItemclick"],isBaseLayer:false,isFixed:false,isVector:true,features:null,
selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(){this.EVENT_TYPES=Mapabc.Layer.Vector.prototype.EVENT_TYPES.concat(Mapabc.Layer.prototype.EVENT_TYPES);Mapabc.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported())this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=
null;this.displayError()}if(!this.styleMap)this.styleMap=new Mapabc.StyleMap;this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies)for(var a=0,b=this.strategies.length;a<b;a++)this.strategies[a].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++){a=this.strategies[b];a.autoDestroy&&a.destroy()}this.strategies=null}if(this.protocol){this.protocol.autoDestroy&&this.protocol.destroy();this.protocol=null}this.destroyFeatures();
this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;Mapabc.Layer.prototype.destroy.apply(this,arguments)},refresh:function(a){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;a++){var c=Mapabc.Renderer[this.renderers[a]];if(c&&c.prototype.supported()){this.renderer=new c(this.div,this.rendererOptions);
break}}},displayError:function(){},setMap:function(){Mapabc.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++){a=this.strategies[b];a.autoActivate&&a.activate()}}},removeMap:function(){if(this.strategies){var a,b,c;b=0;for(c=this.strategies.length;b<c;b++){a=this.strategies[b];a.autoActivate&&a.deactivate()}}},
onMapResize:function(){Mapabc.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())},moveTo:function(a,b,c){Mapabc.Layer.prototype.moveTo.apply(this,arguments);var d=true;if(!c){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";d=this.renderer.setExtent(this.map.getExtent(),b);this.renderer.root.style.visibility="visible";
if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1)this.div.scrollLeft=this.div.scrollLeft;if(!b&&d)for(var e in this.unrenderedFeatures){var f=this.unrenderedFeatures[e];this.drawFeature(f)}}if(!this.drawn||b||!d){this.drawn=true;e=0;for(d=this.features.length;e<d;e++){this.renderer.locked=e!==d-1;f=this.features[e];this.drawFeature(f)}}},display:function(){Mapabc.Layer.prototype.display.apply(this,arguments);var a=this.div.style.display;if(a!=this.renderer.root.style.display)this.renderer.root.style.display=
a},addFeatures:function(a,b){a instanceof Array||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a};if(this.events.triggerEvent("beforefeaturesadded",d)===false)return;a=d.features}d=0;for(var e=a.length;d<e;d++){this.renderer.locked=d!=a.length-1?true:false;var f=a[d];if(this.geometryType&&!(f.geometry instanceof this.geometryType))throw Mapabc.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});this.features.push(f);f.layer=this;if(!f.style&&this.style)f.style=Mapabc.Util.extend({},
this.style);if(c){if(this.events.triggerEvent("beforefeatureadded",{feature:f})===false)continue;this.preFeatureInsert(f)}this.drawFeature(f);if(c&&!f.update){b||this.events.triggerEvent("featureadded",{feature:f});this.onFeatureInsert(f)}}b&&b.mousenotify&&this.events.triggerEvent("mousefeatureadded",{feature:f})},removeFeatures:function(a,b){if(!(!a||a.length===0)){a instanceof Array||(a=[a]);if(a===this.features)a=a.slice();for(var c=!b||!b.silent,d=a.length-1;d>=0;d--){this.renderer.locked=d!=
0&&a[d-1].geometry?true:false;var e=a[d];delete this.unrenderedFeatures[e.id];c&&this.events.triggerEvent("beforefeatureremoved",{feature:e});this.features=Mapabc.Util.removeItem(this.features,e);e.layer=null;e.geometry&&this.renderer.eraseFeatures(e);Mapabc.Util.indexOf(this.selectedFeatures,e)!=-1&&Mapabc.Util.removeItem(this.selectedFeatures,e);b&&b.whetherAll&&!e.update&&this.events.triggerEvent("featureremoved",{feature:e})}!c&&b.whetherAll&&this.events.triggerEvent("featuresremoved",{features:a})}},
destroyFeatures:function(a,b){if(a==undefined)a=this.features;if(a){this.removeFeatures(a,b);for(var c=a.length-1;c>=0;c--)a[c].destroy()}},drawFeature:function(a,b){if(this.drawn){if(typeof b!="object"){if(!b&&a.state===Mapabc.State.DELETE)b="delete";var c=b||a.renderIntent;(b=a.style||this.style)||(b=this.styleMap.createSymbolizer(a,c))}if(this.renderer.drawFeature(a,b))delete this.unrenderedFeatures[a.id];else this.unrenderedFeatures[a.id]=a}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},
getFeatureFromEvent:function(a){if(!this.renderer)return null;return this.getFeatureById(this.renderer.getFeatureIdFromEvent(a))},getFeatureById:function(a){for(var b=null,c=0,d=this.features.length;c<d;++c)if(this.features[c].id==a){b=this.features[c];break}return b},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var a=null;if(this.features&&this.features.length>0){a=new Mapabc.Bounds;for(var b=0,c=this.features.length;b<c;b++)a.extend(this.features[b].geometry.getBounds())}return a},
CLASS_NAME:"Mapabc.Layer.Vector"});Mapabc.Geometry.MultiPoint=Mapabc.Class(Mapabc.Geometry.Collection,{componentTypes:["Mapabc.Geometry.Point"],initialize:function(){Mapabc.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"Mapabc.Geometry.MultiPoint"});
Mapabc.Handler.Point=Mapabc.Class(Mapabc.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,pointStyle:null,layerOptions:null,initialize:function(a,b,c){if(!(c&&c.layerOptions&&c.layerOptions.styleMap))this.style=Mapabc.Util.extend(Mapabc.Feature.Vector.style["default"],{});Mapabc.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!Mapabc.Handler.prototype.activate.apply(this,arguments))return false;var a=Mapabc.Util.extend({displayInLayerSwitcher:false,
calculateInRange:function(){return true}},this.layerOptions);this.layer=new Mapabc.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true},createFeature:function(a){a=this.map.getLonLatFromPixel(a);this.point=new Mapabc.Feature.Vector(new Mapabc.Geometry.Point(a.lon,a.lat),null,this.pointStyle);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!Mapabc.Handler.prototype.deactivate.apply(this,
arguments))return false;this.drawing&&this.cancel();this.destroyFeature();this.layer.map!=null&&this.layer.destroy(false);this.layer=null;return true},destroyFeature:function(){this.layer&&this.layer.destroyFeatures();this.point=null},finalize:function(a){this.mouseDown=this.drawing=false;this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone()]);if(a||!this.persist)this.destroyFeature()},cancel:function(){this.finalize(true)},click:function(a){Mapabc.Event.stop(a);return false},
dblclick:function(a){Mapabc.Event.stop(a);return false},modifyFeature:function(a){a=this.map.getLonLatFromPixel(a);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;if(a&&this.multi)a=new Mapabc.Geometry.MultiPoint([a]);return a},geometryClone:function(){var a=
this.getGeometry();return a&&a.clone()},mousedown:function(a){if(!this.checkModifiers(a))return true;if(this.lastDown&&this.lastDown.equals(a.xy))return true;this.drawing=true;if(this.lastDown==null){this.persist&&this.destroyFeature();this.createFeature(a.xy)}else this.modifyFeature(a.xy);this.lastDown=a.xy;return false},mousemove:function(a){this.drawing&&this.modifyFeature(a.xy);return true},mouseup:function(){if(this.drawing){this.finalize();return false}else return true},CLASS_NAME:"Mapabc.Handler.Point"});
Mapabc.Layer.Vector.RootContainer=Mapabc.Class(Mapabc.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(){Mapabc.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(a){for(var b=this.layers,c,d=0;d<b.length;d++)if(c=b[d].getFeatureFromEvent(a))return c},setMap:function(a){Mapabc.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",
this,this.handleChangeLayer);this.resetRoots();Mapabc.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b){a=this.map.layers[b];Mapabc.Util.indexOf(this.layers,a)!=-1&&a.renderer.moveRoot(this.renderer)}},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b){a=this.layers[b];this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)}},handleChangeLayer:function(a){var b=a.layer;if(a.property==
"order"&&Mapabc.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"Mapabc.Layer.Vector.RootContainer"});
Mapabc.Strategy.BBOX=Mapabc.Class(Mapabc.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,initialize:function(a){Mapabc.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=Mapabc.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({moveend:this.update,scope:this});this.layer.events.on({refresh:this.update,scope:this})}return a},deactivate:function(){var a=Mapabc.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({moveend:this.update,
scope:this});this.layer.events.un({refresh:this.update,scope:this})}return a},update:function(a){var b=this.getMapBounds();if(a&&a.force||this.invalidBounds(b)){this.calculateBounds(b);this.resolution=this.layer.map.getResolution();this.triggerRead()}},getMapBounds:function(){var a=this.layer.map.getExtent();this.layer.projection.equals(this.layer.map.getProjectionObject())||(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));return a},invalidBounds:function(a){a||
(a=this.getMapBounds());a=!this.bounds||!this.bounds.containsBounds(a);if(!a&&this.resFactor){a=this.resolution/this.layer.map.getResolution();a=a>=this.resFactor||a<=1/this.resFactor}return a},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio;a=a.getHeight()*this.ratio;this.bounds=new Mapabc.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2)},triggerRead:function(){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadstart");
this.response=this.layer.protocol.read({filter:this.createFilter(),callback:this.merge,scope:this})},createFilter:function(){var a=new Mapabc.Filter.Spatial({type:Mapabc.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter)a=new Mapabc.Filter.Logical({type:Mapabc.Filter.Logical.AND,filters:[this.layer.filter,a]});return a},merge:function(a){this.layer.destroyFeatures();if((a=a.features)&&a.length>0){var b=this.layer.projection,c=this.layer.map.getProjectionObject();
if(!c.equals(b))for(var d,e=0,f=a.length;e<f;++e)(d=a[e].geometry)&&d.transform(b,c);this.layer.addFeatures(a)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"Mapabc.Strategy.BBOX"});
Mapabc.Control.SelectFeature=Mapabc.Class(Mapabc.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){this.EVENT_TYPES=Mapabc.Control.SelectFeature.prototype.EVENT_TYPES.concat(Mapabc.Control.prototype.EVENT_TYPES);
Mapabc.Control.prototype.initialize.apply(this,[b]);if(this.scope===null)this.scope=this;if(a instanceof Array){this.layers=a;this.layer=new Mapabc.Layer.Vector.RootContainer(this.id+"_container",{layers:a})}else this.layer=a;var c={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){c.over=this.overFeature;c.out=this.outFeature}this.callbacks=Mapabc.Util.extend(c,this.callbacks);this.handlers={feature:new Mapabc.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};
if(this.box)this.handlers.box=new Mapabc.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})},destroy:function(){Mapabc.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){if(!this.active){this.layers&&this.map.addLayer(this.layer);this.handlers.feature.activate();this.box&&this.handlers.box&&this.handlers.box.activate()}return Mapabc.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();
this.handlers.box&&this.handlers.box.deactivate();this.layers&&this.map.removeLayer(this.layer)}return Mapabc.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){for(var b=this.layers||[this.layer],c,d,e=0;e<b.length;++e){c=b[e];for(var f=c.selectedFeatures.length-1;f>=0;--f){d=c.selectedFeatures[f];if(!a||a.except!=d)this.unselect(d)}}},clickFeature:function(a,b){if(!this.hover)if(a.layer!=null?Mapabc.Util.indexOf(a.layer.selectedFeatures,a)>-1:false)if(this.toggleSelect())this.unselect(a);
else this.multipleSelect()||this.unselectAll({except:a});else{this.multipleSelect()||this.unselectAll({except:a});this.select(a,b)}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;if(this.hover)if(this.highlightOnly)this.highlight(a);
else Mapabc.Util.indexOf(b.selectedFeatures,a)==-1&&this.select(a)},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer;if(this.events.triggerEvent("beforefeaturehighlighted",{feature:a})!==false){a._prevHighlighter=a._lastHighlighter;a._lastHighlighter=
this.id;b.drawFeature(a,this.selectStyle||this.renderIntent);this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;a._lastHighlighter=a._prevHighlighter;delete a._prevHighlighter;b.drawFeature(a,a.style||a.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a,b){var c=this.onBeforeSelect.call(this.scope,a),d=a.layer;if(d!=null)if(c!==false){c=d.events.triggerEvent("beforefeatureselected",{feature:a});if(c!==
false){d.selectedFeatures.push(a);this.layerData={};d.drawFeature(a,this.selectStyle||this.renderIntent);d.events.triggerEvent("featureselected",{feature:a});switch(b){case "click":this.onSelect.call(this.scope,a);break;case "contextmenu":this.onRightSelect.call(this.scope,a);break;default:this.onSelect.call(this.scope,a)}}}},onRightSelect:function(){},unselect:function(a){var b=a.layer;this.unhighlight(a);Mapabc.Util.removeItem(b.selectedFeatures,a);b.events.triggerEvent("featureunselected",{feature:a});
this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof Mapabc.Bounds){var b=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.left,a.bottom));a=this.map.getLonLatFromPixel(new Mapabc.Pixel(a.right,a.top));b=new Mapabc.Bounds(b.lon,b.lat,a.lon,a.lat);this.multipleSelect()||this.unselectAll();a=this.multiple;this.multiple=true;for(var c=this.layers||[this.layer],d,e=0;e<c.length;++e){d=c[e];for(var f=0,g=d.features.length;f<g;++f){var h=d.features[f];if(this.geometryTypes==null||Mapabc.Util.indexOf(this.geometryTypes,
h.geometry.CLASS_NAME)>-1)b.toGeometry().intersects(h.geometry)&&Mapabc.Util.indexOf(d.selectedFeatures,h)==-1&&this.select(h)}}this.multiple=a}},setMap:function(a){this.handlers.feature.setMap(a);this.box&&this.handlers.box.setMap(a);Mapabc.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"Mapabc.Control.SelectFeature"});
Mapabc.Geometry.Curve=Mapabc.Class(Mapabc.Geometry.MultiPoint,{componentTypes:["Mapabc.Geometry.Point"],initialize:function(){Mapabc.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var a=0;if(this.components&&this.components.length>1)for(var b=1,c=this.components.length;b<c;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new Mapabc.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,
c))}a=0;if(b.components&&b.components.length>1)for(var d,e=1,f=b.components.length;e<f;e++){c=b.components[e-1];d=b.components[e];a+=Mapabc.Util.distVincenty({lon:c.x,lat:c.y},{lon:d.x,lat:d.y})}return a*1E3},CLASS_NAME:"Mapabc.Geometry.Curve"});
Mapabc.Control.ModifyFeature=Mapabc.Class(Mapabc.Control,{geometryTypes:null,clickout:true,toggle:true,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,mode:null,modified:false,radiusHandle:null,dragHandle:null,modifyfeatureArrById:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){this.layer=a;this.modifyfeatureArrById=b.arr;this.vertices=
[];this.virtualVertices=[];this.virtualStyle=Mapabc.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer());this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=Mapabc.Control.ModifyFeature.RESHAPE;Mapabc.Control.prototype.initialize.apply(this,[b]);if(!(this.deleteCodes instanceof Array))this.deleteCodes=[this.deleteCodes];var c=this;this.selectControl=new Mapabc.Control.SelectFeature(a,{geometryTypes:this.geometryTypes,clickout:this.clickout,
toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this});this.dragControl=new Mapabc.Control.DragFeature(a,{geometryTypes:["Mapabc.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(d,e){c.dragStart.apply(c,[d,e])},onDrag:function(d,e){c.dragVertex.apply(c,[d,e]);var f=Mapabc.Util.getElement("popup");f&&Mapabc.Element.hide(f)},onComplete:function(d){c.dragComplete.apply(c,[d])}});this.handlers={keyboard:new Mapabc.Handler.Keyboard(this,
{keydown:this.handleKeypress})}},destroy:function(){this.layer=null;this.selectControl.destroy();this.dragControl.destroy();Mapabc.Control.prototype.destroy.apply(this,[])},activate:function(){return this.selectControl.activate()&&this.handlers.keyboard.activate()&&Mapabc.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var a=false;if(Mapabc.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,
{silent:true});this.vertices=[];this.dragControl.deactivate();this.feature&&this.feature.geometry&&this.feature.layer&&this.selectControl.unselect.apply(this.selectControl,[this.feature]);this.selectControl.deactivate();this.handlers.keyboard.deactivate();a=true}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){for(var b=0;b<this.modifyfeatureArrById.length;b++)if(a.id==this.modifyfeatureArrById[b]){this.feature=
a;this.modified=false;this.resetVertices();var c=this;setTimeout(function(){c.dragControl.activate()});this.onModificationStart(this.feature);return}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],
{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified});this.modified=false},dragStart:function(a,b){if(a!=this.feature&&!a.geometry.parent&&a!=this.dragHandle&&a!=this.radiusHandle){this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]);if(this.geometryTypes==null||Mapabc.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)!=
-1){this.selectControl.clickFeature.apply(this.selectControl,[a]);this.dragControl.overFeature.apply(this.dragControl,[a]);this.dragControl.lastPixel=b;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=b;this.dragControl.handlers.drag.last=b}}},dragVertex:function(a,b){this.modified=true;if(this.feature.geometry.CLASS_NAME=="Mapabc.Geometry.Point"){if(this.feature!=a)this.feature=a;this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,
pixel:b})}else{if(this.feature.geometry.CLASS_NAME=="Mapabc.Geometry.Polygon"&&this.feature.geometry.isRectangle){var c=this.feature.geometry.components[0],d=null,e=null,f=null;if(a._index)if(a._index%2==0){f=a.geometry;d=c.components[a._index-1];e=c.components[a._index];d.x=f.x;e.x=f.x}else{f=a.geometry;d=c.components[a._index-1];e=c.components[a._index];d.y=f.y;e.y=f.y}else for(var g=0;g<c.components.length;g++)if(c.components[g]==a.geometry)if(g==0){f=a.geometry;d=c.components[g+1];e=c.components[c.components.length-
2];d.y=f.y;e.x=f.x}else if(g==1){f=a.geometry;d=c.components[g-1];e=c.components[g+1];e.x=f.x;d.y=f.y}else if(g==2){f=a.geometry;d=c.components[g+1];e=c.components[g-1];d.y=f.y;e.x=f.x}else if(g==3){f=a.geometry;d=c.components[g-1];e=c.components[0];e.x=f.x;d.y=f.y}}else{if(a._index){a.geometry.parent.addComponent(a.geometry,a._index);delete a._index;Mapabc.Util.removeItem(this.virtualVertices,a);this.vertices.push(a)}else if(a==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});
this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b});if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}}this.layer.drawFeature(this.feature,this.selectControl.renderIntent)}if(this.feature.geometry.CLASS_NAME=="Mapabc.Geometry.LineString"){c=
this.feature.geometry.clone();d=[];for(g=0;g<c.components.length;g++){e=c.components[g].transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));if(this.map.returnCoordType==COORD_TYPE_ENCODE){e.x=Mapabc.Util.encodeNumber(e.x,0);e.y=Mapabc.Util.encodeNumber(e.y,0)}d.push(new MLngLat(e.x,e.y,109))}for(g=0;g<this.map.ameMap.lineList.length;g++)if(this.map.ameMap.lineList[g].id==this.feature.id){this.map.ameMap.lineList[g].overlay.lnglatArr=d;return}}else if(this.feature.geometry.CLASS_NAME==
"Mapabc.Geometry.Polygon"){c=this.feature.geometry.components[0].clone();d=[];if(this.feature.geometry.isRectangle){g=c.components[0].transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));c=c.components[2].transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));if(this.map.returnCoordType==COORD_TYPE_ENCODE){g.x=Mapabc.Util.encodeNumber(g.x,0);g.y=Mapabc.Util.encodeNumber(g.y,0);c.x=Mapabc.Util.encodeNumber(c.x,0);c.y=Mapabc.Util.encodeNumber(c.y,0)}d.push(new MLngLat(g.x,
g.y,109));d.push(new MLngLat(c.x,c.y,109))}else for(g=0;g<c.components.length-1;g++){e=c.components[g].transform(this.map.getProjectionObject(),new Mapabc.Projection("EPSG:4326"));if(this.map.returnCoordType==COORD_TYPE_ENCODE){e.x=Mapabc.Util.encodeNumber(e.x,0);e.y=Mapabc.Util.encodeNumber(e.y,0)}d.push(new MLngLat(e.x,e.y,109))}if(this.feature.geometry.isRectangle)for(g=0;g<this.map.ameMap.rectList.length;g++){if(this.map.ameMap.rectList[g].id==this.feature.id){this.map.ameMap.rectList[g].overlay.lnglatArr=
d;return}}else for(g=0;g<this.map.ameMap.polygonList.length;g++)if(this.map.ameMap.polygonList[g].id==this.feature.id){this.map.ameMap.polygonList[g].overlay.lnglatArr=d;return}}this.layer.drawFeature(a)},dragComplete:function(){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=Mapabc.State.INSERT&&this.feature.state!=Mapabc.State.DELETE)this.feature.state=
Mapabc.State.UPDATE},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature);if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],
{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="Mapabc.Geometry.Point"){this.mode&Mapabc.Control.ModifyFeature.DRAG&&this.collectDragHandle();this.mode&(Mapabc.Control.ModifyFeature.ROTATE|Mapabc.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle();if(this.mode&Mapabc.Control.ModifyFeature.RESHAPE)this.mode&Mapabc.Control.ModifyFeature.RESIZE||this.collectVertices()}},handleKeypress:function(a){a=a.keyCode;if(this.feature&&Mapabc.Util.indexOf(this.deleteCodes,
a)!=-1)if((a=this.dragControl.feature)&&Mapabc.Util.indexOf(this.vertices,a)!=-1&&!this.dragControl.handlers.drag.dragging&&a.geometry.parent){a.geometry.parent.removeComponent(a.geometry);this.layer.drawFeature(this.feature,this.selectControl.renderIntent);this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}},collectVertices:function(){function a(c){var d,e,f;if(c.CLASS_NAME=="Mapabc.Geometry.Point"){e=
new Mapabc.Feature.Vector(c);e._sketch=true;b.vertices.push(e)}else{f=c.components.length;if(c.CLASS_NAME=="Mapabc.Geometry.LinearRing")f-=1;for(d=0;d<f;++d){e=c.components[d];if(e.CLASS_NAME=="Mapabc.Geometry.Point"){e=new Mapabc.Feature.Vector(e);e._sketch=true;b.vertices.push(e)}else a(e)}if(c.CLASS_NAME!="Mapabc.Geometry.MultiPoint"){d=0;for(f=c.components.length;d<f-1;++d){e=c.components[d];var g=c.components[d+1];if(e.CLASS_NAME=="Mapabc.Geometry.Point"&&g.CLASS_NAME=="Mapabc.Geometry.Point"){e=
new Mapabc.Feature.Vector(new Mapabc.Geometry.Point((e.x+g.x)/2,(e.y+g.y)/2),null,b.virtualStyle);e.geometry.parent=c;e._index=d+1;e._sketch=true;b.virtualVertices.push(e)}}}}}this.vertices=[];this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat();b=new Mapabc.Geometry.Point(b.lon,b.lat);
var c=new Mapabc.Feature.Vector(b);b.move=function(d,e){Mapabc.Geometry.Point.prototype.move.call(this,d,e);a.move(d,e)};c._sketch=true;this.dragHandle=c;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new Mapabc.Geometry.Point(c.lon,c.lat);b=new Mapabc.Geometry.Point(b.right,b.bottom);c=new Mapabc.Feature.Vector(b);var e=this.mode&Mapabc.Control.ModifyFeature.RESIZE,f=this.mode&Mapabc.Control.ModifyFeature.RESHAPE,
g=this.mode&Mapabc.Control.ModifyFeature.ROTATE;b.move=function(h,i){Mapabc.Geometry.Point.prototype.move.call(this,h,i);var j=this.x-d.x,k=this.y-d.y,l=j-h,m=k-i;if(g){var n=Math.atan2(m,l);n=Math.atan2(k,j)-n;n*=180/Math.PI;a.rotate(n,d)}if(e){var o;if(f){k=k/m;o=j/l/k}else{l=Math.sqrt(l*l+m*m);k=Math.sqrt(j*j+k*k)/l}a.resize(k,d,o)}};c._sketch=true;this.radiusHandle=c;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(a){this.selectControl.setMap(a);this.dragControl.setMap(a);
Mapabc.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"Mapabc.Control.ModifyFeature"});Mapabc.Control.ModifyFeature.RESHAPE=1;Mapabc.Control.ModifyFeature.RESIZE=2;Mapabc.Control.ModifyFeature.ROTATE=4;Mapabc.Control.ModifyFeature.DRAG=8;
Mapabc.Geometry.LineString=Mapabc.Class(Mapabc.Geometry.Curve,{initialize:function(){Mapabc.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(){this.components&&this.components.length>2&&Mapabc.Geometry.Collection.prototype.removeComponent.apply(this,arguments)},intersects:function(a){var b=false,c=a.CLASS_NAME;if(c=="Mapabc.Geometry.LineString"||c=="Mapabc.Geometry.LinearRing"||c=="Mapabc.Geometry.Point"){var d=this.getSortedSegments();a=c=="Mapabc.Geometry.Point"?
[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();var e,f,g,h,i,j,k,l=0,m=d.length;a:for(;l<m;++l){c=d[l];e=c.x1;f=c.x2;g=c.y1;h=c.y2;var n=0,o=a.length;for(;n<o;++n){i=a[n];if(i.x1>f)break;if(!(i.x2<e)){j=i.y1;k=i.y2;if(!(Math.min(j,k)>Math.max(g,h)))if(!(Math.max(j,k)<Math.min(g,h)))if(Mapabc.Geometry.segmentsIntersect(c,i)){b=true;break a}}}}}else b=a.intersects(this);return b},getSortedSegments:function(){for(var a=this.components.length-1,b=new Array(a),c=0;c<a;++c){point1=this.components[c];
point2=this.components[c+1];b[c]=point1.x<point2.x?{x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}:{x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y}}return b.sort(function(d,e){return d.x1-e.x1})},splitWithSegment:function(a,b){for(var c=!(b&&b.edge===false),d=b&&b.tolerance,e=[],f=this.getVertices(),g=[],h=[],i=false,j,k,l,m={point:true,tolerance:d},n=null,o=0,q=f.length-2;o<=q;++o){d=f[o];g.push(d.clone());j=f[o+1];k={x1:d.x,y1:d.y,x2:j.x,y2:j.y};k=Mapabc.Geometry.segmentsIntersect(a,k,m);if(k instanceof
Mapabc.Geometry.Point)if((l=k.x===a.x1&&k.y===a.y1||k.x===a.x2&&k.y===a.y2||k.equals(d)||k.equals(j)?true:false)||c){k.equals(h[h.length-1])||h.push(k.clone());if(o===0)if(k.equals(d))continue;if(!k.equals(j)){i=true;k.equals(d)||g.push(k);e.push(new Mapabc.Geometry.LineString(g));g=[k.clone()]}}}if(i){g.push(j.clone());e.push(new Mapabc.Geometry.LineString(g))}if(h.length>0){var r=a.x1<a.x2?1:-1,p=a.y1<a.y2?1:-1;n={lines:e,points:h.sort(function(t,u){return r*t.x-r*u.x||p*t.y-p*u.y})}}return n},
split:function(a,b){var c=null,d=b&&b.mutual,e,f,g,h;if(a instanceof Mapabc.Geometry.LineString){var i=this.getVertices(),j,k,l,m,n,o=[];g=[];for(var q=0,r=i.length-2;q<=r;++q){j=i[q];k=i[q+1];l={x1:j.x,y1:j.y,x2:k.x,y2:k.y};h=h||[a];d&&o.push(j.clone());for(var p=0;p<h.length;++p)if(m=h[p].splitWithSegment(l,b)){n=m.lines;if(n.length>0){n.unshift(p,1);Array.prototype.splice.apply(h,n);p+=n.length-2}if(d)for(var t=0,u=m.points.length;t<u;++t){n=m.points[t];if(!n.equals(j)){o.push(n);g.push(new Mapabc.Geometry.LineString(o));
o=n.equals(k)?[]:[n.clone()]}}}}if(d&&g.length>0&&o.length>0){o.push(k.clone());g.push(new Mapabc.Geometry.LineString(o))}}else c=a.splitWith(this,b);if(h&&h.length>1)f=true;else h=[];if(g&&g.length>1)e=true;else g=[];if(f||e)c=d?[g,h]:h;return c},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){return a===true?[this.components[0],this.components[this.components.length-1]]:a===false?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,
b){var c=!(b&&b.edge===false)&&b&&b.details,d,e={},f=Number.POSITIVE_INFINITY;if(a instanceof Mapabc.Geometry.Point){for(var g=this.getSortedSegments(),h=a.x,i=a.y,j,k=0,l=g.length;k<l;++k){j=g[k];d=Mapabc.Geometry.distanceToSegment(a,j);if(d.distance<f){f=d.distance;e=d;if(f===0)break}else if(j.x2>h&&(i>j.y1&&i<j.y2||i<j.y1&&i>j.y2))break}e=c?{distance:e.distance,x0:e.x,y0:e.y,x1:h,y1:i}:e.distance}else if(a instanceof Mapabc.Geometry.LineString){g=this.getSortedSegments();h=a.getSortedSegments();
var m,n,o=h.length,q={point:true};k=0;l=g.length;a:for(;k<l;++k){i=g[k];j=i.x1;n=i.y1;for(var r=0;r<o;++r){d=h[r];if(m=Mapabc.Geometry.segmentsIntersect(i,d,q)){f=0;e={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break a}else{d=Mapabc.Geometry.distanceToSegment({x:j,y:n},d);if(d.distance<f){f=d.distance;e={distance:f,x0:j,y0:n,x1:d.x,y1:d.y}}}}}if(!c)e=e.distance;if(f!==0)if(i){d=a.distanceTo(new Mapabc.Geometry.Point(i.x2,i.y2),b);k=c?d.distance:d;if(k<f)e=c?{distance:f,x0:d.x1,y0:d.y1,x1:d.x0,y1:d.y0}:
k}}else{e=a.distanceTo(this,b);if(c)e={distance:e.distance,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0}}return e},CLASS_NAME:"Mapabc.Geometry.LineString"});
Mapabc.Geometry.LinearRing=Mapabc.Class(Mapabc.Geometry.LineString,{componentTypes:["Mapabc.Geometry.Point"],initialize:function(){Mapabc.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(a,b){var c=false,d=this.components.pop();if(b!=null||!a.equals(d))c=Mapabc.Geometry.Collection.prototype.addComponent.apply(this,arguments);Mapabc.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return c},removeComponent:function(){if(this.components.length>
4){this.components.pop();Mapabc.Geometry.Collection.prototype.removeComponent.apply(this,arguments);Mapabc.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]])}},move:function(a,b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d-1;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;d<e-1;++d)this.components[d].resize(a,b,c);return this},transform:function(a,
b){if(a&&b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].transform(a,b);this.bounds=null}return this},getCentroid:function(){if(this.components&&this.components.length>2){for(var a=0,b=0,c=0;c<this.components.length-1;c++){var d=this.components[c],e=this.components[c+1];a+=(d.x+e.x)*(d.x*e.y-e.x*d.y);b+=(d.y+e.y)*(d.x*e.y-e.x*d.y)}c=-1*this.getArea();a=a/(6*c);b=b/(6*c)}return new Mapabc.Geometry.Point(a,b)},getArea:function(){var a=0;if(this.components&&this.components.length>
2){for(var b=a=0,c=this.components.length;b<c-1;b++){var d=this.components[b],e=this.components[b+1];a+=(d.x+e.x)*(e.y-d.y)}a=-a/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new Mapabc.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}a=0;c=b.components&&b.components.length;if(c>2){for(var d,e,f=0;f<c-1;f++){d=b.components[f];e=b.components[f+1];a+=Mapabc.Util.rad(e.x-d.x)*(2+Math.sin(Mapabc.Util.rad(d.y))+Math.sin(Mapabc.Util.rad(e.y)))}a=a*6378137*6378137/2}return a},
containsPoint:function(a){var b=Mapabc.Number.limitSigDigs,c=b(a.x,14);a=b(a.y,14);for(var d=this.components.length-1,e,f,g,h,i,j=0,k=0;k<d;++k){e=this.components[k];g=b(e.x,14);e=b(e.y,14);f=this.components[k+1];h=b(f.x,14);f=b(f.y,14);if(e==f){if(a==e)if(g<=h&&c>=g&&c<=h||g>=h&&c<=g&&c>=h){j=-1;break}}else{i=b(((g-h)*a+(h*e-g*f))/(e-f),14);if(i==c)if(e<f&&a>=e&&a<=f||e>f&&a<=e&&a>=f){j=-1;break}if(!(i<=c))if(!(g!=h&&(i<Math.min(g,h)||i>Math.max(g,h))))if(e<f&&a>=e&&a<f||e>f&&a<e&&a>=f)++j}}return j==
-1?1:!!(j&1)},intersects:function(a){var b=false;if(a.CLASS_NAME=="Mapabc.Geometry.Point")b=this.containsPoint(a);else if(a.CLASS_NAME=="Mapabc.Geometry.LineString")b=a.intersects(this);else if(a.CLASS_NAME=="Mapabc.Geometry.LinearRing")b=Mapabc.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;c<d;++c)if(b=a.components[c].intersects(this))break;return b},getVertices:function(a){return a===true?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"Mapabc.Geometry.LinearRing"});
Mapabc.Geometry.MultiLineString=Mapabc.Class(Mapabc.Geometry.Collection,{componentTypes:["Mapabc.Geometry.LineString"],initialize:function(){Mapabc.Geometry.Collection.prototype.initialize.apply(this,arguments)},split:function(a,b){for(var c=null,d=b&&b.mutual,e,f,g,h,i=[],j=[a],k=0,l=this.components.length;k<l;++k){f=this.components[k];g=false;for(var m=0;m<j.length;++m)if(e=f.split(j[m],b)){if(d){g=e[0];for(var n=0,o=g.length;n<o;++n)n===0&&i.length?i[i.length-1].addComponent(g[n]):i.push(new Mapabc.Geometry.MultiLineString([g[n]]));
g=true;e=e[1]}if(e.length){e.unshift(m,1);Array.prototype.splice.apply(j,e);break}}if(!g)if(i.length)i[i.length-1].addComponent(f.clone());else i=[new Mapabc.Geometry.MultiLineString(f.clone())]}if(i&&i.length>1)g=true;else i=[];if(j&&j.length>1)h=true;else j=[];if(g||h)c=d?[i,j]:j;return c},splitWith:function(a,b){var c=null,d=b&&b.mutual,e,f,g,h,i,j;if(a instanceof Mapabc.Geometry.LineString){j=[];i=[a];for(var k=0,l=this.components.length;k<l;++k){g=false;f=this.components[k];for(var m=0;m<i.length;++m)if(e=
i[m].split(f,b)){if(d){g=e[0];if(g.length){g.unshift(m,1);Array.prototype.splice.apply(i,g);m+=g.length-2}e=e[1];if(e.length===0)e=[f.clone()]}g=0;for(var n=e.length;g<n;++g)g===0&&j.length?j[j.length-1].addComponent(e[g]):j.push(new Mapabc.Geometry.MultiLineString([e[g]]));g=true}if(!g)if(j.length)j[j.length-1].addComponent(f.clone());else j=[new Mapabc.Geometry.MultiLineString([f.clone()])]}}else c=a.split(this);if(i&&i.length>1)h=true;else i=[];if(j&&j.length>1)g=true;else j=[];if(h||g)c=d?[i,
j]:j;return c},CLASS_NAME:"Mapabc.Geometry.MultiLineString"});
Mapabc.Handler.Path=Mapabc.Class(Mapabc.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(){Mapabc.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.control.map.getLonLatFromPixel(a);this.point=new Mapabc.Feature.Vector(new Mapabc.Geometry.Point(a.lon,a.lat));this.line=new Mapabc.Feature.Vector(new Mapabc.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();
this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(){Mapabc.Handler.Point.prototype.destroyFeature.apply(this);this.line=null},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);a=this.control.map.getLonLatFromPixel(a);this.point=new Mapabc.Feature.Vector(new Mapabc.Geometry.Point(a.lon,a.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);
this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature()},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a){a=this.control.map.getLonLatFromPixel(a);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,
this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi)a=new Mapabc.Geometry.MultiLineString([a]);return a},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy))return false;if(this.lastDown==null){this.persist&&this.destroyFeature();this.createFeature(a.xy)}else if(this.lastUp==null||!this.lastUp.equals(a.xy))this.addPoint(a.xy);this.mouseDown=true;this.lastDown=a.xy;
this.drawing=true;return false},mousemove:function(a){if(this.drawing){this.mouseDown&&this.freehandMode(a)?this.addPoint(a.xy):this.modifyFeature(a.xy);this.callback("move",[this.getGeometry(),"movepoint",this.point.geometry])}return true},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){this.removePoint();this.finalize()}else{this.lastUp==null&&this.addPoint(a.xy);this.lastUp=a.xy}return false}return true},dblclick:function(a){if(!this.freehandMode(a)){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-
1]);this.removePoint();this.finalize()}return false},CLASS_NAME:"Mapabc.Handler.Path"});
Mapabc.Geometry.Polygon=Mapabc.Class(Mapabc.Geometry.Collection,{isRectangle:false,componentTypes:["Mapabc.Geometry.LinearRing"],initialize:function(){Mapabc.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var a=0;if(this.components&&this.components.length>0){a+=Math.abs(this.components[0].getArea());for(var b=1,c=this.components.length;b<c;b++)a-=Math.abs(this.components[b].getArea())}return a},getGeodesicArea:function(a){var b=0;if(this.components&&this.components.length>
0){b+=Math.abs(this.components[0].getGeodesicArea(a));for(var c=1,d=this.components.length;c<d;c++)b-=Math.abs(this.components[c].getGeodesicArea(a))}return b},containsPoint:function(a){var b=this.components.length,c=false;if(b>0){c=this.components[0].containsPoint(a);if(c!==1)if(c&&b>1)for(var d,e=1;e<b;++e)if(d=this.components[e].containsPoint(a)){c=d===1?1:false;break}}return c},intersects:function(a){var b=false,c,d;if(a.CLASS_NAME=="Mapabc.Geometry.Point")b=this.containsPoint(a);else if(a.CLASS_NAME==
"Mapabc.Geometry.LineString"||a.CLASS_NAME=="Mapabc.Geometry.LinearRing"){c=0;for(d=this.components.length;c<d;++c)if(b=a.intersects(this.components[c]))break;if(!b){c=0;for(d=a.components.length;c<d;++c)if(b=this.containsPoint(a.components[c]))break}}else{c=0;for(d=a.components.length;c<d;++c)if(b=this.intersects(a.components[c]))break}if(!b&&a.CLASS_NAME=="Mapabc.Geometry.Polygon"){var e=this.components[0];c=0;for(d=e.components.length;c<d;++c)if(b=a.containsPoint(e.components[c]))break}return b},
distanceTo:function(a,b){return b&&b.edge===false&&this.intersects(a)?0:Mapabc.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])},CLASS_NAME:"Mapabc.Geometry.Polygon"});Mapabc.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-0.5);if(d)e+=d/180*Math.PI;for(var f,g=[],h=0;h<c;++h){f=e+h*2*Math.PI/c;d=a.x+b*Math.cos(f);f=a.y+b*Math.sin(f);g.push(new Mapabc.Geometry.Point(d,f))}a=new Mapabc.Geometry.LinearRing(g);return new Mapabc.Geometry.Polygon([a])};
Mapabc.Geometry.MultiPolygon=Mapabc.Class(Mapabc.Geometry.Collection,{componentTypes:["Mapabc.Geometry.Polygon"],initialize:function(){Mapabc.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"Mapabc.Geometry.MultiPolygon"});
Mapabc.Handler.Polygon=Mapabc.Class(Mapabc.Handler.Path,{polygon:null,initialize:function(){Mapabc.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.control.map.getLonLatFromPixel(a);this.point=new Mapabc.Feature.Vector(new Mapabc.Geometry.Point(a.lon,a.lat));this.line=new Mapabc.Feature.Vector(new Mapabc.Geometry.LinearRing([this.point.geometry]));this.polygon=new Mapabc.Feature.Vector(new Mapabc.Geometry.Polygon([this.line.geometry]));this.callback("create",
[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},destroyFeature:function(){Mapabc.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi)a=new Mapabc.Geometry.MultiPolygon([a]);
return a},dblclick:function(a){if(!this.freehandMode(a)){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]);this.removePoint();this.finalize()}return false},CLASS_NAME:"Mapabc.Handler.Polygon"});
